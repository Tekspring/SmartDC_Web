"use strict";const e="ImageDatabase",t="Images";function o(e){return new Promise((t=>setTimeout(t,e)))}function a(){return new Promise(((o,a)=>{const n=indexedDB.open(e,1);n.onupgradeneeded=e=>{e.target.result.createObjectStore(t,{keyPath:"name"})},n.onsuccess=e=>{const t=e.target.result;o(t)},n.onerror=e=>{a(e.target.error)}}))}var n;(n=navigator.userAgent).match(/chrome|chromium|crios/i)||n.match(/firefox|fxios/i)||n.match(/safari/i)||n.match(/opr\//i)||n.match(/edg/i)||n.match(/msie|trident/i);function r(e,t,o){let a=document.getElementById(t),n=document.createElement(e);n.id=o,a.appendChild(n)}function c(e,t){r("canvas",e,t)}function s(e,t){r("div",e,t)}function l(e,t){r("span",e,t)}function d(e,t){r("select",e,t)}function u(e,t){r("img",e,t)}function p(e,t){r("input",e,t)}function g(e,t){r("label",e,t)}function m(e,t){document.getElementById(e).hidden=!t}if(void 0===f)var f={over:0,normal:1,click:2};if(void 0===h)var h={left:1,right:3};if(void 0===b)var b={start:0,move:1,end:2,undo:3,redo:4,mirror:5,flip:6,brightness:7,zoom:8,pan:9,whiteBalance:10};if(void 0===v)var v={w:0,h:1,data:2};if(void 0===w)var w={value:0,status:1};if(void 0===y)var y={before:0,after:1};if(void 0===I)var I={toolBar:0,scrollBar:1,colorBar:2,sysToolBar:3,displayCanvas:4};if(void 0===x)var x={id:0,pic:1,state:2,groupId:3};function C(e,t,o,a,n,i){s(o,a),$("#"+a).data("btnData",e),function(e,t){var o,a="",n=e.length;for(o=0;o<n;o++)a+='<span class="'+t+' toolBar" id="'+e[o][x.id]+'"></span>';$("#"+t).html(a)}(e,a);var r="."+a;document.getElementById(a).classList.add("scrollable"),$(r).css(t);var c,l,d=!1,u=!1,p=!1,g=!1,m=t.width,f=t.height;"right"===n&&(p=!0,m=0,d=!0),"left"===n&&(m=0,d=!0),"top-right"===n&&(p=!0,f=0,m=-t.width),"top-left"===n&&(f=0,u=!0),"bottom"===n&&(m=60,f=0,g=!0),$(r).attr("style",(function(e,o){return o+(p?" left: calc(100% - "+(t.width-e*m)+"px);":" left: "+e*m+"px;")+(" top: "+(0+e*f)+"px;")})),$(r).hover(D,H),null==i?$(r).on("click",M):$(r).on("click",i),d&&(c={top:on+"px",height:"calc(100% - "+on+"px)",width:t.width+"px",background:Ce.toolBarColorLeave,opacity:Ce.toolBarOpacityLeave,position:"absolute"},p?c.right="0px":c.left="0px",$("#"+a).css(c)),u&&function(){var e={top:"0px",height:t.height+"px",width:"calc(100%)",background:Ce.toolBarColorLeave,opacity:Ce.toolBarOpacityLeave,position:"absolute"};p?e.right="0px":e.left="0px",$("#"+a).css(e)}(),g&&(l={top:"calc(100% - "+2*Ce.scrollIconH+"px)",left:"48px",height:"30px",width:"60px",background:"#00000000",opacity:Ce.toolBarOpacityLeave,position:"absolute"},$("#"+a).css(l))}function B(e,t){var o,a=e.length;for(o=0;o<a;o++)if(t===e[o][x.id])return o;return-1}function S(e,t,o){var a,n,i,r;a="#"+e[t][x.id],n=En(e[t][x.pic]),$(a).css("background",n),o===f.over?(i=Ce.toolBarColorEnter,r=Ce.toolBarOpacityEnter):o===f.normal?(i=Ce.toolBarColorLeave,r=Ce.toolBarOpacityLeave):(i=Ce.toolBarColorClick,r=Ce.toolBarOpacityClick),$(a).css("background-color",i),$(a).css("background-position","center center"),$(a).css("background-repeat","no-repeat"),$(a).css("opacity",r)}function W(e){var t,o=e.length;for(t=0;t<o;t++)1===e[t][x.state]?S(e,t,f.click):2===e[t][x.state]?S(e,t,f.over):S(e,t,f.normal)}function _(e,t){var o,a=e.length;for(o=0;o<a;o++)if(t===e[o][x.groupId]&&e[o][x.state]>0)return o;return-1}function k(e,t){var o,a=1;if(e[t][x.state]&&(a=0),o=e[t][x.groupId],function(e,t){var o,a=0,n=e.length;for(o=0;o<n;o++)t===e[o][x.groupId]&&(a+=1);return a}(e,o)>1&&(a=1),o>0){var n=_(e,o);n>=0&&o===e[n][x.groupId]&&(e[n][x.state]=0,S(e,n,f.normal))}e[t][x.state]=a,a&&(S(e,t,f.click),0===o&&setTimeout((function(){e[t][x.state]=0,S(e,t,f.normal)}),100))}function T(e,t){var o="#"+e.target.id,a=$(o).parent().data("btnData"),n=B(a,e.target.id);0===a[n][x.state]&&S(a,n,t)}function D(e){T(e,f.over)}function H(e){T(e,f.normal)}function M(e){kn(I.toolBar,f.click,e);var t=$("#"+e.target.id).parent().data("btnData"),o=B(t,e.target.id);o>=0&&k(t,o)}function P(e,t,o){var a,n=$("#"+e).data("btnData");for(a=0;a<n.length;a++)if(t==n[a][x.id])return n[a][x.state]=o,void W(n)}function z(e,t){var o,a=$("#"+e).data("btnData");for(o=0;o<a.length;o++)a[o][x.state]=t;W(a)}if(void 0===F)var F={color:0,state:1};function R(e,t,o,a,n){var i,r,c,l;s(o,a),i={position:"absolute","margin-left":"0px",background:Ce.drawSetBackground,opacity:Ce.drawSetOpacity},r=e.length,c=Ce.colorIconW,l=Ce.colorIconH,i.width=c*r+"px",i.height=l+"px",i.left="calc(100% - "+c*r+"px)",i.top="0px",$("#"+a).css(i),e.fnNotify=n,$("#"+a).data("colorData",e),function(e,t){var o,a,n=e.length;for(o=0;o<n;o++)s(t,a=e[o][F.color]),$("#"+a).addClass(t+" colorBar")}(e,a);var d="."+a;$(d).css(t),$(d).attr("style",(function(o,a){return a+(" left: calc(100% - "+t.width*(o+1)+"px);")+" top: 0px;"+(" background: #"+e[o][F.color]+";")+(" margin: "+Ce.colorIconMarginNormal+"px;")+(" width: "+(t.width-2*Ce.colorIconMarginNormal)+"px;")+(" height: "+(t.height-2*Ce.colorIconMarginNormal)+"px;")})),$(d).hover(L,O),$(d).on("click",A),q($("#"+a))}function A(e){var t,o=$("#"+e.target.id).parent().data("colorData");for(t=0;t<o.length;t++)e.target.id===o[t][F.color]?o[t][F.state]=1:o[t][F.state]=0;X(o),q($("#"+e.target.id).parent()),kn(I.colorBar,f.click,e)}function E(e,t){var o="#"+e.target.id,a=$(o).parent().data("colorData"),n=function(e,t){var o,a=e.length;for(o=0;o<a;o++)if(t===e[o][F.color])return o;return-1}(a,e.target.id);0===a[n][F.state]&&Y(a,n,t)}function L(e){E(e,f.over)}function O(e){E(e,f.normal)}function Y(e,t,o){var a,n,i="#"+e[t][F.color];o===f.over?(a=Ce.colorIconMarginOver,n=Ce.colorIconW-2*Ce.colorIconMarginNormal):o===f.normal?(a=Ce.colorIconMarginNormal,n=Ce.colorIconW-2*Ce.colorIconMarginNormal):(a=Ce.colorIconMarginClick,n=Ce.colorIconW-2*Ce.colorIconMarginClick),$(i).css("margin",a+"px"),$(i).css("width",n+"px"),$(i).css("height",n+"px")}function X(e){var t,o=e.length;for(t=0;t<o;t++)1===e[t][F.state]?Y(e,t,f.click):Y(e,t,f.normal)}function G(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,o,a){return t+t+o+o+a+a}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function q(e){var t,o,a,n,i,r=$(e).data("colorData");if(r.fnNotify)for(o=0;o<r.length;o++)r[o][F.state]&&(a=G("#"+(t=r[o][F.color])).r,n=G("#"+t).g,i=G("#"+t).b,r.fnNotify(t,a,n,i))}if(void 0===F)F={color:0,state:1};function U(e,t,o,a,n){var i,r,s,d;l(o,a),i={position:"absolute","margin-left":"0px",background:Ce.drawSetBackground,opacity:Ce.drawSetOpacity},r=e.length,s=Ce.cb2BlockW,d=Ce.cb2BlockH,i.width=s*r+"px",i.height=d+"px",i.top="40px",i.left="0px",$("#"+a).css(i),e.fnNotify=n,$("#"+a).data("colorData",e),function(e,t){var o,a,n,i,r,s,d,u,p,g,m,f,h=e.length;d=Ce.cb2BlockW-2*Ce.cb2FrameGap,u=Ce.cb2BlockH-2*Ce.cb2FrameGap;var b={position:"absolute",left:Ce.cb2FrameGap,top:Ce.cb2FrameGap,width:d,height:u,opacity:1},v={position:"absolute",left:0,top:0,width:Ce.scrollIconW,height:Ce.scrollIconH,opacity:1};for(o=0;o<h;o++){p=Q("#"+(f=e[o][F.color])).r,g=Q("#"+f).g,m=Q("#"+f).b,l(t,a=f),i="#"+a,v.left=(h-1-o)*Ce.scrollIconW,$(i).css(v),c(a,n=a+"_canvas"),i="#"+n,$(i).hover(j,Z),$(i).on("click",V),$(i).css(b),$(i).attr("width",d),$(i).attr("height",u),s=(r=document.getElementById(n)).getContext("2d"),un(r);var w="rgba("+p+", "+g+", "+m+", 1)";s.fillStyle=w,s.fillRect(0,0,d,u)}}(e,a),ee($("#"+a))}function V(e){var t,o=e.target.id,a=$("#"+o).parent().attr("id"),n=$("#"+a).parent().attr("id"),i=$("#"+n).data("colorData");for(t=0;t<i.length;t++)a===i[t][F.color]?i[t][F.state]=1:i[t][F.state]=0;J(i),ee($("#"+n)),kn(I.colorBar,f.click,e)}function N(e,t){var o=e.target.id,a=$("#"+o).parent().attr("id"),n=$("#"+a).parent().attr("id"),i=$("#"+n).data("colorData"),r=function(e,t){var o,a=e.length;for(o=0;o<a;o++)if(t===e[o][F.color])return o;return-1}(i,a);0===i[r][F.state]&&K(i,r,t)}function j(e){N(e,f.over)}function Z(e){N(e,f.normal)}function K(e,t,o){var a,n="#"+e[t][F.color];a=o===f.over?Ce.cb2MouseColorEnter:o===f.normal?Ce.cb2MouseColorLeave:Ce.cb2MouseColorClick,$(n).css("background",a)}function J(e){var t,o=e.length;for(t=0;t<o;t++)1===e[t][F.state]?K(e,t,f.click):K(e,t,f.normal)}function Q(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,o,a){return t+t+o+o+a+a}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function ee(e){var t,o,a,n,i,r=$(e).data("colorData");if(r.fnNotify)for(o=0;o<r.length;o++)r[o][F.state]&&(a=Q("#"+(t=r[o][F.color])).r,n=Q("#"+t).g,i=Q("#"+t).b,r.fnNotify(t,a,n,i))}function te(e){var t="#"+e.target.id,o=$(t).parent().data("scrollData"),a=e.offsetX;a<=Ce.scrollTickH/2&&(a=0),a>o.length&&(a=o.length),o.curPos=a,oe(o.id),ae(o.id)}function oe(e){var t,o,a,n,i,r,c,s,l=$("#"+e).data("scrollData");o=(t=document.getElementById(e+"-canvas")).getContext("2d"),un(t),s=(l.iconSize-Ce.scrollTickH)/2,a=Ce.scrollTickH/2,n=s+(Ce.scrollTickH-Ce.scrollLineH)/2,i=l.length,r=Ce.scrollLineH,o.rect(a,n,i,r),o.fillStyle=l.color,o.fill(),a=Ce.scrollTickH/2+l.curPos,n=s+Ce.scrollTickH/2,c=Ce.scrollTickH/2,o.arc(a,n,c,0,2*Math.PI,!1),o.fillStyle=l.color,o.fill()}function ae(e){var t=$("#"+e).data("scrollData");t.fnNotify&&t.fnNotify(t.length,t.curPos)}function ne(e,t){var o=$("#"+e).data("scrollData");t<=o.length&&(o.curPos=t,oe(e))}function ie(){var e,t,o="configDrawDlg";s("uiArea",o),e="#"+o,$(e).css("background",xe.ColorLeave),$(e).css("top","calc(100% - 100px)"),$(e).css("left",en-300-Ce.toolBarIconW+"px"),$(e).css("width","300px"),$(e).css("height","70px"),$(e).css("position","absolute"),$(e).hide(),function(){var e={iconL:"30x_30alpha.png",iconSize:Ce.scrollIconH,length:Ce.scrollOpacityW,curPos:Ce.scrollOpacityDefPos,startX:0,startY:0,color:Ce.scrollColor};if(0===Ce.disableDrawingOpacityScrollBar){function o(e){var t;t=e.currentTarget?e.currentTarget.value:e,Oa.opacity=.1+t/100*.9,Oa.opacity=Oa.opacity.toFixed(1),bn()}vt(e,"configDrawDlg","drawingOpacity",o,100)}var t={iconL:"30x30lineWidth.png",iconSize:Ce.scrollIconH,length:Ce.scrollLineWidthW,curPos:Ce.scrollLineWidthDefPos,startX:160,startY:0,color:Ce.scrollColor};if(0===Ce.disableDrawingLineWidthScrollBar){function a(e){var t;t=e.currentTarget?e.currentTarget.value:e,Oa.lineWidth=Ce.lineWidthMin+(Ce.lineWidthMax-Ce.lineWidthMin)*(t/100),Oa.lineWidth=Math.floor(Oa.lineWidth)}vt(t,"configDrawDlg","drawingLineWidth",a,10)}}(),t={position:"absolute",width:Ce.colorIconW,height:Ce.colorIconH,"margin-left":"0px",opacity:Ce.colorIconOpacity},1===Ce.disableColorBar?(R(Re,t,"configDrawDlg","drawingCfgColorBar",bt),X(Re)):Ce.cb2Apply?(U(Fe,0,"configDrawDlg","drawingCfgColorBar",bt),J(Fe)):(R(Fe,t,"configDrawDlg","drawingCfgColorBar",bt),X(Fe))}function re(e,t,o,a,n){var i=t+"-icon";l(e,i),i="#"+i,$(i).css({background:En(o),top:n,left:a,width:Ce.toolBarIconW+"px",height:Ce.toolBarIconH+"px",position:"absolute"});var r=t+"-slider";return p(e,r),i="#"+r,$(i).attr("class","slider"),$(i).css({top:n,left:a+Ce.toolBarIconW+16,width:"200px",height:Ce.toolBarIconH+"px",position:"absolute"}),l(e,i=t+"-reset"),i="#"+i,$(i).css("background",En("undo.png")),$(i).css("top",n+"px"),$(i).css("left",a+Ce.toolBarIconW+16+200+16+"px"),$(i).css("width",Ce.toolBarIconW+"px"),$(i).css("height",Ce.toolBarIconH+"px"),$(i).css("position","absolute"),$(i).on("click",(function(){"configDlg-rotate-slider"==r?$("#"+r).val(0):$("#"+r).val(1),$("#"+r).trigger("input")})),r}function ce(e,t,o,a,n,i=!1){var r,s,d,u,p={position:"absolute","margin-left":"0px",background:Ce.scrollDlgBkg,opacity:Ce.scrollDlgOpacity};l(o,a),s=e.iconSize+Ce.scrollIconGap+e.length+Ce.scrollTickH,void 0!==e.iconR&&(s+=Ce.scrollIconGap+e.iconSize),d=e.iconSize+Ce.toolBarIconH,p.left="calc(50% - "+s/2+"px)",p.top="calc(50% - "+(d-Ce.titleIconH)/2+"px)",p.width=s+"px",p.height=d+"px",$("#"+a).css(p),l(a,r=a+"-close"),r="#"+r,u=En("close.png"),$(r).css("background",u),$(r).css("top","0px"),$(r).css("left",s-Ce.toolBarIconW+"px"),$(r).css("width",Ce.toolBarIconW+"px"),$(r).css("height",Ce.toolBarIconH+"px"),$(r).css("position","absolute"),$(r).on("click",se),i&&(l(a,r=a+"-reset"),r="#"+r,u=En("undo.png"),$(r).css("background",u),$(r).css("top","0px"),$(r).css("left",s/2-Ce.toolBarIconW/2+"px"),$(r).css("width",Ce.toolBarIconW+"px"),$(r).css("height",Ce.toolBarIconH+"px"),$(r).css("position","absolute"),$(r).on("click",(function(){ne(a+"-scrollbar",e.length/2),oe(a+"-scrollbar"),ae(a+"-scrollbar")}))),r=a+"-scrollbar",e.startY=Ce.toolBarIconH,function(e,t,o,a,n){var i,r,s,d,u,p,g,m,b;l(o,a),g=e.iconSize+Ce.scrollIconGap+e.length+Ce.scrollTickH,void 0!==e.iconR&&(g+=Ce.scrollIconGap+e.iconSize),t.left=e.startX+"px",t.top=e.startY+"px",t.width=g+"px",t.height=e.iconSize+"px",$("#"+a).css(t),e.id=a,e.mouseDown=!1,e.fnNotify=n,$("#"+a).data("scrollData",e),l(a,i=a+"-iconL"),c(a,m=a+"-canvas"),d=0,r="#"+i,s=En(e.iconL),$(r).css("background",s),$(r).css("top","0px"),$(r).css("left",d+"px"),$(r).css("width",e.iconSize+"px"),$(r).css("height",e.iconSize+"px"),$(r).css("position","absolute"),d+=e.iconSize,d+=Ce.scrollIconGap,r="#"+m,u=e.length+Ce.scrollTickH,p=e.iconSize,$(r).css("top","0px"),$(r).css("left",d+"px"),$(r).css("width",u+"px"),$(r).css("height",p+"px"),$(r).css("position","absolute"),$(r).attr("width",u),$(r).attr("height",p),d+=u,void 0!==e.iconR&&(l(a,i=a+"-iconR"),d+=Ce.scrollIconGap,r="#"+i,s=En(e.iconR),$(r).css("background",s),$(r).css("top","0px"),$(r).css("left",d+"px"),$(r).css("width",e.iconSize+"px"),$(r).css("height",e.iconSize+"px"),$(r).css("position","absolute")),ae(a),r="#"+m,b=$("#"+a).data("scrollData"),$(r).on("mousedown",(function(e){h.left===e.which&&(b.mouseDown=!0,te(e),kn(I.scrollBar,f.click,e))})).on("mousemove",(function(e){b.mouseDown&&te(e)})).on("mouseup",(function(){h.left===event.which&&(b.mouseDown=!1)})).on("mouseout",(function(){h.left===event.which&&(b.mouseDown=!1)})).on("touchstart",(function(e){Ja(e)})).on("touchmove",(function(e){Ja(e)})).on("touchend",(function(){Ja(event)})).on("touchcancel",(function(){Ja(event)}))}(e,t,a,r,n),oe(r)}function se(e){$n()}if(void 0===le)var le={move:0,trAnchor:1,tlAnchor:2,brAnchor:3,blAnchor:4,down:5};function de(){var e,t,o,a={dispX:0,dispY:0,dispW:0,dispH:0,imgSrc:0,isActive:!1,x:0,y:0,w:0,h:0,mouseDown:!1,type:le.down,startX:0,startY:0};$("#importPictureWin").data("picData",a),e=Ce.ipwRadius,t={position:"absolute",left:e+"px",top:e+"px",width:"calc(100% - "+2*e+"px)",height:"calc(100% - "+2*e+"px)",opacity:Ce.ipwOpacity},c("importPictureWin","importPicture"),$("#importPicture").css(t),he("importPicture",le.move),$("#importPictureWin").on("dblclick",(function(e){ye(!0)})),o=Ce.ipwRadiusExpandRatio,(o=Math.floor(o))<1&&(o=1),Oa.ipwRadiusExpandRatio=o,ue("tlAnchor",le.tlAnchor),ue("trAnchor",le.trAnchor),ue("blAnchor",le.blAnchor),ue("brAnchor",le.brAnchor),ve(!1)}function ue(e,t){var o,a,n,i,r,s="#"+e,l=Ce.ipwRadius;switch(r=(i=2*l)*((n=Oa.ipwRadiusExpandRatio)-1)/2,Oa.ipwExtraSpace=r,c("importPictureWin",e),t){case le.trAnchor:o="calc(100% - "+(i+r)+"px)",a=-r+"px";break;case le.tlAnchor:o=-r+"px",a=-r+"px";break;case le.brAnchor:o="calc(100% - "+(i+r)+"px)",a="calc(100% - "+(i+r)+"px)";break;case le.blAnchor:o=-r+"px",a="calc(100% - "+(i+r)+"px)"}var d={position:"absolute",left:o,top:a,width:(i*=n)+"px",height:i+"px",opacity:Ce.ipwOpacity};$(s).css(d),$(s).attr("width",i),$(s).attr("height",i);var u=2*Math.PI,p=document.getElementById(e).getContext("2d");p.fillStyle=Ce.ipwColor,p.strokeStyle=Ce.ipwColor,p.lineWidth=Ce.ipwLineWidth,p.beginPath(),p.arc(l+r,l+r,l,0,u,!1),p.closePath(),p.fill(),he(e,t)}var pe=!1;function ge(){var e=Oa.curMode.imgW/Ge,t="#importPictureWin",o=$(t).data("picData");o.x=($(t).offset().left-Ue)*e,o.y=($(t).offset().top-Ve)*e,o.w=$(t).width()*e,o.h=$(t).height()*e,o.dispX=$(t).offset().left-Ue,o.dispY=$(t).offset().top-Ve,o.dispW=$(t).width(),o.dispH=$(t).height()}function me(e,t){var o=$("#importPictureWin").data("picData"),a=t.clientX-o.startX,n=t.clientY-o.startY,i=o.dispX,r=o.dispY,c=o.dispW,s=o.dispH;switch(e){case le.trAnchor:c+=a,r+=n,s-=n;break;case le.tlAnchor:i+=a,c-=a,r+=n,s-=n;break;case le.brAnchor:c+=a,s+=n;break;case le.blAnchor:i+=a,c-=a,s+=n}var l={left:Ue+i,top:Ve+r,width:c,height:s};$("#importPictureWin").css(l)}function fe(e){var t=$("#importPictureWin").data("picData"),o=e.clientX-t.startX,a=e.clientY-t.startY,n={left:Ue+t.dispX+o,top:Ve+t.dispY+a};$("#importPictureWin").css(n)}function he(e,t){var o="#importPictureWin",a=$(o).data("picData");Oa.curMode,Ce.ipwRadius;o="#"+e,$(o).on("mousedown",(function(e){h.left===e.which&&function(e,t){var o,a,n=2*Ce.ipwRadius,i=Oa.ipwExtraSpace;return le.move==t||(o=e.offsetX,a=e.offsetY,o>=i&&o<i+n&&a>=i&&a<i+n)}(e,t)&&(a.mouseDown=!0,a.startX=e.clientX,a.startY=e.clientY,a.type=t,pe=!0)})).on("dblclick",(function(e){ye(!0)})).on("mousemove",(function(e){if(a.mouseDown)switch(a.type){case le.move:fe(e);break;case le.trAnchor:case le.tlAnchor:case le.brAnchor:case le.blAnchor:me(a.type,e)}})).on("mouseup",(function(e){h.left===e.which&&(a.mouseDown=!1,ge(),pe=!1)})).on("mouseout",(function(e){h.left,e.which})).on("touchstart",(function(e){Ja(e)})).on("touchmove",(function(e){Ja(e)})).on("touchend",(function(e){Ja(e)})).on("touchcancel",(function(e){Ja(e)}))}function be(e){var t,o,a=Oa.curMode,n="#importPictureWin",i=Ce.ipwRadius;t=e.width,o=e.height;var r=200;t<r&&(o=o*r/t,t=r),o<r&&(t=t*r/o,o=r);var c,s,l,d,u=a.imgW-2*i,p=a.imgH-2*i;t>u&&(o=o*u/t,t=u),o>p&&(t=t*p/o,o=p),e.width,e.height,l=t+2*i,d=o+2*i,c=(a.imgW-l)/2,s=(a.imgH-d)/2;var g=$(n).data("picData");g.imgSrc=e,g.dispW=Ge,g.dispH=qe,g.x=c,g.y=s,g.w=l,g.h=d,g.isActive=!0,we(),n="#importPicture",$(n).attr("width",e.width),$(n).attr("height",e.height),document.getElementById("importPicture").getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height),ve(!0)}function ve(e){var t=$("#importPictureWin").data("picData");m("importPictureWin",e),t.isActive=e}function we(){var e,t,o,a,n,i=$("#importPictureWin").data("picData"),r=Oa.curMode;if(void 0!==i&&0!=i.isActive){n=Ge/r.imgW,e=i.x*n,t=i.y*n,o=i.w*n,a=i.h*n;var c={position:"absolute",left:Ue+e,top:Ve+t,width:o,height:a,opacity:Ce.ipwOpacity};$("#importPictureWin").css(c),i.dispX=e,i.dispY=t,i.dispW=o,i.dispH=a}}function ye(e){if(e){var t=$("#importPictureWin").data("picData"),o=Oa.curMode,a=Oa.drawContext,n=Ce.ipwRadius*o.imgW/Ge;0!=t.isActive&&(pn(),a.drawImage(t.imgSrc,0,0,t.imgSrc.width,t.imgSrc.height,t.x+n,t.y+n,t.w-2*n,t.h-2*n),yn(b.end),o.imageProcess&&o.imageProcess(),ve(!1),so&&attachCropBox(Ge,qe))}else ve(!1)}const Ie="Documate";var xe={resizeDelayMs:100,iconW:48,iconH:48,drawSetH:30,ColorEnter:"#2874A6",ColorLeave:"#154360",ColorClick:"#1F618D",ColorHide:"#000",OpacityEnter:"1.0",OpacityLeave:"1.0",OpacityClick:"1.0",OpacityHide:"0",resolutionIdx:-1},Ce={cfgVersion:"1.5.0",bgColor:"#808080",titleIconH:xe.iconH,toolBarIconW:xe.iconW,toolBarIconH:xe.iconH,modeIconW:100,modeIconH:xe.iconH,mouseColorEnter:xe.ColorEnter,mouseColorLeave:xe.ColorLeave,mouseColorClick:xe.ColorClick,mouseOpacityEnter:xe.OpacityEnter,mouseOpacityLeave:xe.OpacityLeave,mouseOpacityClick:xe.OpacityClick,drawSetH:xe.drawSetH,drawSetBackground:xe.ColorLeave,drawSetOpacity:xe.OpacityLeave,colorIconW:30,colorIconH:xe.drawSetH,colorIconMarginClick:3,colorIconMarginNormal:6,colorIconMarginOver:4,colorIconOpacity:"1.0",cb2Apply:1,cb2BlockW:30,cb2BlockH:xe.drawSetH,cb2FrameGap:6,cb2MouseColorEnter:xe.ColorEnter,cb2MouseColorLeave:xe.ColorLeave,cb2MouseColorClick:xe.ColorClick,scrollIconW:30,scrollIconH:xe.drawSetH,scrollIconGap:0,scrollTickH:12,scrollLineH:2,scrollColor:"#F8F9F9",scrollGroupGap:8,scrollOpacityW:90,scrollOpacityDefPos:80,scrollLineWidthW:90,scrollLineWidthDefPos:30,lineWidthMin:4,lineWidthMax:40,scrollDlgBkg:xe.ColorLeave,scrollDlgOpacity:xe.OpacityLeave,scrollBrighnessW:180,scrollBrighnessDefPos:90,brightnewwMin:-128,brightnewwMax:128,whiteBalanceMin:-25,whiteBalanceMax:25,scrollZoomW:180,scrollZoomDefPos:0,zoomMaxRatio:8,panWinGapX:4,panWinGapY:4,panWinColor:xe.ColorLeave,panCropColor:"#555",panOpacity:xe.OpacityLeave,sdBkg:xe.ColorLeave,sdOpacity:xe.OpacityLeave,sdIconW:xe.iconW,sdIconH:xe.iconH,sdExtraW:14,sdIconScrollGap:4,sdGroupGap:0,sdScrollGap:8,sdFrameGapX:4,sdFrameGapY:4,sdScrollH:30,sdVideoRsoW:120,sdFontFamilyW:100,sdFontStyleW:100,sdFontSizeW:40,tidBkg:xe.ColorLeave,tidOpacity:xe.OpacityLeave,tidIconW:xe.iconW,tidIconH:xe.iconH,tidTextFrmW:300,tidTextFrmH:200,tidFrameGap:8,tidIconFrmGap:4,tidTextSize:20,eraserOpacity:.8,minArrowSize:10,toolBarColorEnter:xe.ColorEnter,toolBarColorLeave:xe.ColorLeave,toolBarColorClick:xe.ColorClick,toolBarColorHide:xe.ColorHide,toolBarOpacityEnter:xe.OpacityEnter,toolBarOpacityLeave:xe.OpacityLeave,toolBarOpacityClick:xe.OpacityClick,toolBarOpacityHide:xe.OpacityHide,ipwColor:"#AAA",ipwOpacity:1,ipwLineWidth:6,ipwRadius:16,ipwRadiusExpandRatio:1,defPreviewRsoX:1280,defPreviewRsoY:720,defDrawingBoardW:1920,defDrawingBoardH:1080,drawingBoardBgColor:"#FFF",defPictureW:1920,defPictureH:1080,thumbW:160,thumbH:120,thumbPadding:10,thumbFrmSize:4,thumbFrmColorNormal:"#000",thumbFrmColorChecked:"#FF0",pbInfoW:240,pbInfoH:24,pbInfoColor:"#FF0",pbInfoColor_Page:"#FF0",pbInfoColor_Item:"#3F3",pbInfoFontSize:"150%",pbInfoFontWWeight:"normal",aboutWinW:400,aboutWinH:340,aboutBkg:"#154360",aboutOpacity:1,aboutIconW:xe.iconW,aboutIconH:xe.iconH,aboutGapX:30,pcdBkg:xe.ColorLeave,pcdOpacity:xe.OpacityLeave,pcdIconOverlayY:20,pcdIconW:xe.iconW,pcdIconH:xe.iconH,pcdTextW:80,pcdTextH:20,pcdUnitW:60,pcdUnitH:16,pcdUnitOffsetY:4,pcdExtraW:12,pcdCapturePeriodSec:1,pcdCaptureIntervalHour:1,pcibBkg:xe.ColorLeave,pcibOpacity:xe.OpacityLeave,pcibIconW:xe.iconW,pcibIconH:xe.iconH,pcibTextH:24,pcibTextW:120,pcibTextColor:"#2F2",pcibTextFontSize:"150%",pcidGapY:4,cdIconW:xe.iconW,cdIconH:xe.iconH,cdFrameGap:26,cdIconGap:10,cdBkg:xe.ColorLeave,cdOpacity:xe.OpacityLeave,cdMouseColorEnter:xe.ColorEnter,cdMouseColorLeave:xe.ColorLeave,cdMouseColorClick:xe.ColorClick,sysInfoWinW:88,sysInfoWinH:82,sysInfoH:16,sysInfoGap:4,disableDrawingCanvasOverlay:0,disableDrawingToolBar:0,disableColorBar:0,disableDrawingOpacityScrollBar:0,disableDrawingLineWidthScrollBar:0,disableDrawTextSetting:0},$e=[["sys_fullPhoto","fullPhoto.png",0,1],["btn_freehand","freeHand.png",0,1],["btn_arrow","arrow.png",0,1],["btn_eraser","ereser.png",0,1],["btn_line","line.png",0,1],["btn_rectangleLine","rectangleLine.png",0,1],["btn_rectangle","rectangle.png",0,1],["btn_circleLine","circleLine.png",0,1],["btn_circle","circle.png",0,1],["btn_erase_all","clearAll.png",0,0],["btn_text","text.png",0,1],["btn_configDraw","config.png",0,0]],Be=[],Se=[],We=[["btn_setting","setting.png",0,0],["btn_capture","capture.png",0,0],["btn_record","record2.png",0,0],["btn_freeze","Freeze.png",0,3],["btn_timesave","timesave.png",0,0],["btn_mirrow","mirrow.png",0,5],["btn_flip","flip.png",0,6],["btn_config","config.png",0,0],["btn_zoom","zoom.png",0,0],["btn_importPic","inportPic.png",0,0],["btn_redo","redo.png",0,0],["btn_undo","undo.png",0,0]],_e=[["scbtn_transform","perspectiveImage.png",0,0],["scbtn_importPic","inportPic.png",0,0],["Dummy","dummy.png",0,0],["scbtn_fullcrop","fullPhoto.png",0,6],["scbtn_redo","redo.png",0,0],["scbtn_undo","undo.png",0,0]],ke=[["scbtn_preview","backScanMode.png",0,0],["scbtn_saveDisk","savePlayback.png",0,0],["scbtn_ocr","ocr.png",0,0],["Dummy","dummy.png",0,0],["scbtn_mirrow","mirrow.png",0,5],["scbtn_flip","flip.png",0,6],["scbtn_redo2","redo.png",0,0],["scbtn_undo2","undo.png",0,0]],Te=[["mscbtn_capture","perspectiveImage.png",0,0],["mscbtn_merge","Merge_multiscan.png",0,0],["mscbtn_cancel","close.png",0,0],["Dummy","dummy.png",0,0],["mscbtn_fullcrop","fullPhoto.png",0,6]],De=[["mode_about","about.png",0,0],["mode_preview","preview.png",1,1],["mode_playback","playback.png",0,1],["mode_drawingBoard","drawingboard.png",0,1]],He=[["sys_fullPhoto0","fullPhoto.png",0,1]],Me=[["btn_saveDisk","saveDisk.png",0,0],["btn_delete","delete.png",0,0],["Dummy","dummy.png",0,0],["btn_Next","next_page.png",0,0],["btn_Previous","previous_page.png",0,0]],Pe=[["ppbtn_savePlayback","savePlayback.png",0,0],["ppbtn_closeAndBackPlayback","closeAndBackPlayback.png",0,0],["ppbtn_zoom","zoom.png",0,0],["ppbtn_importPic","inportPic.png",0,0],["ppbtn_redo","redo.png",0,0],["ppbtn_undo","undo.png",0,0]],ze=[["dbbtn_savePlayback","savePlayback.png",0,0],["dbbtn_redo","redo.png",0,0],["dbbtn_undo","undo.png",0,0],["dbbtn_importPic","inportPic.png",0,0]],Fe=[["782D91",0],["1B1464",0],["0000FF",1],["00FF00",0],["FFFF00",0],["F15A24",0],["FF0000",0],["FFFFFF",0],["999999",0],["000000",0]],Re=[],Ae=[["Arial",1],["Serif",0],["Verdana",0],["Courier New",0]],Ee=[["lbNormal",1],["lbBold",0],["lbItalic",0],["lbBoldItalic",0]],Le=[["English",1,"./locales/en/messages.json"],["Deutsch",0,"./locales/de/messages.json"],["Française",0,"./locales/fr/messages.json"],["Español",0,"./locales/es/messages.json"],["日本語",0,"./locales/jp/messages.json"],["繁體中文",0,"./locales/zh_TW/messages.json"],["Русский",0,"./locales/ru/messages.json"],["한국어",0,"./locales/ko/messages.json"],["Italiano",0,"./locales/it/messages.json"],["简体中文",0,"./locales/sc/messages.json"]],Oe=[[8,0],[12,0],[16,0],[20,0],[24,0],[28,1],[36,0],[48,0],[72,0]];var Ye,Xe,Ge,qe,Ue,Ve,Ne,je,Ze,Ke=[[1280,720,1],[1024,768,0]],Je=[[1920,1080,0],[1280,720,1],[1024,768,0]],Qe=[[1920,1080,0],[1280,720,1],[1024,768,0]],et=[[1920,1080,0],[1280,720,1],[1024,768,0]],tt=[[4160,3120,0],[3840,2160,0],[2048,1536,0],[1920,1080,0],[1280,1024,0],[1280,960,0],[1280,720,1],[1024,768,0],[640,480,0]],ot=[[3264,2448,0],[2592,1944,0],[2048,1536,0],[1920,1080,0],[1600,1200,0],[1280,960,0],[1280,720,1],[1024,768,0]],at=[[1920,1080,0],[1280,720,1],[1024,768,0]],nt=[[0,0,at],[1276,21264,Ke],[1276,21296,Ke],[1276,21305,Ke],[1276,25392,Je],[1276,25401,Je],[1276,25424,Qe],[1276,25433,Qe],[1276,25856,et],[1276,25865,et],[1276,34185,tt],[4429,34185,tt],[1276,9760,ot],[1276,9856,ot],[1276,8329,[[2592,1944,0],[2048,1536,0],[1920,1080,0],[1600,1200,0],[1280,960,0],[1280,720,1],[1024,768,0]]],[1276,9864,[[3840,3104,0],[3840,2160,0],[3264,2448,0],[2592,1944,0],[2048,1536,0],[1920,1080,0],[1600,1200,0],[1280,720,1],[1024,768,0]]],[1276,9808,[[2560,1920,0],[2560,1440,0],[2048,1536,0],[1920,1080,0],[1600,1200,0],[1280,960,0],[1280,720,1],[1024,768,0]]]];function it(e,t,o){var a={position:"absolute",left:0,top:0,width:t,height:o,display:!1},n="#"+e;$(n).css(a),$(n).attr("width",t),$(n).attr("height",o)}function rt(e,t,o,a){c(e,t),it(t,o,a)}function ct(e){var t,o,a=["WebGL","baseImageCanvas","imageProcessCanvas","drawingCanvas","tempDrawingCanvas","combineCanvas"];for(t=0;t<a.length;t++)o=e+"-"+a[t],document.getElementById(o).hidden=!0}function st(e,t,o){var a,n=["WebGL","baseImageCanvas","imageProcessCanvas","drawingCanvas","tempDrawingCanvas","combineCanvas"];for(a=0;a<n.length;a++)rt(e,e+"-"+n[a],t,o)}function lt(e,t,o){let a,n;const i=["WebGL","baseImageCanvas","imageProcessCanvas","drawingCanvas","tempDrawingCanvas","combineCanvas"];for(n=0;n<i.length;n++)a=e.baseId+"-"+i[n],it(a,t,o)}function dt(e){var t,o,a=["baseImageCanvas","imageProcessCanvas","drawingCanvas","tempDrawingCanvas","combineCanvas"],n=["baseImageContext","imageProcessContext","drawingContext","tempDrawingContext","combineContext"];for(o=0;o<a.length;o++)t=e.baseId+"-"+a[o],e[a[o]]=document.getElementById(t),e[n[o]]=e[a[o]].getContext("2d")}!function(e,t){let o=document.createElement(e);o.id=t,document.body.appendChild(o)}("div","baseArea"),s("baseArea","appTitle"),s("baseArea","previewArea"),r("video","previewArea","videoSrc"),st("previewArea",Ce.defPreviewRsoX,Ce.defPreviewRsoY),s("baseArea","playbackArea"),st("playbackArea",Ce.defPictureW,Ce.defPictureH),s("baseArea","drawingArea"),st("drawingArea",Ce.defDrawingBoardW,Ce.defDrawingBoardH),s("baseArea","imageDisplayArea"),c("imageDisplayArea","displayCanvas"),c("imageDisplayArea","saveFileCanvas"),s("baseArea","uiArea"),l("uiArea","importPictureWin"),s("uiArea","drawingCfgArea"),Ne={position:"absolute","margin-left":"0px",background:Ce.drawSetBackground,opacity:Ce.drawSetOpacity},je=Ce.toolBarIconW,Ze=Ce.drawSetH,Ne.width="calc(100% - "+2*je+"px)",Ne.height=Ze+"px",Ne.left=je+"px",Ne.top="calc(100% - "+Ze+"px)",$("#drawingCfgArea").css(Ne),l("uiArea","panWin"),c("panWin","cropWin"),l("uiArea","settingDlg"),l("uiArea","textInputDlg"),Ye=document.getElementById("displayCanvas"),Xe=Ye.getContext("2d"),ct("previewArea"),ct("playbackArea"),ct("drawingArea"),m("saveFileCanvas",!1);var ut={position:"absolute",left:0,top:0,width:800,height:260,style:"border:1px dashed black",background:Ce.bgColor};function pt(){var e,t,o,a,n,i,r;oo?(t=en,o=tn):(t=en-2*xe.iconW,o=tn-on-xe.drawSetH),t*Oa.imgH<o*Oa.imgW?(i=t,a=(en-t)/2,r=Math.floor(i*Oa.imgH/Oa.imgW),n=Math.floor((o-r)/2)):(r=o,n=0,i=Math.floor(r*Oa.imgW/Oa.imgH),a=Math.floor((t-i)/2),oo||(a+=xe.iconW)),oo||(n+=on),ut.left=a,ut.top=n,ut.width=i,ut.height=r,(e=$("#displayCanvas")).css(ut),e.attr("width",i),e.attr("height",r),Ue=a,Ve=n,Ge=i,qe=r}var gt,mt,ft=[];function ht(e,t){m(e,t)}function bt(e,t,o,a){Oa.colorHex=e,Oa.colorR=t,Oa.colorG=o,Oa.colorB=a,bn()}function vt(e,t,o,a,n){l(t,o);var i=o+"-iconL";l(o,i);var r=e.startX;d="#"+i;var c=En(e.iconL);$(d).css("background",c),$(d).css("top","0px"),$(d).css("left",r+"px"),$(d).css("width",e.iconSize+"px"),$(d).css("height",e.iconSize+"px"),$(d).css("position","absolute"),r+=e.iconSize;var s=o+"-slider";p(t=o,s);var d="#"+s;$(d).attr("class","slider_min"),$(d).css({top:0,left:r,width:"100px",height:"30px",position:"absolute"}),$(d).attr({type:"range",max:100,min:0,step:2,value:n});d="#"+s;$(d).on("input",a),a(n)}function wt(){var e={position:"absolute","margin-left":"0px"};ce({iconL:"brightness_down.png",iconR:"brightness_up.png",iconSize:Ce.toolBarIconW,length:Ce.scrollBrighnessW,curPos:Ce.scrollBrighnessDefPos,startX:0,startY:0,color:Ce.scrollColor},e,"uiArea","brightnessDlg",xt,!0),yt(!1),ce({iconL:"wb_b.png",iconR:"wb_r.png",iconAuto:"undo.png",iconSize:Ce.toolBarIconW,length:Ce.scrollBrighnessW,curPos:Ce.scrollBrighnessDefPos,startX:0,startY:0,color:Ce.scrollColor},e,"uiArea","whiteBalanceDlg",Ct,!0),It(!1),function(){var e,t,o="zoomDlg",a=24,n=36,i=380,r=120;s("uiArea",o),e="#"+o,$(e).css("background",xe.ColorLeave),$(e).css("top","calc(50%)"),$(e).css("left",Ce.toolBarIconW+"px"),$(e).css("width",i+"px"),$(e).css("height",r+"px"),$(e).css("position","absolute"),$(e).hide(),l(o,e=o+"-close"),e="#"+e;var c=En("close.png");$(e).css("background",c),$(e).css("top","0px"),$(e).css("left",i-Ce.toolBarIconW+"px"),$(e).css("width",Ce.toolBarIconW+"px"),$(e).css("height",Ce.toolBarIconH+"px"),$(e).css("position","absolute"),$(e).on("click",(function(){$("#"+o).hide()})),t=function(e,t,o,a,n,i){var r;l(e,r=t+"-icon-L"),r="#"+r,$(r).css({background:En(o),top:i,left:n,width:Ce.toolBarIconW+"px",height:Ce.toolBarIconH+"px",position:"absolute"}),l(e,r=t+"-icon-R"),r="#"+r,$(r).css({background:En(a),top:i,left:n+Ce.toolBarIconW+16+200+16,width:Ce.toolBarIconW+"px",height:Ce.toolBarIconH+"px",position:"absolute"});var c=t+"-slider";return p(e,c),r="#"+c,$(r).attr("class","slider"),$(r).css({top:i,left:n+Ce.toolBarIconW+16,width:"200px",height:Ce.toolBarIconH+"px",position:"absolute"}),c}(o,e=o+"-zoom","zoom_in.png","zoom_out.png",a,n),e="#"+t,$(e).attr({type:"range",max:100,min:0,step:2,value:0}),$(e).on("input",(function(e){var t=1+(Ce.zoomMaxRatio-1)*e.currentTarget.value/100;t=t.toFixed(1),Oa.curMode&&Yn(t,e.currentTarget.value)}))}()}function yt(e){m("brightnessDlg",e)}function It(e){m("whiteBalanceDlg",e)}function xt(e,t){}function Ct(e,t){}function $t(){var e,t,o,a,n,i,r,c,s,l,u,p={position:"absolute","margin-left":"0px",background:Ce.sdBkg,opacity:Ce.sdOpacity},g=5;1===Ce.disableDrawTextSetting&&(g=1),e=2*Ce.sdFrameGapX+Ce.sdIconW+Ce.sdIconScrollGap+Ce.sdFontFamilyW+Ce.sdFontStyleW+Ce.sdFontSizeW+2*Ce.sdScrollGap,e+=Ce.sdExtraW,t=Ce.sdFrameGapY*g+Ce.sdIconH*(g+1)+Ce.sdGroupGap,p.left="calc(50% - "+e/2+"px)",p.top="calc(50% - "+(t-Ce.titleIconH)/2+"px)",p.width=e+"px",p.height=t+"px",$("#settingDlg").css(p),o=e-Ce.sdFrameGapX-Ce.sdIconW,a=Ce.sdFrameGapY,a=+Ce.sdIconH,Bt("settingDlg","sdVideoRsoIcon","setting_reslution.png",o=Ce.sdFrameGapX,a),o+=Ce.sdIconW+Ce.sdIconScrollGap,n="settingDlg",i="sdVideoRsoScrollbar",r=Oa.curVideoResolutionList,c=o,s=a,l=Ce.sdVideoRsoW,Oa.idVideoResolutionList=i,d(n,i),Wt(r),u="#"+i,$(u).css("top",s+(Ce.sdIconH-Ce.sdScrollH)/2+"px"),$(u).css("left",c+"px"),$(u).css("width",l+"px"),$(u).css("height",Ce.sdScrollH+"px"),$(u).css("position","absolute"),a+=Ce.sdIconH+Ce.sdGroupGap,Bt("settingDlg","sdVideoinputIcon","setting_videoinput.png",o=Ce.sdFrameGapX,a),o+=Ce.sdIconW+Ce.sdIconScrollGap,function(e,t,o,a,n,i){var r;Oa.idVideoinputSelect=t,d(e,t),r="#"+t,$(r).css("top",n+(Ce.sdIconH-Ce.sdScrollH)/2+"px"),$(r).css("left",a+"px"),$(r).css("width",2*i+Ce.sdIconScrollGap+"px"),$(r).css("height",Ce.sdScrollH+"px"),$(r).css("position","absolute")}("settingDlg","sdVideoinputScrollbar",Oa.curVideopinputList,o,a,Ce.sdVideoRsoW),a+=Ce.sdIconH+Ce.sdGroupGap,Bt("settingDlg","sdAudioinputIcon","setting_audioinput.png",o=Ce.sdFrameGapX,a),o+=Ce.sdIconW+Ce.sdIconScrollGap,function(e,t,o,a,n,i){var r;Oa.idAudioinputSelect=t,d(e,t),r="#"+t,$(r).css("top",n+(Ce.sdIconH-Ce.sdScrollH)/2+"px"),$(r).css("left",a+"px"),$(r).css("width",2*i+Ce.sdIconScrollGap+"px"),$(r).css("height",Ce.sdScrollH+"px"),$(r).css("position","absolute")}("settingDlg","sdAudioinputScrollbar",Oa.curAudioinputList,o,a,Ce.sdVideoRsoW),a+=Ce.sdIconH+Ce.sdGroupGap,0===Ce.disableDrawTextSetting&&(Bt("settingDlg","sdFontIcon","setting_textEdit.png",o=Ce.sdFrameGapX,a),o+=Ce.sdIconW+Ce.sdIconScrollGap,_t("settingDlg","sdfontFamily",Ae,o,a,Ce.sdFontFamilyW),o+=Ce.sdFontFamilyW+Ce.sdScrollGap,function(e,t,o,a,n,i){var r,c,s,l="";for(d(e,t),l="",r=0;r<o.length;r++)c=t+"-"+o[r][w.value],s="WebMod",l+="<option"+(1===o[r][w.status]?' selected="true"':"")+' id="'+c+'">'+s+"</option>";$("#"+t).html(l),c="#"+t,$(c).css("top",n+(Ce.sdIconH-Ce.sdScrollH)/2+"px"),$(c).css("left",a+"px"),$(c).css("width",i+"px"),$(c).css("height",Ce.sdScrollH+"px"),$(c).css("position","absolute")}("settingDlg","fontStyle",Ee,o,a,Ce.sdFontStyleW),o+=Ce.sdFontStyleW+Ce.sdScrollGap,_t("settingDlg","fontSize",Oe,o,a,Ce.sdFontSizeW),a+=Ce.sdIconH+Ce.sdGroupGap),Bt("settingDlg","sdLanguageIcon","setting_language.png",o=Ce.sdFrameGapX,a),o+=Ce.sdIconW+Ce.sdIconScrollGap,function(e,t,o,a,n,i){var r,c,s,l="";for(d(e,t),l="",r=0;r<o.length;r++)c=t+"-"+o[r][w.value],s=o[r][w.value],l+="<option"+(1===o[r][w.status]?' selected="true"':"")+' id="'+c+'">'+s+"</option>";$("#"+t).html(l),c="#"+t,$(c).css("top",n+(Ce.sdIconH-Ce.sdScrollH)/2+"px"),$(c).css("left",a+"px"),$(c).css("width",i+"px"),$(c).css("height",Ce.sdScrollH+"px"),$(c).css("position","absolute")}("settingDlg","sdLanguageFamily",Le,o,a,Ce.sdFontFamilyW),kt(!1),Wn()}function Bt(e,t,o,a,n){var i,r;l(e,t),i="#"+t,r=En(o),$(i).css("background",r),$(i).css("top",n+"px"),$(i).css("left",a+"px"),$(i).css("width",Ce.sdIconW+"px"),$(i).css("height",Ce.sdIconH+"px"),$(i).css("position","absolute")}function St(e){var t;t="#"+Oa.idVideoResolutionList,$(t+" > option").remove(),Wt(e)}function Wt(e){var t,o,a,n,i,r="";for(i=Oa.idVideoResolutionList,r="",t=0;t<e.length;t++)o=i+"-"+e[t][v.w]+"x"+e[t][v.h],a=e[t][v.w]+" x "+e[t][v.h],-1==xe.resolutionIdx||xe.resolutionIdx>=e.length?1===e[t][v.data]?(n=' selected="true"',Oa.reqImgW=e[t][v.w],Oa.reqImgH=e[t][v.h]):n="":t==xe.resolutionIdx?(n=' selected="true"',Oa.reqImgW=e[t][v.w],Oa.reqImgH=e[t][v.h]):n="",r+="<option"+n+' id="'+o+'">'+a+"</option>";$("#"+i).html(r)}function _t(e,t,o,a,n,i){var r,c,s,l="";for(d(e,t),l="",r=0;r<o.length;r++)c=t+"-"+o[r][w.value],s=o[r][w.value],l+="<option"+(1===o[r][w.status]?' selected="true"':"")+' id="'+c+'">'+s+"</option>";$("#"+t).html(l),c="#"+t,$(c).css("top",n+(Ce.sdIconH-Ce.sdScrollH)/2+"px"),$(c).css("left",a+"px"),$(c).css("width",i+"px"),$(c).css("height",Ce.sdScrollH+"px"),$(c).css("position","absolute")}function kt(e){m("settingDlg",e)}function Tt(){var e,t,o,a,n,i;e=Ce.tidFrameGap+Ce.tidTextFrmW+Ce.tidFrameGap,t=Ce.tidFrameGap+Ce.tidIconH+Ce.tidIconFrmGap+Ce.tidTextFrmH+Ce.tidFrameGap,o="#textInputDlg",$(o).css("top","calc(50% - "+(t-Ce.titleIconH)/2+"px)"),$(o).css("left","calc(50% - "+e/2+"px)"),$(o).css("width",e+"px"),$(o).css("height",t+"px"),$(o).css("position","absolute"),$(o).css("background",Ce.tidBkg),$(o).css("opacity",Ce.tidOpacity),l("textInputDlg","textInputClose"),o="#textInputClose",i=En("yes.png"),a=e-Ce.tidFrameGap-Ce.tidIconW,n=Ce.tidFrameGap,$(o).css("background",i),$(o).css("top",n+"px"),$(o).css("left",a+"px"),$(o).css("width",Ce.tidIconW+"px"),$(o).css("height",Ce.tidIconH+"px"),$(o).css("position","absolute"),$(o).on("click",Mo),r("textarea","textInputDlg","textInputArea"),o="#textInputArea",a=Ce.tidFrameGap,n=Ce.tidFrameGap+Ce.tidIconH+Ce.tidIconFrmGap,$(o).css("position","absolute"),$(o).css("resize","none"),$(o).css("top",n+"px"),$(o).css("left",a+"px"),$(o).css("width",Ce.tidTextFrmW+"px"),$(o).css("height",Ce.tidTextFrmH+"px"),$(o).css("padding","0px"),$(o).attr("cols",Ce.tidTextFrmW),$(o).attr("rows",Ce.tidTextFrmH),Dt(!1)}function Dt(e){m("textInputDlg",e),e&&setTimeout((function(){$("#textInputArea").focus()}),300)}function Ht(){return document.getElementById("textInputArea").value.length}function Mt(){m("aboutDlg",!0)}function Pt(){m("aboutDlg",!1)}function zt(e,t,o,a,n,i,r){var c,s;c="#"+e,r&&(s=En(t),$(c).css("background",s)),$(c).css("top",a+"px"),$(c).css("left",o+"px"),$(c).css("width",n+"px"),$(c).css("height",i+"px"),$(c).css("position","absolute")}function Ft(e,t,o,a,n){l(e,t),zt(t,o,a,n,Ce.pcdIconW,Ce.pcdIconH,!0)}function Rt(e,t,o,a,n){g(e,t),zt(t,!1,o,a+Ce.pcdUnitOffsetY,Ce.pcdUnitW,Ce.pcdUnitH,!1),$("#"+t).css("text-align","right"),function(e,t){e=document.getElementById(e),Ln(e,t)}(t,n)}function At(e,t,o,a,n){var i="#"+t;p(e,t),zt(t,!1,o,a,Ce.pcdTextW,Ce.pcdTextH,!1),$(i).keydown((function(e){-1!==$.inArray(e.keyCode,[46,8])||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()})),$(i).attr("value",n),$(i).css("text-align","center")}function Et(e){m("periodicCaptureDlg",e)}function Lt(){var e,t,o,a;a=Math.min(Ve+qe,tn-Ce.drawSetH),e=Ce.pcibTextW+Ce.pcibIconW,t=Ce.pcibIconH,o="#periodicCaptureInfoBar",$(o).css("position","absolute"),$(o).css("background",Ce.pcibBkg),$(o).css("opacity",Ce.pcibOpacity),$(o).css("left","calc(50% - "+e/2+"px)"),$(o).css("top",a-t-Ce.pcidGapY+"px"),$(o).css("width",e+"px"),$(o).css("height",t+"px")}function Ot(){Oa.capturePeriodRun=!1,Yt(!1)}function Yt(e){m("periodicCaptureInfoBar",e)}function Xt(){var e,t,o;e=2*Ce.cdFrameGap+2*Ce.cdIconW+Ce.cdIconGap,t=2*Ce.cdFrameGap+Ce.cdIconH,o="#confirmDlg",$(o).css("position","absolute"),$(o).css("background",Ce.cdBkg),$(o).css("opacity",Ce.cdOpacity),$(o).css("left","calc(50% - "+e/2+"px)"),$(o).css("top","calc(50% - "+t/2+"px)"),$(o).css("width",e+"px"),$(o).css("height",t+"px")}function Gt(){var e,t,o="confirmDlg",a=o+"_yes",n=o+"_no";function i(e,t,a,n){var i,r;l(o,e),i="#"+e,r=En(t),$(i).css("background",r),$(i).css("left",a+"px"),$(i).css("top",n+"px"),$(i).css("width",Ce.cdIconW+"px"),$(i).css("height",Ce.cdIconH+"px"),$(i).css("position","absolute"),$(i).on("mousedown",(function(e){h.left===e.which&&($(i).css("background-color",Ce.cdMouseColorClick),function(e){var t,o="confirmDlg",a=o+"_yes";t=document.getElementById(o),t.clickHandler&&t.clickHandler(e==a)}(e.target.id))})).on("mousemove",(function(e){$(i).css("background-color",Ce.cdMouseColorEnter)})).on("mouseout",(function(){$(i).css("background-color",Ce.cdMouseColorLeave)}))}l("uiArea",o),Xt(),i(n,"no.png",e=Ce.cdFrameGap,t=Ce.cdFrameGap),i(a,"yes.png",e+=Ce.cdIconW+Ce.cdIconGap,t),qt(!1)}function qt(e){m("confirmDlg",e)}function Ut(e){document.getElementById("confirmDlg").clickHandler=e}function Vt(){var e=gt.files;e.length&&-1!=e[0].type.indexOf("image")&&function(e){var t=new Image;if(t.addEventListener("load",(function(){e.name,t.width,t.height,e.type,Math.round(e.size/1024);be(t)})),-1!=e.type.indexOf("tif")){var o=new FileReader;o.onload=function(e){var o=e.target.result,a=new Tiff({buffer:o}).toCanvas();a&&(t.src=a.toDataURL())},o.readAsArrayBuffer(e)}else t.src=window.URL.createObjectURL(e)}(e[0])}function Nt(){$("#imgInput").val(""),gt.click(),document.body.onfocus=function(){so&&setTimeout((function(){document.getElementById("importPictureWin").hidden&&attachCropBox(Ge,qe)}),200),document.body.onfocus=null}}function jt(){p("uiArea","imgInput"),(gt=document.getElementById("imgInput")).hidden=!0,gt.type="file",gt.accept=".jpg, .png, .jpeg, .bmp, .tif, .tiff|image/*",gt.onchange=Vt,ni()}function Zt(e,t,o,a){var n={x:0,y:0,w:0,h:0};return e*a<o*t?(n.w=e,n.x=0,n.h=Math.floor(n.w*a/o),n.y=Math.floor((t-n.h)/2)):(n.h=t,n.y=0,n.w=Math.floor(n.h*o/a),n.x=Math.floor((e-n.w)/2)),n}function Kt(e){var t;for(t=0;t<e.length;t++)e[t].fileEntrySub&&e[t].fileEntrySub.remove((function(){}),(function(){})),e[t].fileEntryOrg.remove((function(){}),(function(){})),$("#"+e[t].id).parent().remove();ni()}async function Jt(e,t){if(0!=e.length&&!(Jn.length<=0)){for(var o=0;o<Jn.length;o++)if(Jn[o].name==e[0].fileName){var a;a=-1!=Jn[o].name.indexOf("mp4")||-1!=Jn[o].name.indexOf("webm")?URL.createObjectURL(Jn[o].video):Jn[o].normalImage;const e=document.createElement("a");e.href=a,e.download=Jn[o].name,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(a);break}return}}$(document).on("webkitfullscreenchange",(function(){if(document.fullscreenElement)(mt=document.fullscreenElement).style.border="none";else{var e=Ce.thumbFrmSize+"px solid "+Ce.thumbFrmColorChecked;mt.style.border=e}}));var Qt,eo=-1;function to(){if(zi||(zi=document.getElementById("videoSrc")),Qt||(Qt=document.getElementById("previewArea-WebGL")),Ri){Vi.bindTexture(Vi.TEXTURE_2D,Ni),Vi.texImage2D(Vi.TEXTURE_2D,0,Vi.RGBA,Vi.RGBA,Vi.UNSIGNED_BYTE,zi),Vi.useProgram(Ki),Vi.bindBuffer(Vi.ARRAY_BUFFER,or),Vi.enableVertexAttribArray(Ji),Vi.vertexAttribPointer(Ji,2,Vi.FLOAT,!1,0,0),Vi.bindBuffer(Vi.ARRAY_BUFFER,ar),Vi.enableVertexAttribArray(Qi),Vi.vertexAttribPointer(Qi,2,Vi.FLOAT,!1,0,0),Vi.uniform1f(er,parseFloat(document.getElementById("configDlg-brightness-slider").value));const t=parseFloat(document.getElementById("configDlg-whiteBalence-slider").value);Vi.uniform3f(tr,t,1,2-t),Vi.clear(Vi.COLOR_BUFFER_BIT),Vi.drawArrays(Vi.TRIANGLES,0,6);var e=zi.currentTime;e&&e!==eo&&(eo=e,Fi=new Date,function(e){var t=Yo;if(t.freeze&&!ta){ea.width=Yo.imgW,ea.height=Yo.imgH,ea.getContext("2d").drawImage(e,0,0)}if(ta=t.freeze,function(){var e,t;if(0==Oa.frameRateInit){for(Oa.frameRateInit=!0,Oa.frameLastTime=new Date,Oa.frameSlotIdx=Oa.frameCnt,e=0;e<Oa.frameCnt;e++)Oa.frameInterval[e]=0;return}var o=new Date,a=o-Oa.frameLastTime,n=Oa.frameSlotIdx%Oa.frameCnt;for(Oa.frameLastTime=o,Oa.frameInterval[n]=a,t=0,e=0;e<Oa.frameCnt;e++)t+=Oa.frameInterval[e];Oa.frameRate=1e3*Oa.frameCnt/t,Oa.frameRate=Oa.frameRate.toFixed(2),0==n&&Rn();Oa.frameSlotIdx=n+1}(),t.freeze&&so)return;Qo[0]=1+Oa.previewBrightnessAdj/100+Oa.previewWhiteBalanceAdj/100,Qo[6]=1+Oa.previewBrightnessAdj/100,Qo[12]=1+Oa.previewBrightnessAdj/100-Oa.previewWhiteBalanceAdj/100;var o="",a=document.querySelector("#filter feColorMatrix");null!=a&&(Qo.forEach((e=>o+=e+" ")),a.setAttribute("values",o),t.baseImageContext.filter="url(#filter)");t.freeze?Jo(t.baseImageContext,ea):Jo(t.baseImageContext,e);aa()}(Qt))}requestAnimationFrame(to)}var oo=!1,ao=!1,no=0,io=0;function ro(e){oo=e,window.onresize(),Oa.showToolBar=!Oa.showToolBar,Ya(Oa.showToolBar),function(){var e;e=Oa.showToolBar?"btnHideFunctionIcon":"btnShowFunctionIcon";Vn("sys_fullPhoto",e)}(),rn()}function co(e){switch(e.target.id){case"sys_close":if(Ci)return _i(),void setTimeout((function(){co(e)}),1e3);1==chrome.app.window.current().isFullscreen()&&document.webkitCancelFullScreen(),window.close();break;case"sys_fullScreen":return document.body.clientWidth>=window.screen.width&&document.body.clientHeight>=window.screen.height-50&&!ao?($("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),document.webkitCancelFullScreen(),void window.resizeTo(840,660)):(ao?($("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),window.resizeTo(no,io)):(no=document.body.clientWidth,io=document.body.clientHeight,window.resizeTo(window.screen.width,window.screen.height)),void(ao=!ao));case"sys_fullPhoto0":ro(!oo);break;case"sys_smallScreen":if(Ci||Oa.capturePeriodRun)return $("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),$("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){Ci&&_i(),Oa.capturePeriodRun&&Ot(),chrome.windows.update(appID,{state:"minimized"}),$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Minimizing the window will stop taking pictures or videos. Continue?<br/> "),void $("#dialogSave").dialog("open");chrome.app.window.current().minimize()}}var so=!1,lo=!1,uo={freeze:!1,flip:!1,mirror:!1,zoomRatio:1,zoomX:0,zoomY:0,zoomW:0,zoomH:0,panWinW:0,panWinH:0,zoomScrollBarPos:0,previewRotate:0,canvas:null};function po(e){e.freeze=!1,e.flip=!1,e.mirror=!1,e.zoomRatio=1,e.zoomX=0,e.zoomY=0,e.zoomW=0,e.zoomH=0,e.panWinW=0,e.panWinH=0,e.zoomScrollBarPos=0,Oa.previewRotate=0}function go(e){if("mode_about"!=e.target.id){if(!$("#dialogSave").is(":visible")){if(Ci)return $("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){$(this).dialog("close"),_i(),setTimeout((function(){go(e)}),1e3)}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Will you stop recording?<br/> "),void $("#dialogSave").dialog("open");switch(Oa.curMode.baseId){case"playbackArea":"mode_about"!=e.target.id&&"mode_playback"!=e.target.id&&xa(Oa.curMode);break;case"previewArea":var t=Oa.curMode;if(1==Oa.capturePeriodRun)return $("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){$(this).dialog("close"),Ot(),setTimeout((function(){go(e)}),500)}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Discard Interval Timer Shooting?<br/> "),void $("#dialogSave").dialog("open");if("mode_preview"!=e.target.id&&Ot(),!so&&!lo){if("mode_preview"==e.target.id)return;o=t,uo.freeze=o.freeze,uo.flip=o.flip,uo.mirror=o.mirror,uo.zoomRatio=o.zoomRatio,uo.zoomX=o.zoomX,uo.zoomY=o.zoomY,uo.zoomW=o.zoomW,uo.zoomH=o.zoomH,uo.panWinW=o.panWinW,uo.panWinH=o.panWinH,uo.zoomScrollBarPos=o.zoomScrollBarPos,uo.previewRotate=Oa.previewRotate,null==uo.canvas&&(uo.canvas=document.createElement("canvas")),uo.canvas.width=o.baseImageCanvas.width,uo.canvas.height=o.baseImageCanvas.height,uo.canvas.getContext("2d").drawImage(o.baseImageCanvas,0,0),$("#captureHit").hide()}if(so&&(Po=!1,mn(t),$("#displayCanvas").css("transform","scale(1,1)"),z("scanToolBarS2",0),po(Yo)),lo&&Ro.length)return $("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),$("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){Ro=[],Lo(),$(this).dialog("close"),setTimeout((function(){go(e)}),300)}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Discard captured images?<br/> "),void $("#dialogSave").dialog("open");t.imageProcess&&t.imageProcess(),removeCropBox(),so=!1,lo=!1;break;case"drawingArea":z("drawingToolBar",0),Oa.fnDraw=null}var o;switch(e.target.id){case"mode_preview":!function(e){e.freeze=uo.freeze,e.flip=uo.flip,e.mirror=uo.mirror,e.zoomRatio=uo.zoomRatio,e.zoomX=uo.zoomX,e.zoomY=uo.zoomY,e.zoomW=uo.zoomW,e.zoomH=uo.zoomH,e.panWinW=uo.panWinW,e.panWinH=uo.panWinH,e.zoomScrollBarPos=uo.zoomScrollBarPos,Oa.previewRotate=uo.previewRotate}(Yo),Xa(Yo),uo.freeze&&(!function(e){null!=uo.canvas&&(e.baseImageContext.drawImage(uo.canvas,0,0),e.imageProcess())}(Yo),Yo.imageProcess());break;case"mode_playback":wa.curMode!=va.image&&ni(),Xa(wa);break;case"mode_drawingBoard":Xa(Ra);break;case"mode_about":Sn("mode_about",Mt,Pt);break;case"mode_scan":so=!0,mn(Yo),po(Yo),Yo.imageProcess(),Xa(Yo),fo(),ht(Oa.curMode.lToolBar,!1),ht(Oa.curMode.rToolBar,!1),ht(Oa.curMode.bToolBar,!1),ht(Oa.curMode.lS1ToolBar,!0),ht(Oa.curMode.lS2ToolBar,!1),ht(Oa.curMode.lMsToolBar,!1),zo=!1,attachCropBox(Ge,qe,!0),z("scanToolBarS1",0);break;case"mode_multiscan":lo=!0,po(Yo),Xa(Yo),fo(),ht(Oa.curMode.lToolBar,!1),ht(Oa.curMode.rToolBar,!1),ht(Oa.curMode.bToolBar,!1),ht(Oa.curMode.lMsToolBar,!0),ht(Oa.curMode.lS1ToolBar,!1),ht(Oa.curMode.lS2ToolBar,!1),zo=!1,attachCropBox(Ge,qe,!0),z("multiscanToolBar",0),Ro.length?Eo():Lo()}M(e)}}else Sn("mode_about",Mt,Pt)}if(void 0===mo)var mo={id:0,fn:1};function fo(){z("drawingToolBar",0),Oa.fnDraw=null}function ho(e){var t,o=[["btn_freehand",Io],["btn_arrow",xo],["btn_eraser",$o],["btn_line",Bo],["btn_rectangleLine",So],["btn_rectangle",Wo],["btn_circleLine",_o],["btn_circle",ko],["btn_text",To]],a=Oa.curMode;if("btn_erase_all"==e.target.id)un(a.drawingCanvas),gn(a),a.imageProcess&&a.imageProcess(),$n();else if("btn_configDraw"==e.target.id)$("#configDrawDlg").toggle(500);else if("sys_fullPhoto"==e.target.id)ro(!oo);else{for(t=0;t<o.length;t++)e.target.id==o[t][mo.id]&&(Oa.fnDraw=o[t][mo.fn]);$n()}M(e)}function bo(e,t,o,a){var n={x:0,y:0,w:0,h:0,centerX:0,centerY:0,endX:0,endY:0,regularX:0,regularY:0,regularSide:0};return n.x=Math.min(e,o),n.y=Math.min(t,a),n.w=Math.abs(o-e),n.h=Math.abs(a-t),n.centerX=n.x+n.w/2,n.centerY=n.y+n.h/2,n.endX=n.x+n.w,n.endY=n.y+n.h,n.regularX=n.x,n.regularY=n.y,n.w>n.h?(n.regularSide=n.h,n.regularX!==e&&(n.regularX=e-n.regularSide)):(n.regularSide=n.w,n.regularY!==t&&(n.regularY=t-n.regularSide)),n}function vo(e,t,o,a,n){var i,r;t=(i=bo(t,o,a,n)).x,o=i.y,r=i.centerX,i.centerY,a=i.endX,n=i.endY,e.moveTo(r,o),e.bezierCurveTo(a,o,a,n,r,n),e.bezierCurveTo(t,n,t,o,r,o)}var wo=0,yo=new Array;function Io(e){var t=Oa.drawContext;switch(e){case b.start:pn(),t.strokeStyle=Oa.drawStyle,t.lineWidth=Oa.lineWidth,yo.push({x:Oa.drawStartX,y:Oa.drawStartY}),yo.push({x:Oa.drawStartX,y:Oa.drawStartY}),yo.push({x:Oa.drawStartX,y:Oa.drawStartY});break;case b.move:if(0==yo.length)return;if((n=new Date).getTime()-wo<10)break;wo=n.getTime(),yo.push({x:Oa.drawCurX,y:Oa.drawCurY}),t.clearRect(0,0,Oa.drawCanvas.width,Oa.drawCanvas.height),t.moveTo(yo[0].x,yo[0].y),t.beginPath();for(var o=1;o<yo.length-2;o++){var a=(yo[o].x+yo[o+1].x)/2,n=(yo[o].y+yo[o+1].y)/2;t.quadraticCurveTo(yo[o].x,yo[o].y,a,n)}t.quadraticCurveTo(yo[o].x,yo[o].y,yo[o+1].x,yo[o+1].y),t.stroke();break;case b.end:yo=[]}}function xo(e){switch(e){case b.start:break;case b.move:pn();var t={x:Oa.drawStartX,y:Oa.drawStartY},o={x:Oa.drawCurX,y:Oa.drawCurY},a=function(e,t,o){var a={end1:{x:0,y:0},end2:{x:0,y:0}},n=t.x-e.x,i=t.y-e.y,r=Math.sqrt(n*n+i*i),c=n/r,s=i/r;return a.end1.x=t.x-c*o-s*o,a.end1.y=t.y-s*o+c*o,a.end2.x=t.x-c*o+s*o,a.end2.y=t.y-s*o-c*o,a}(t,o,Math.max(2*Oa.lineWidth,Ce.minArrowSize)),n=Oa.drawContext;n.fillStyle=Oa.drawStyle,n.strokeStyle=Oa.drawStyle,n.lineWidth=Oa.lineWidth,n.beginPath(),n.moveTo(t.x,t.y),n.lineTo((a.end1.x+a.end2.x)/2,(a.end1.y+a.end2.y)/2),n.closePath(),n.stroke(),n.moveTo(o.x,o.y),n.lineTo(a.end1.x,a.end1.y),n.lineTo(a.end2.x,a.end2.y),n.closePath(),n.fill();case b.end:}}function Co(e,t,o,a,n){var i,r;i=t-a/2,r=o-a/2,void 0===n?(i-=1,r-=1,a+=2,e.clearRect(i-1,r-1,a+2,a+2)):(e.beginPath(),e.strokeStyle=n,e.fillStyle=n,e.lineWidth=0,e.rect(i,r,a,a),e.fill(),e.stroke())}function $o(e){var t=Oa.baseContext,o=2*Oa.lineWidth;switch(o<10&&(o=10),e){case b.start:pn(),Co(t,Oa.drawCurX,Oa.drawCurY,o,Oa.eraserStyle);break;case b.move:Co(t,Oa.drawLastX,Oa.drawLastY,o),Co(t,Oa.drawCurX,Oa.drawCurY,o,Oa.eraserStyle);break;case b.end:Co(t,Oa.drawCurX,Oa.drawCurY,o)}}function Bo(e){switch(e){case b.start:break;case b.move:pn();var t=Oa.drawContext;t.strokeStyle=Oa.drawStyle,t.lineWidth=Oa.lineWidth,t.beginPath(),t.moveTo(Oa.drawStartX,Oa.drawStartY),t.lineTo(Oa.drawCurX,Oa.drawCurY),t.stroke();case b.end:}}function So(e){switch(e){case b.start:break;case b.move:pn();var t,o=Oa.drawContext;o.strokeStyle=Oa.drawStyle,o.lineWidth=Oa.lineWidth,t=bo(Oa.drawStartX,Oa.drawStartY,Oa.drawCurX,Oa.drawCurY),o.beginPath(),Oa.drawRegularShape?o.rect(t.regularX,t.regularY,t.regularSide,t.regularSide):o.rect(t.x,t.y,t.w,t.h),o.stroke();case b.end:}}function Wo(e){switch(e){case b.start:break;case b.move:pn();var t,o=Oa.drawContext;o.fillStyle=Oa.drawStyle,o.strokeStyle=Oa.clearStyle,o.lineWidth=0,t=bo(Oa.drawStartX,Oa.drawStartY,Oa.drawCurX,Oa.drawCurY),Oa.drawRegularShape?o.rect(t.regularX,t.regularY,t.regularSide,t.regularSide):o.rect(t.x,t.y,t.w,t.h),o.fill();case b.end:}}function _o(e){switch(e){case b.start:break;case b.move:var t,o=Oa.drawContext;pn(),o.strokeStyle=Oa.drawStyle,o.lineWidth=Oa.lineWidth,o.beginPath(),Oa.drawRegularShape?vo(o,(t=bo(Oa.drawStartX,Oa.drawStartY,Oa.drawCurX,Oa.drawCurY)).regularX,t.regularY,t.regularX+t.regularSide/3*4,t.regularY+t.regularSide):vo(o,Oa.drawStartX,Oa.drawStartY,Oa.drawCurX,Oa.drawCurY),o.closePath(),o.stroke();case b.end:}}function ko(e){switch(e){case b.start:break;case b.move:var t,o=Oa.drawContext;pn(),o.fillStyle=Oa.drawStyle,Oa.drawRegularShape?vo(o,(t=bo(Oa.drawStartX,Oa.drawStartY,Oa.drawCurX,Oa.drawCurY)).regularX,t.regularY,t.regularX+t.regularSide/3*4,t.regularY+t.regularSide):vo(o,Oa.drawStartX,Oa.drawStartY,Oa.drawCurX,Oa.drawCurY),o.fill();case b.end:}}function To(e){switch(e){case b.start:0==Oa.drawText&&Sn("textInputDlg",Do,Ho);break;case b.move:break;case b.end:0==Oa.drawText&&Ht()&&yn(b.end)}}function Do(){var e,t;t="rgb("+Oa.colorR+","+Oa.colorG+","+Oa.colorB+")",e="#textInputArea",$(e).css("font",Ce.tidTextSize+"px "+Oa.fontFamily),$(e).css("color",t),-1!=Oa.fontStyle.indexOf("Bold")?($(e).css("font-weight","bold"),Oa.fontBold=!0):($(e).css("font-weight","normal"),Oa.fontBold=!1),-1!=Oa.fontStyle.indexOf("Italic")?($(e).css("font-style","italic"),Oa.fontItalic=!0):($(e).css("font-style","normal"),Oa.fontItalic=!1),document.getElementById("textInputArea").value="",Oa.drawFontStyle=Oa.drawStyle,Oa.drawing=!1,Oa.drawText=!0,Dt(!0)}function Ho(){Dt(!1),pn(),Oa.drawText=!1,Oa.fnDraw&&Oa.fnDraw(b.end)}function Mo(){Dt(!1),pn(),function(){var e,t,o,a,n,i,r,c,s,l;if(0==Ht())return;e=Oa.drawStartX,t=Oa.drawStartY,a=Oa.fontSize,n=Oa.drawContext,i=function(){return document.getElementById("textInputArea").value}(),l="",Oa.fontBold&&(l+="Bold ");Oa.fontItalic&&(l+="Italic ");n.fillStyle=Oa.drawFontStyle,n.strokeStyle=Oa.drawStyle,n.font=l+a+"pt "+Oa.fontFamily,r=i,o=t;for(;-1!=r.indexOf("\n");)o+=a,s=r.indexOf("\n"),c=r.substring(0,s),n.fillText(c,e,o),r=r.substring(s+1);n.fillText(r,e,o+a)}(),Oa.drawText=!1,Oa.fnDraw&&Oa.fnDraw(b.end)}var Po=!1,zo=!1;async function Fo(e){var t,o,a,n,i,r=Yo;switch(e.target.id){case"scbtn_importPic":ye(!1),removeCropBox(),Nt();break;case"scbtn_fullcrop":zo?attachCropBox(Ge,qe,!0):attachCropBoxFull(Ge,qe),zo=!zo;break;case"scbtn_transform":if(0==$("#cropBox").length)return;o=ka(),a=o.width,n=o.height,i=new Image,Oa.curMode.freeze=!0,i.width=a,i.height=n,i.src=o.toDataURL(),i.onload=function(){var e=Oa.curMode,t=e.baseImageContext,o=e.imgW/a,r=e.imgH/n;pn(),t.beginPath(),t.rect(0,0,e.imgW,e.imgH),t.fillStyle="black",t.fill(),a/n>=e.imgW/e.imgH?t.drawImage(i,0,(e.imgH-n*o)/2,e.imgW,n*o):t.drawImage(i,(e.imgW-a*r)/2,0,a*r,e.imgH),yn(b.end),e.imageProcess&&e.imageProcess()},removeCropBox(),mn(r),ht(Oa.curMode.lS1ToolBar,!1),ht(Oa.curMode.rToolBar,!0),ht(Oa.curMode.bToolBar,!0),ht(Oa.curMode.lS2ToolBar,!0),Po=!0;break;case"scbtn_preview":!function(){var e=Yo;e.freeze=!1,removeCropBox(),mn(e),un(document.getElementById("previewArea-combineCanvas")),pn(),function(){var e=document.getElementById("displayCanvas");e.width+=0}(),e.imageProcess&&e.imageProcess();zo?attachCropBoxFull(Ge,qe):attachCropBox(Ge,qe);ht(Oa.curMode.lS2ToolBar,!1),ht(Oa.curMode.rToolBar,!1),ht(Oa.curMode.bToolBar,!1),ht(Oa.curMode.lS1ToolBar,!0),z("scanToolBarS2",0),e.mirror=!1,e.flip=!1,Po=!1}();break;case"scbtn_mirrow":r.mirror=!r.mirror,yn(b.mirror);break;case"scbtn_flip":r.flip=!r.flip,yn(b.flip);break;case"scbtn_config":$n(),$("#configDlg").toggle(500);break;case"scbtn_setting":Sn("btn_setting",la,da);break;case"scbtn_ocr":t={launch:!0,senderName:Ie},chrome.runtime.sendMessage(OcrAppID,t,(function(e){if(chrome.runtime.lastError)return $("#dialogOcr").dialog({dialogClass:"no-close",autoOpen:!1,width:250,height:140,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{"Add it now":function(){var e=OcrAppLink;window.open(e),$(this).dialog("close")},Later:function(){$(this).dialog("close")}}}),$("#dlgOcrTxt").text("This feature requires installing a free OCR extension from the Chrome Web Store."),void $("#dialogOcr").dialog("open");document.getElementById("previewArea-combineCanvas").toBlob((function(e){setTimeout((function(){Ta(e)}),200)}))}));break;case"scbtn_saveDisk":jo(),Dn(r.combineCanvas);break;case"scbtn_redo":case"scbtn_redo2":yn(b.redo);break;case"scbtn_undo":yn(b.undo);break;case"scbtn_undo2":if(1==r.canvasStep)return;yn(b.undo)}M(e)}var Ro=[];function Ao(e=null){$("#dialogSave").dialog({dialogClass:"no-close",autoOpen:!1,width:250,height:80,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{JPG:function(){$(this).dialog("close"),async function(e){var t=Tn("");if(Oa.lastSaveFilename==t)return;for(var o=0;o<e.length;o++)Dn(e[o],t+"-"+o)}(Ro),Ro=[],e&&go(e),Lo()},PDF:function(){$(this).dialog("close"),async function(e){for(var t=Tn(""),o=-1,a=-1,n=0;n<e.length;n++)e[n].width>o&&(o=e[n].width),e[n].height>a&&(a=e[n].height);for(var i=new jsPDF({orientation:o>a?"l":"p",unit:"pt",format:[o,a]}),r=0;r<e.length;r++){var c=(o-e[r].width)/2,s=(a-e[r].height)/2;r>0&&i.addPage();var l=await e[r].toDataURL("image/jpeg",1);await i.addImage(l,"JPEG",c,s,e[r].width,e[r].height)}i.save(t+".pdf")}(Ro),Ro=[],e&&go(e),Lo()},X:function(){$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html(""),$("#dialogSave").dialog("open")}function Eo(e=""){$("#lbMsCnt").text(e),$("#lbMsCnt").show(),$("#mscbtn_cancel").show()}function Lo(){$("#lbMsCnt").hide(),$("#mscbtn_cancel").hide()}function Oo(e){var t,o,a,n=Yo;switch(e.target.id){case"mscbtn_capture":if(0==$("#cropBox").length||0==Ri)return;$("#dialogSave").is(":visible")&&$("#dialogSave").dialog("close");var i=ka();Ro.push((t=i,o=document.createElement("canvas"),a=o.getContext("2d"),o.width=t.width,o.height=t.height,a.drawImage(t,0,0),o)),0==$("#lbMsCnt").length&&(g("uiArea","lbMsCnt"),$("#lbMsCnt").addClass("MultiScanCnt"),$("#lbMsCnt").css({top:tn-80,left:en/2,position:"absolute"})),Eo(Ro.length),n.imageProcess&&n.imageProcess();break;case"mscbtn_merge":if(0==Ro.length)return $("#dialogSave").dialog({dialogClass:"no-close",title:"!",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{OK:function(){$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br>Please take pictures first."),void $("#dialogSave").dialog("open");Ao();break;case"mscbtn_cancel":if(Ro.length)return $("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){Ro=[],Lo(),$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Discard captured images?<br/> "),void $("#dialogSave").dialog("open");break;case"mscbtn_fullcrop":zo?attachCropBox(Ge,qe,!0):attachCropBoxFull(Ge,qe),zo=!zo}n.mirror&&n.flip?$("#displayCanvas").css("transform","scale(-1,-1)"):!n.mirror&&n.flip?$("#displayCanvas").css("transform","scale(1,-1)"):n.mirror&&!n.flip?$("#displayCanvas").css("transform","scale(-1,1)"):n.mirror||n.flip||$("#displayCanvas").css("transform","scale(1,1)"),M(e)}var Yo={baseId:"previewArea",lToolBar:"previewToolBar",lS1ToolBar:"scanToolBarS1",lS2ToolBar:"scanToolBarS2",lMsToolBar:"multiscanToolBar",rToolBar:"drawingToolBar",bToolBar:"drawingCfgArea",taskCtrl:function(e){var t=Yo;e?(t.panMove=!1,Oa.capturePeriodRun&&Yt(!0),t.zoomRatio>1&&qn(!0)):(ye(!1),Yt(!1),qn(!1))},start:function(){ua(),Xo()},init:function(){var e=Yo;Mi=e.imgW=Oa.reqImgW,Pi=e.imgH=Oa.reqImgH,lt(e,Mi,Pi),dt(e),fn(e),function(){function e(e,t){var o,a,n,i,r=Oa.curMode,c=r.panWinW/r.imgW;return o=r.zoomX*c,a=r.zoomY*c,n=r.zoomW*c,i=r.zoomH*c,e>=o&&e<=o+n&&t>=a&&t<=a+i}$("#cropWin").on("mousedown",(function(t){e(t.offsetX,t.offsetY)&&(Oa.panMove=!0,Oa.panMoveX=t.offsetX,Oa.panMoveY=t.offsetY)})).on("mousemove",(function(e){Oa.panMove&&function(e,t){var o=Oa.curMode,a=o.imgW/o.panWinW;o.zoomX+=(e-Oa.panMoveX)*a,o.zoomY+=(t-Oa.panMoveY)*a,o.zoomX=Math.max(o.zoomX,0),o.zoomY=Math.max(o.zoomY,0),o.zoomX+o.zoomW>o.imgW&&(o.zoomX=o.imgW-o.zoomW);o.zoomY+o.zoomH>o.imgH&&(o.zoomY=o.imgH-o.zoomH);Gn(),yn(b.pan),Oa.panMoveX=e,Oa.panMoveY=t}(e.offsetX,e.offsetY)})).on("mouseup",(function(e){Oa.panMove=!1})).on("mouseout",(function(e){Oa.panMove=!1})).on("touchstart",(function(e){Ja(e)})).on("touchmove",(function(e){Ja(e)})).on("touchend",(function(){Ja(event)})).on("touchcancel",(function(){Ja(event)}))}(),qn(!1),qa(e,!1)},onResize:Xo,canvasCtrl:function(e){var t=Yo;switch(e){case b.start:return!1;case b.move:t.hasTempDraw=!0;break;case b.end:0==Oa.drawText&&(t.hasTempDraw=!1,t.mergeTempDraw=!0);break;case b.undo:t.canvasStep>0&&(t.reqUndo=!0);break;case b.redo:t.canvasStep<t.canvasArray.length-1&&(t.reqRedo=!0)}return!t.freeze},imageProcess:aa,chgBaseImgCtrl:async function(e,t,o){var a=Yo;switch(e){case y.before:a.zoomRatio=1,qn(!1),a.freeze=!1,P("previewToolBar","btn_freeze",0),await Yi(),Mi=a.imgW=t,Pi=a.imgH=o;break;case y.after:await Oi()}},imgW:Ce.defPreviewRsoX,imgH:Ce.defPreviewRsoY,freeze:!1,hasTempDraw:!1,mergeTempDraw:!1,reqUndo:!1,reqRedo:!1,flip:!1,mirror:!1,zoomRatio:1,zoomX:0,zoomY:0,zoomW:Ce.defPreviewRsoX,zoomH:Ce.defPreviewRsoY,panWinW:0,panWinH:0,zoomScrollBarPos:0};function Xo(){Yo.freeze&&Ua(),!so&&!lo||Po||(removeCropBox(),attachCropBox(Ge,qe)),Xn(),Gn(),Lt()}async function Go(e){var t=Yo;switch(e.target.id){case"btn_freeze":t.freeze=!t.freeze;break;case"btn_undo":yn(b.undo);break;case"btn_redo":yn(b.redo);break;case"btn_mirrow":t.mirror=!t.mirror,t.zoomX=t.imgW-t.zoomX-t.zoomW,Gn(),yn(b.mirror);break;case"btn_flip":t.flip=!t.flip,t.zoomY=t.imgH-t.zoomY-t.zoomH,Gn(),yn(b.flip);break;case"btn_config":$("#configDlg").toggle(500);break;case"btn_brightness":Sn("btn_brightness",ia,ra);break;case"btn_whitebalance":Sn("btn_whitebalance",ca,sa);break;case"btn_zoom":$("#configDlg").hide(),$("#zoomDlg").toggle(500);break;case"btn_setting":Sn("btn_setting",la,da);break;case"btn_capture":if(void 0===window.stream||!window.stream.active||!Ri)break;Dn(t.combineCanvas),$("#captureHit").css({position:"absolute",top:"60px",left:en/2-20+"px"}),$("#captureHit").show(100),Vo=1500,null==Uo&&(Uo=setInterval(No,500));break;case"btn_timesave":if(void 0===window.stream||!window.stream.active||!Ri)break;0==Oa.capturePeriodRun&&Sn("btn_timesave",ma,ga);break;case"btn_importPic":Nt();break;case"btn_record":if(void 0===window.stream||!window.stream.active||!Ri)break;$("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),Oa.capturePeriodRun&&Ot(),mn(t),(t.flip||t.mirror)&&(t.flip=!1,t.mirror=!1,Gn(),yn(b.flip),yn(b.mirror),P("previewToolBar","btn_flip",0),P("previewToolBar","btn_mirrow",0)),t.zoomRatio>1&&On(),t.freeze&&(t.freeze=!1,P("previewToolBar","btn_freeze",0)),Ci?_i():Wi();break;case"btn_pause":Ci&&($i?(clearInterval(qo),function(){$i=!1,pi.resume();var e=new Date;hi=e.getTime(),Ti()}()):(qo=setInterval(Ko,2e3),function(){$i=!0,pi.pause();var e=(new Date).getTime();vi+=e-hi}()));break;case"btn_test":chrome.windows.getCurrent((function(e){chrome.windows.update(e.id,{state:"minimized"})}))}M(e)}var qo,Uo=null,Vo=0;function No(){(Vo-=500)<=0&&($("#captureHit").hide(150),clearInterval(Uo),Uo=null)}function jo(){$("#SaveHit").css({position:"absolute",top:"60px",left:en/2-20+"px"}),$("#SaveHit").show(100),Vo=1500,null==Uo&&(Uo=setInterval(Zo,500))}function Zo(){(Vo-=500)<=0&&($("#SaveHit").hide(150),clearInterval(Uo),Uo=null)}function Ko(){$("#recordtime").fadeOut(500),$("#recordtime").fadeIn(500)}function Jo(e,t){var o=Yo;e.drawImage(t,0,0,o.imgW,o.imgH)}var Qo=["1","0","0","0","0","0","1","0","0","0","0","0","1","0","0","0","0","0","1","0"],ea=document.createElement("canvas"),ta=!1;var oa=0;function aa(){var e=Yo,t=e.imageProcessContext,o=1,a=1,n=0,i=0;e.mirror&&(o=-1,n=e.imgW),e.flip&&(a=-1,i=e.imgH),0==Oa.previewRotate?(t.save(),t.translate(n,i),t.scale(o,a),Jo(e.imageProcessContext,e.baseImageCanvas),t.restore(),oa=0):(Oa.previewRotate!=oa&&(t.fillStyle="black",t.fillRect(0,0,e.imgW,e.imgH)),t.save(),t.translate(e.imgW/2,e.imgH/2),t.rotate(Math.PI/180*Oa.previewRotate),t.scale(o,a),t.drawImage(e.baseImageCanvas,-e.imgW/2,-e.imgH/2,e.imgW,e.imgH),t.restore(),oa=Oa.previewRotate),function(){var e=Yo;e.reqUndo?(e.reqUndo=!1,xn(e)):e.reqRedo?(e.reqRedo=!1,Cn(e)):function(){var e=Yo;1==e.zoomRatio?Jo(e.combineContext,e.imageProcessCanvas):e.combineContext.drawImage(e.imageProcessCanvas,e.zoomX,e.zoomY,e.zoomW,e.zoomH,0,0,e.imgW,e.imgH);if(1===Ce.disableDrawingCanvasOverlay)return void na();e.mergeTempDraw&&(e.mergeTempDraw=!1,Jo(e.drawingContext,e.tempDrawingCanvas),gn(e));Jo(e.combineContext,e.drawingCanvas),function(){var e=Yo;e.hasTempDraw&&Jo(e.combineContext,e.tempDrawingCanvas);na()}()}()}()}function na(){Ga(Yo)&&Ua()}function ia(){yt(!0)}function ra(){yt(!1)}function ca(){It(!0)}function sa(){It(!1)}function la(){kt(!0)}function da(){kt(!1),Wn(),async function(){const e=document.getElementById(Oa.idVideoinputSelect);Hi!=e.value&&(Di=e.value,await Yi(),await Oi())}(),ua(),ti()}function ua(){const e=document.getElementById("sdVideoRsoScrollbar").selectedIndex;Oa.reqImgW=Oa.curVideoResolutionList[e][v.w],Oa.reqImgH=Oa.curVideoResolutionList[e][v.h],Oa.reqImgW==Oa.imgW&&Oa.reqImgH==Oa.imgH||(_n(Oa.reqImgW,Oa.reqImgH),function(e){var t;if(e<=Oa.curVideoResolutionList.length-1){for(t=0;t<Oa.curVideoResolutionList.length;t++)Oa.curVideoResolutionList[t][v.data]=0;Oa.curVideoResolutionList[e][v.data]=1}}(e))}function pa(){$n()}function ga(){Et(!1)}function ma(){Et(!0)}window.addEventListener("orientationchange",(()=>{Oa.checkVideoResolution=!0}));function fa(){var e;$n(),Oa.capturePeriodSec=document.getElementById("periodicCaptureDlg_periodText").value,Oa.captureIntervalHour=document.getElementById("periodicCaptureDlg_intervalText").value,Oa.capturePeriodSec<1||(e=60*Oa.captureIntervalHour/Oa.capturePeriodSec,e=Math.floor(e),Oa.capturePeriodTotalCnt=e,Oa.capturePeriodTotalCnt&&(Oa.capturePeriodRun=!0,Oa.capturePeriodCurCnt=0,Oa.capturePeriodMs=1e3*Oa.capturePeriodSec,ba(),Yt(!0)))}var ha=null;function ba(){var e=Yo;if(null==ha&&(ha=document.createElement("canvas")),Oa.capturePeriodCurCnt>=Oa.capturePeriodTotalCnt)return Oa.capturePeriodRun=!1,void Yt(!1);if(0!=Oa.capturePeriodRun){var t;Dn(e.combineCanvas)&&(Oa.capturePeriodCurCnt+=1,t=Oa.capturePeriodCurCnt+" / "+Oa.capturePeriodTotalCnt,Ln(document.getElementById("periodicCaptureInfoBar_text"),t),Oa.capturePeriodCurCnt>=Oa.capturePeriodTotalCnt&&(Oa.capturePeriodMs=1e3)),setTimeout((function(){ba()}),Oa.capturePeriodMs)}}if(void 0===va)var va={thumbnail:0,image:1};var wa={baseId:"playbackArea",lToolBar:"thumbnailToolBar",rToolBar:"playbackRToolBar",bToolBar:"playbackInfoBar",taskCtrl:function(e){e?hn(!1):(ye(!1),hn(!0),qn(!1))},start:function(){var e=wa;e.curMode==va.image?(Ma(),hn(!0),e.zoomRatio>1&&(Xn(),Gn(),qn(!0))):(e.zoomScrollBarPos=0,e.zoomRatio=1)},init:function(){var e=wa;dt(e),fn(e),function(){s("playbackArea","thumbDiv");var e=Ce.toolBarIconW,t=Ce.toolBarIconH,o=Ce.titleIconH,a={position:"absolute",left:e+"px",top:o+"px",width:"calc(100% - "+2*e+"px)",height:"calc(100% - "+(o+t)+"px)","text-align":"center",overflow:"auto","user-select":"none"};$("#thumbDiv").css(a)}(),function(){var e="playbackInfoBar",t="#"+e;l("uiArea",e);var o={top:"calc(100% - "+Ce.toolBarIconH+"px)",left:Ce.toolBarIconW+"px",height:xe.iconH+"px",width:"calc(100% - "+2*Ce.toolBarIconW+"px)",background:Ce.toolBarColorLeave,opacity:Ce.toolBarOpacityLeave,position:"absolute"};$(t).css(o),m(e,!1),g(e,"pbFileInfo_Page"),g(e,"pbFileInfo_Item"),t="#"+(e="pbFileInfo_Text"),o.top=(xe.iconH-Ce.pbInfoH)/2+"px",o.left="calc(40% - "+Ce.pbInfoW/2+"px)",o.height=Ce.pbInfoH,o.width=Ce.pbInfoW/2,$(t).css(o),$(t).css("line-height",Ce.pbInfoH+"px"),$(t).css("font-size",Ce.pbInfoFontSize),$(t).css("font-weight",Ce.pbInfoFontWWeight),$(t).css("color",Ce.pbInfoColor_Page),$(t).css("text-align","left"),t="#"+(e="pbFileInfo_Page"),o.top=(xe.iconH-Ce.pbInfoH)/2+"px",o.left="calc(40% - "+Ce.pbInfoW/2+"px)",o.height=Ce.pbInfoH,o.width=Ce.pbInfoW-Ce.pbInfoW/2,$(t).css(o),$(t).css("line-height",Ce.pbInfoH+"px"),$(t).css("font-size",Ce.pbInfoFontSize),$(t).css("font-weight",Ce.pbInfoFontWWeight),$(t).css("color",Ce.pbInfoColor_Page),$(t).css("text-align","left"),t="#"+(e="pbFileInfo_Item"),o.top=(xe.iconH-Ce.pbInfoH)/2+"px",o.left="calc(80% - "+Ce.pbInfoW/2+"px)",o.height=Ce.pbInfoH,o.width=Ce.pbInfoW,$(t).css(o),$(t).css("line-height",Ce.pbInfoH+"px"),$(t).css("font-size",Ce.pbInfoFontSize),$(t).css("font-weight",Ce.pbInfoFontWWeight),$(t).css("color",Ce.pbInfoColor_Item),$(t).css("text-align","left")}(),qa(e,!1)},onResize:function(){Ua(),Xn(),Gn()},canvasCtrl:function(e){var t=wa;switch(e){case b.start:return!1;case b.move:t.hasTempDraw=!0;break;case b.end:0==Oa.drawText&&(t.hasTempDraw=!1,t.mergeTempDraw=!0);break;case b.undo:t.canvasStep>0&&(t.reqUndo=!0);break;case b.redo:t.canvasStep<t.canvasArray.length-1&&(t.reqRedo=!0)}return!1},imageProcess:Ma,chgBaseImgCtrl:function(e,t,o){var a=wa;switch(e){case y.before:break;case y.after:if(0==a.curImage)return;$a(!1),Ba(va.image),$a(!oo),a.imgW=a.curImage.width,a.imgH=a.curImage.height,a.baseImageContext.drawImage(a.curImage,0,0,a.curImage.width,a.curImage.height),Ma(),ya(!1),hn(!0)}},imgW:Ce.defPictureW,imgH:Ce.defPictureH,curImage:0,curMode:va.thumbnail,zoomRatio:1,zoomX:0,zoomY:0,zoomW:Ce.defPreviewRsoX,zoomH:Ce.defPreviewRsoY,panWinW:0,panWinH:0,zoomScrollBarPos:0};function ya(e){m("thumbDiv",e)}function Ia(e){var t,o;switch(e.target.id){case"btn_delete":(t=$("img.selected,Video.selected")).length&&Sn("btn_delete",za,Fa);break;case"btn_saveDisk":for(t=$("img.selected,Video.selected"),o=0;o<t.length;o++)if("IMG"==t[o].tagName){0;break}Jt(t);break;case"btn_toggleAll":Oa.thumbFileCnt!=Oa.thumbSelectedFileCnt?(si(!0),Oa.thumbSelectedFileCnt=Oa.thumbFileCnt):(si(!1),Oa.thumbSelectedFileCnt=0),fi();break;case"btn_Next":!async function(){Oa.thumbnailCurrPage+=1,Oa.thumbnailCurrPage=Oa.thumbnailCurrPage%Oa.thumbnailTotalPage,await ni()}();break;case"btn_Previous":!async function(){Oa.thumbnailCurrPage+=Oa.thumbnailTotalPage-1,Oa.thumbnailCurrPage=Oa.thumbnailCurrPage%Oa.thumbnailTotalPage,await ni()}()}M(e)}function xa(e){$a(!1),Ba(va.thumbnail),$a(!0),hn(!1),ya(!0),e.curMode=va.thumbnail,e.zoomRatio=1,e.zoomScrollBarPos=0,qn(!1),$n()}function Ca(e){var t,o=wa;switch("ppbtn_transform"==e.target.id&&(0==$("#cropBox").length?(attachCropBox(Ge,qe),Sn("btn_delete",Wa,_a)):(Sn("btn_delete",Wa,_a),removeCropBox())),e.target.id){case"ppbtn_closeAndBackPlayback":xa(o);break;case"ppbtn_redo":yn(b.redo);break;case"ppbtn_undo":yn(b.undo);break;case"ppbtn_importPic":Nt();break;case"ppbtn_savePlayback":Dn(o.combineCanvas,"",!0);break;case"ppbtn_zoom":$("#configDlg").hide(),$("#zoomDlg").toggle(500);break;case"ppbtn_transform":break;case"ppbtn_ocr":t={launch:!0,senderName:Ie},chrome.runtime.sendMessage(OcrAppID,t,(function(e){if(chrome.runtime.lastError)return $("#dialogOcr").dialog({dialogClass:"no-close",autoOpen:!1,width:250,height:140,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{"Add it now":function(){var e=OcrAppLink;window.open(e),$(this).dialog("close")},Later:function(){$(this).dialog("close")}}}),$("#dlgOcrTxt").text("This feature requires installing a free OCR extension from the Chrome Web Store."),void $("#dialogOcr").dialog("open");document.getElementById("displayCanvas").toBlob((function(e){setTimeout((function(){Ta(e)}),200)}))}))}M(e)}function $a(e){var t=wa;m(t.lToolBar,e),m(t.rToolBar,e),m(t.bToolBar,e)}function Ba(e){var t=wa;switch(e){case va.thumbnail:t.lToolBar="thumbnailToolBar",t.rToolBar="playbackRToolBar",t.bToolBar="playbackInfoBar";break;case va.image:t.lToolBar="picPlaybackToolBar",t.rToolBar="drawingToolBar",t.bToolBar="drawingCfgArea"}}function Sa(e){e&&function(){var e=document.getElementById("croppath").getAttribute("d").split(/(?=[LMC])/),t=[],o=[];t[0]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[1]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[1]),t[2]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[3]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[1]),t[4]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[5]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[1]),t[6]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[7]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[1]);var a=wa,n=a.curImage,i=document.getElementById("displayCanvas").width,r=document.getElementById("displayCanvas").height;a.zoomRatio>1?(t[0]=parseInt(a.zoomX+t[0]/i*n.width/a.zoomRatio),t[1]=parseInt(a.zoomY+t[1]/r*n.height/a.zoomRatio),t[2]=parseInt(a.zoomX+t[2]/i*n.width/a.zoomRatio),t[3]=parseInt(a.zoomY+t[3]/r*n.height/a.zoomRatio),t[4]=parseInt(a.zoomX+t[4]/i*n.width/a.zoomRatio),t[5]=parseInt(a.zoomY+t[5]/r*n.height/a.zoomRatio),t[6]=parseInt(a.zoomX+t[6]/i*n.width/a.zoomRatio),t[7]=parseInt(a.zoomY+t[7]/r*n.height/a.zoomRatio)):(t[0]=t[0]/i*n.width,t[1]=t[1]/r*n.height,t[2]=t[2]/i*n.width,t[3]=t[3]/r*n.height,t[4]=t[4]/i*n.width,t[5]=t[5]/r*n.height,t[6]=t[6]/i*n.width,t[7]=t[7]/r*n.height);var c=(t[0]+t[6])/2,s=(t[1]+t[3])/2,l=Math.floor((t[2]+t[4])/2-c),d=Math.floor((t[7]+t[5])/2-s);o[0]=c,o[1]=s,o[2]=c+l,o[3]=s,o[4]=c+l,o[5]=s+d,o[6]=c,o[7]=s+d,perspectiveTran=PerspT(t,o);for(var u=I(n),p=u.getContext("2d",{willReadFrequently:!0}),g=p.getImageData(0,0,l,d),m=p.getImageData(0,0,n.width,n.height).data.slice(0),f=0;f<d;f++)for(var h=0;h<l;h++){var b=perspectiveTran.transformInverse(h+c,f+s),v=4*(f*l+h),w=4*(Math.round(b[1])*n.width+Math.round(b[0]));g.data[v]=m[w],g.data[v+1]=m[w+1],g.data[v+2]=m[w+2]}(u=document.getElementById("saveFileCanvas")).width=l,u.height=d,u.getContext("2d",{willReadFrequently:!0}).putImageData(g,0,0);var y=new Image;function I(e){var t=document.getElementById("saveFileCanvas"),o=t.getContext("2d",{willReadFrequently:!0});return $("#saveFileCanvas").attr("width",e.width),$("#saveFileCanvas").attr("height",e.height),o.drawImage(e,0,0,e.width,e.height),t}y.onload=function(){Da(this)},y.width=l,y.height=d,y.src=u.toDataURL(),On()}(),$n()}function Wa(){Ut(Sa),qt(!0)}function _a(){qt(!1),Yo.freeze=!1}function ka(){var e=document.getElementById("croppath").getAttribute("d").split(/(?=[LMC])/),t=[],o=[],a=[],n=[],r=[];a[0]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[1]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[1]),a[2]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[3]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[1]),a[4]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[5]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[1]),a[6]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[7]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[1]);var c=(a[1]+a[3]+a[5]+a[7])/4;for(i=0;i<4;i++){a[2*i+1]-c<0?(n.push(a[2*i]),n.push(a[2*i+1])):(r.push(a[2*i]),r.push(a[2*i+1]))}for(;n.length>0;){var s=0,l=9999;for(i=0;i<n.length;i++)n[2*i]<l&&(l=n[2*i],s=i);t.push(n[2*s]),t.push(n[2*s+1]),n.splice(2*s,2)}for(;r.length>0;){var d=0,u=-9999;for(i=0;i<r.length;i++)n[2*i]>u&&(u=n[2*i],d=i);t.push(r[2*d]),t.push(r[2*d+1]),r.splice(2*d,2)}var p=Yo,g=document.getElementById("displayCanvas").width,m=document.getElementById("displayCanvas").height;t[0]=t[0]/g*p.imgW,t[1]=t[1]/m*p.imgH,t[2]=t[2]/g*p.imgW,t[3]=t[3]/m*p.imgH,t[4]=t[4]/g*p.imgW,t[5]=t[5]/m*p.imgH,t[6]=t[6]/g*p.imgW,t[7]=t[7]/m*p.imgH;var f=(t[0]+t[6])/2,h=(t[1]+t[3])/2,b=Math.abs(Math.floor((t[2]+t[4])/2-f)),v=Math.abs(Math.floor((t[7]+t[5])/2-h));o[0]=f,o[1]=h,o[2]=f+b,o[3]=h,o[4]=f+b,o[5]=h+v,o[6]=f,o[7]=h+v,perspectiveTran=PerspT(t,o);var w=document.getElementById("previewArea-combineCanvas"),y=document.getElementById("tempCanvas");y.width=w.width,y.height=w.height;var I=y.getContext("2d",{willReadFrequently:!0});I.drawImage(w,0,0);for(var x=new ImageData(b,v),C=I.getImageData(0,0,p.imgW,p.imgH).data.slice(0),$=0;$<v;$++)for(var B=0;B<b;B++){var S=perspectiveTran.transformInverse(B+f,$+h),W=4*($*b+B),_=4*(Math.round(S[1])*p.imgW+Math.round(S[0]));x.data[W]=C[_],x.data[W+1]=C[_+1],x.data[W+2]=C[_+2],x.data[W+3]=255}var k=document.getElementById("saveFileCanvas");return k.width=b,k.height=v,k.getContext("2d",{willReadFrequently:!0}).putImageData(x,0,0),k}function Ta(e){var t=262144,o=0,a=t,n=e.size%t,i=Math.floor(e.size/t),r=0;0!=n&&(i+=1);var c=new FileReader;document.getElementById("displayCanvas");function s(){if(!(++r>i)){r==i&&0!=n&&(a=o+n);var s=e.slice(o,a);o=a,a+=t,c.readAsBinaryString(s)}}c.onload=function(){var e={blobAsText:c.result,mimeString:"mimeString",chunks:i};chrome.runtime.sendMessage(OcrAppID,e,(function(e){chrome.runtime.lastError})),s()},c.onerror=function(){appendLog("An error ocurred while reading file")},s()}function Da(e){var t=wa;t.curImage=e,t.curMode=va.image,_n(e.width,e.height),$n(),Xn(),Gn()}function Ha(e,t){var o=wa;e.drawImage(t,0,0,o.imgW,o.imgH,0,0,o.imgW,o.imgH)}function Ma(){var e=wa;Ha(e.imageProcessContext,e.baseImageCanvas),function(){var e=wa;e.reqUndo?(e.reqUndo=!1,xn(e)):e.reqRedo?(e.reqRedo=!1,Cn(e)):function(){var e=wa;1==e.zoomRatio?Ha(e.combineContext,e.imageProcessCanvas):e.combineContext.drawImage(e.imageProcessCanvas,e.zoomX,e.zoomY,e.zoomW,e.zoomH,0,0,e.imgW,e.imgH);e.mergeTempDraw&&(e.mergeTempDraw=!1,Ha(e.drawingContext,e.tempDrawingCanvas),gn(e));Ha(e.combineContext,e.drawingCanvas),function(){var e=wa;e.hasTempDraw&&Ha(e.combineContext,e.tempDrawingCanvas);!function(){var e=wa;Ga(e)&&Ua()}()}()}()}()}function Pa(e){var t;$n(),e&&(t=$("img.selected, video.selected"),Kt(t))}function za(){var e,t,o;Ut(Pa),e="btnCancel",o=(t="confirmDlg")+"_no",Vn(t+"_yes","btnDelete"),Vn(o,e),qt(!0)}function Fa(){qt(!1)}var Ra={baseId:"drawingArea",lToolBar:"drawingBoardToolBar",rToolBar:"drawingToolBar",bToolBar:"drawingCfgArea",taskCtrl:function(e){e||ye(!1)},start:function(){Aa()},init:function(){var e=Ra;dt(e),fn(e),e.baseImageContext.rect(0,0,e.imgW,e.imgH),e.baseImageContext.fillStyle=Ce.drawingBoardBgColor,e.baseImageContext.fill(),e.combineContext.drawImage(e.baseImageCanvas,0,0,e.imgW,e.imgH,0,0,e.imgW,e.imgH),qa(e,!1)},onResize:Aa,canvasCtrl:function(e){var t=Ra;switch(e){case b.start:return!1;case b.move:t.hasTempDraw=!0;break;case b.end:0==Oa.drawText&&(t.hasTempDraw=!1,t.mergeTempDraw=!0);break;case b.undo:t.canvasStep>0&&(t.reqUndo=!0);break;case b.redo:t.canvasStep<t.canvasArray.length-1&&(t.reqRedo=!0)}return!1},imageProcess:function(){var e=Ra;La(e.imageProcessContext,e.baseImageCanvas),function(){var e=Ra;e.reqUndo?(e.reqUndo=!1,xn(e)):e.reqRedo?(e.reqRedo=!1,Cn(e)):function(){var e=Ra;La(e.combineContext,e.imageProcessCanvas),e.mergeTempDraw&&(e.mergeTempDraw=!1,La(e.drawingContext,e.tempDrawingCanvas),gn(e));La(e.combineContext,e.drawingCanvas),function(){var e=Ra;e.hasTempDraw&&La(e.combineContext,e.tempDrawingCanvas);!function(){var e=Ra;Ga(e)&&Ua()}()}()}()}()},imgW:Ce.defDrawingBoardW,imgH:Ce.defDrawingBoardH,hasTempDraw:!1,mergeTempDraw:!1,reqUndo:!1,reqRedo:!1};function Aa(){Ua()}function Ea(e){var t=Ra;switch(e.target.id){case"dbbtn_undo":yn(b.undo);break;case"dbbtn_redo":yn(b.redo);break;case"dbbtn_importPic":Nt();break;case"dbbtn_savePlayback":jo(),Dn(t.combineCanvas)}M(e)}function La(e,t){var o=Ra;e.drawImage(t,0,0,o.imgW,o.imgH,0,0,o.imgW,o.imgH)}var Oa={appVersion:"20180904-1",curMode:void 0,showToolBar:!0,imgW:void 0,imgH:void 0,reqImgW:void 0,reqImgH:void 0,baseCanvas:void 0,baseContext:void 0,drawCanvas:void 0,drawContext:void 0,drawStyle:void 0,eraserStyle:void 0,clearStyle:"rgba(0,0,0,0)",opacity:void 0,lineWidth:void 0,colorHex:void 0,colorR:void 0,colorG:void 0,colorB:void 0,drawStartX:void 0,drawStartY:void 0,drawCurX:void 0,drawCurY:void 0,drawLastX:void 0,drawLastY:void 0,drawing:void 0,drawingMove:!1,fnDraw:void 0,activeDlg:!1,activeDlgCloseFn:!1,previewBrightnessAdj:0,previewWhiteBalanceAdj:0,previewRotate:0,fontFamily:"Arial",fontStyle:"Normal",fontSize:12,fontBold:!1,fontItalic:!1,drawText:!1,drawFontStyle:void 0,thumbnailCnt:0,thumbnailBuild:!1,thumbnailCurrPage:0,thumbnailTotalPage:1,thumbnailEntries:null,thumbnailReflesh:!1,capturing:!1,lastSaveFilename:"",ctrlPress:!1,showSysInfo:!1,frameRateInit:!1,frameCnt:16,frameSlotIdx:0,frameInterval:[],frameLastTime:0,frameRate:0,thumbFileCnt:0,thumbSelectedFileCnt:0,capturePeriodRun:!1,capturePeriodSec:Ce.pcdCapturePeriodSec,captureIntervalHour:Ce.pcdCaptureIntervalHour,capturePeriodTotalCnt:0,capturePeriodCurCnt:0,capturePeriodMs:0,resizeDelayMs:xe.resizeDelayMs,ipwRadiusExpandRatio:1,ipwExtraSpace:0,panMove:!1,panMoveX:0,panMoveY:0,drawRegularShape:!1,curVideoResolutionList:at,reqVideoResolutionList:!1,idVideoResolutionList:0,curAudioinputList:0,idAudioinputSelect:0,idVideoinputSelect:0,checkVideoResolution:!1};function Ya(e){document.getElementById("appTitle")&&ht("appTitle",e),ht("sysToolBar",!e),ht("modeToolBar",e),ht("bottomToolBarData","previewArea"==Oa.curMode.baseId&&!so&&!lo&&e),void 0!==Oa.curMode.lToolBar&&ht(Oa.curMode.lToolBar,!so&&!lo&&e),void 0!==Oa.curMode.lS1ToolBar&&ht(Oa.curMode.lS1ToolBar,so&&e&&!Po),void 0!==Oa.curMode.lS2ToolBar&&ht(Oa.curMode.lS2ToolBar,so&&e&&Po),void 0!==Oa.curMode.lMsToolBar&&ht(Oa.curMode.lMsToolBar,lo&&e),void 0!==Oa.curMode.rToolBar&&ht(Oa.curMode.rToolBar,(so&&Po||!so)&&!lo&&e),void 0!==Oa.curMode.bToolBar&&ht(Oa.curMode.bToolBar,(so&&Po||!so)&&!lo&&e)}function Xa(e){Oa.curMode&&(Ya(!1),Oa.activeDlgCloseFn&&Oa.activeDlgCloseFn(),Bn(),Oa.curMode.taskCtrl&&Oa.curMode.taskCtrl(!1),qa(Oa.curMode,!1)),Oa.curMode=e,Oa.curMode.taskCtrl&&Oa.curMode.taskCtrl(!0),function(e,t){Oa.imgW=e,Oa.imgH=t}(Oa.curMode.imgW,Oa.curMode.imgH),pt(),Pn(),Rn(),Oa.curMode.start&&Oa.curMode.start(),Oa.baseCanvas=Oa.curMode.drawingCanvas,Oa.baseContext=Oa.curMode.drawingContext,Oa.drawCanvas=Oa.curMode.tempDrawingCanvas,Oa.drawContext=Oa.curMode.tempDrawingContext,Oa.imgW=Oa.curMode.imgW,Oa.imgH=Oa.curMode.imgH,Ya(Oa.showToolBar),qa(Oa.curMode,!0)}function Ga(e){return e===Oa.curMode}function qa(e,t){m(e.baseId,t)}function Ua(){var e=Oa.curMode;Xe.drawImage(e.combineCanvas,0,0,e.imgW,e.imgH,0,0,Ge,qe)}function Va(){var e;$("#displayCanvas").on("mousedown",sn).on("mousemove",cn).on("mouseup",ln).on("mouseout",dn).on("touchstart",Na).on("touchend",ja).on("touchmove",Za).on("touchcancel",Ka),e=0,l("uiArea","sysInfoWin"),zn("appVersion",e++),zn("cfgVersion",e++),zn("imgSize",e++),zn("frmRate",e++),zn("redoundo",e++),An(!1)}function Na(e){Ja(e)}function ja(e){Ja(e)}function Za(e){Ja(e)}function Ka(e){}function Ja(e){if(e.originalEvent){rn();var t=e.originalEvent.changedTouches[0],o="";switch(e.type){case"touchstart":o="mousedown";break;case"touchmove":o="mousemove";break;case"touchend":o="mouseup";break;default:return}var a="mousemove"==o?1:0,n=new MouseEvent(o,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,buttons:a,relatedTarget:null});t.target.dispatchEvent(n),e.preventDefault()}}var Qa,en,tn,on,an=null,nn=0;function rn(){if(oo){var e=document.getElementById("sys_fullPhoto");e.style.backgroundColor=Ce.toolBarColorLeave,e.style.opacity=Ce.toolBarOpacityLeave,nn=3,an||(an=setInterval((function(){if(0==(nn-=1)){if(oo){var e=document.getElementById("sys_fullPhoto");e.style.backgroundColor=Ce.toolBarColorHide,e.style.opacity=Ce.toolBarOpacityHide}clearInterval(an),an=null}}),1e3))}}function cn(e){if(Oa.fnDraw&&Oa.drawing&&(0==e.buttons?(void 0===Qa&&(Qa=e),wn(Qa),Oa.fnDraw(b.end),Oa.drawing=!1,Oa.drawingMove&&yn(b.end)):(wn(e),Qa=e,Oa.drawingMove=!0,Oa.fnDraw(b.move),yn(b.move))),pe){var t=$("#importPictureWin").data("picData");t.mouseDown&&(0==t.type?fe(e):me(t.type,e))}}function sn(e){kn(I.displayCanvas,f.click,e),!Oa.fnDraw||Ci&&!$i||(pn(),Oa.drawing=!0,Oa.drawingMove=!1,function(e){var t=vn();Oa.drawStartX=e.offsetX*t,Oa.drawStartY=e.offsetY*t,Oa.drawStartX=Math.floor(10*Oa.drawStartX)/10,Oa.drawStartY=Math.floor(10*Oa.drawStartY)/10,Oa.drawCurX=Oa.drawLastX=Oa.drawStartX,Oa.drawCurY=Oa.drawLastY=Oa.drawStartY}(e),Oa.fnDraw(b.start),yn(b.start))}function ln(e){if(Oa.fnDraw&&Oa.drawing&&(wn(e),Oa.fnDraw(b.end),Oa.drawing=!1,yn(b.end)),pe){$("#importPictureWin").data("picData").mouseDown=!1,ge(),pe=!1}}function dn(e){Oa.fnDraw&&Oa.drawing&&2==_($e,1)&&(Oa.fnDraw(b.end),yn(b.end))}function un(e){e.width+=0}function pn(){un(Oa.drawCanvas)}function gn(e){e.canvasArray.length&&e.canvasStep!=e.canvasArray.length-1&&(e.canvasArray.length=e.canvasStep+1),e.canvasStep+=1,e.canvasArray.push(e.drawingCanvas.toDataURL())}function mn(e){e.canvasArray.length=0,e.canvasStep=-1,un(e.drawingCanvas),gn(e)}function fn(e){e.canvasArray=new Array,mn(e)}function hn(e){m("displayCanvas",e)}function bn(){Oa.drawStyle="rgba("+Oa.colorR+", "+Oa.colorG+", "+Oa.colorB+", "+Oa.opacity+")",Oa.eraserStyle="rgba("+Oa.colorR+", "+Oa.colorG+", "+Oa.colorB+", "+Ce.eraserOpacity+")"}function vn(){return Oa.imgW/Ge}function wn(e){var t=vn();Oa.drawLastX=Oa.drawCurX,Oa.drawLastY=Oa.drawCurY,Oa.drawCurX=e.offsetX*t,Oa.drawCurY=e.offsetY*t,Oa.drawCurX=Math.floor(10*Oa.drawCurX)/10,Oa.drawCurY=Math.floor(10*Oa.drawCurY)/10}function yn(e){var t=Oa.curMode;if(t.canvasCtrl&&1==t.canvasCtrl(e))Rn();else{switch(e){case b.start:case b.move:case b.end:case b.undo:case b.redo:case b.mirror:case b.flip:case b.brightness:case b.whiteBalance:case b.zoom:case b.pan:t.imageProcess&&t.imageProcess()}Rn()}}function In(e){var t=new Image;t.src=e.canvasArray[e.canvasStep],t.onload=function(){un(e.drawingCanvas),e.drawingContext.drawImage(t,0,0,e.imgW,e.imgH),e.imageProcess&&e.imageProcess()}}function xn(e){e.canvasStep>0&&(e.canvasStep-=1,In(e))}function Cn(e){e.canvasStep<e.canvasArray.length-1&&(e.canvasStep+=1,In(e))}function $n(){Oa.activeDlgCloseFn&&Oa.activeDlgCloseFn(),Bn()}function Bn(){Oa.activeDlgCloseFn=!1,Oa.activeDlg=!1,$("#configDlg").hide(),$("#zoomDlg").hide(),$("#configDrawDlg").hide(),removeCropBox()}function Sn(e,t,o){Oa.activeDlgCloseFn&&(Oa.activeDlgCloseFn(),Oa.activeDlgCloseFn=!1),Oa.activeDlg!=e?(Oa.activeDlg=e,o&&(Oa.activeDlgCloseFn=o),t&&t()):Oa.activeDlg=!1}function Wn(){var e;1!==Ce.disableDrawTextSetting&&(e=document.getElementById("sdfontFamily").selectedIndex,Oa.fontFamily=Ae[e][w.value],e=document.getElementById("fontStyle").selectedIndex,Oa.fontStyle=Ee[e][w.value],e=document.getElementById("fontSize").selectedIndex,Oa.fontSize=Oe[e][w.value])}async function _n(e,t){var o=Oa.curMode;o.chgBaseImgCtrl&&await o.chgBaseImgCtrl(y.before,e,t),Yo.imgW=e,Yo.imgH=t,Oa.imgW=e,Oa.imgH=t,lt(o,e,t),pn(),mn(o),pt(),Pn(),Rn(),o.chgBaseImgCtrl&&await o.chgBaseImgCtrl(y.after,e,t),On(),Xn(),Gn()}function kn(e,t,o){if(t===f.click)ye(!0)}function Tn(e){var t=new Date,o=t.getFullYear(),a=t.getMonth()+1,n=t.getDate(),i=t.getHours(),r=t.getMinutes(),c=t.getSeconds(),s=t.getMilliseconds();a<10&&(a="0"+a),n<10&&(n="0"+n),i<10&&(i="0"+i),r<10&&(r="0"+r),c<10&&(c="0"+c),s<10?s="00"+s:s<99&&(s="0"+s);var l=o+a+n+"-"+i+r+c+"-"+s;return""!=e&&(l+="."+e),l}async function Dn(e,o="",n=!1){""==o&&(o=Tn(""));var i=o+".jpg";if(Oa.lastSaveFilename==i)return!1;Oa.capturing=!0,Oa.lastSaveFilename=i;var r,c,s,l,d=Ce.thumbW,u=Ce.thumbH,p=Ce.thumbPadding;r=d-2*p,c=u-2*p,e.width/e.height>r/c?(s=r,l=e.height*r/e.width):(s=e.width*c/e.height,l=c);var g=document.getElementById("tempCanvas");g.width=s,g.height=l,g.getContext("2d").drawImage(e,0,0,s,l);const m=(await a()).transaction(t,"readwrite").objectStore(t),f={name:i,normalImage:e.toDataURL(),thumbnailImage:g.toDataURL()};return m.add(f),n&&ni(),!0}function Hn(e){if("Control"!=e.key)switch(e.key){case"I":case"i":Oa.ctrlPress&&(Oa.showSysInfo=!Oa.showSysInfo,An(Oa.showSysInfo))}else Oa.ctrlPress=!0}function Mn(e){if(Oa.ctrlPress){var t=Oa.curMode.zoomScrollBarPos;t-=e.deltaY/10,t=Math.min(Math.max(t,0),Ce.scrollZoomW),function(e,t){var o;o=(o=1+(Ce.zoomMaxRatio-1)*t/e).toFixed(1),Oa.curMode&&Yn(o,t)}(Ce.scrollZoomW,t)}}function Pn(){var e,t,o,a,n={position:"absolute","margin-left":"0px",background:xe.ColorLeave,opacity:xe.OpacityLeave};o=Ce.sysInfoWinW,a=Ce.sysInfoWinH,e=Math.min(en-Ce.toolBarIconW,Ue+Ge),e-=o,t=Math.min(Ve+qe,tn-Ce.drawSetH),n.width=o+"px",n.height=a+"px",n.left=e-Ce.sysInfoGap+"px",n.top=t-Ce.sysInfoGap-a+"px",$("#sysInfoWin").css(n),$("#configDrawDlg").css("top","calc(100% - 100px)"),$("#configDrawDlg").css("left",en-300-Ce.toolBarIconW+"px");var i,r=document.getElementById("bottomToolBarData");r&&((i=en/2-30)<0&&(i=0),r.style.left=i+"px");(r=document.getElementById("recordtime"))&&((i=en/2-32)<0&&(i=0),r.style.left=i+"px")}function zn(e,t){var o="sysInfoWin-"+e;g("sysInfoWin",o);var a={position:"absolute","margin-left":"0px"};a.left=Ce.sysInfoGap+"px",a.top=Ce.sysInfoGap+t*Ce.sysInfoH+"px",a.height=Ce.sysInfoH+"px",a.width=Ce.sysInfoWinW-2*Ce.sysInfoGap+"px",$("#"+o).css(a)}function Fn(e,t){Ln(document.getElementById("sysInfoWin-"+e),t)}function Rn(){var e;Fn("appVersion",Oa.appVersion),Fn("cfgVersion",Ce.cfgVersion),Fn("imgSize",Oa.imgW+"x"+Oa.imgH),Fn("frmRate",Oa.frameRate),Fn("redoundo",(e=Oa.curMode).canvasStep+1+" / "+e.canvasArray.length)}function An(e){e&&(Pn(),Rn()),m("sysInfoWin",e)}function En(e){return"url('css/images/icon/"+e+"')"}function Ln(e,t){var o;o=document.createTextNode(t),e.innerText=o.textContent}function On(){Yn(1,0),$("#zoomDlg-zoom-slider").val(0)}function Yn(e,t){var o,a,n,i,r,c,s=Oa.curMode;n=s.zoomX+s.zoomW/2,i=s.zoomY+s.zoomH/2,o=n-(r=s.imgW/e)/2,a=i-(c=s.imgH/e)/2,o=Math.max(o,0),a=Math.max(a,0),o=Math.min(o,s.imgW-r),a=Math.min(a,s.imgH-c),s.zoomRatio=e,s.zoomX=o,s.zoomY=a,s.zoomW=r,s.zoomH=c,yn(b.zoom),qn(!(e<=1)),Gn(),s.zoomScrollBarPos=t}function Xn(){var e,t,o=Oa.curMode,a={position:"absolute","margin-left":"0px",background:Ce.panWinColor,opacity:Ce.panOpacity},n=Ge/8,i=qe/8;e=Math.max(Ce.toolBarIconW,Ue),t=Math.min(Ve+qe,tn-Ce.drawSetH),a.width=n+"px",a.height=i+"px",a.left=e+Ce.panWinGapX+"px",a.top=t-Ce.panWinGapY-i+"px",$("#panWin").css(a),a.left=0,a.top=0,a.background="undefined",a.opacity=1,$("#cropWin").css(a),it("cropWin",n,i),o.panWinW=n,o.panWinH=i}function Gn(){var e,t,o,a,n,i,r=Oa.curMode,c=r.panWinW/r.imgW;e=r.zoomX*c,t=r.zoomY*c,o=r.zoomW*c,a=r.zoomH*c,i=(n=document.getElementById("cropWin")).getContext("2d"),un(n),i.fillStyle=Ce.panCropColor,i.fillRect(e,t,o,a)}function qn(e){m("panWin",e),m("cropWin",e)}function Un(){let e,t;Oa.reqVideoResolutionList!==Oa.curVideoResolutionList&&(Oa.curVideoResolutionList=Oa.reqVideoResolutionList,Oa.reqVideoResolutionList=!1,St(Oa.curVideoResolutionList),e=document.getElementById("sdVideoRsoScrollbar"),t=e.selectedIndex,Mi=Oa.curVideoResolutionList[t][v.w],Pi=Oa.curVideoResolutionList[t][v.h],Ga(Yo)&&(Oa.checkVideoResolution=!0))}function Vn(e,t){var o;(o=document.getElementById(e))&&(o.title=jn(t))}function Nn(e,t){var o;(o=document.getElementById(e))&&(o.innerHTML=jn(t))}function jn(e){return null==Zn[e]||void 0===Zn[e]?Kn[e].message:Zn[e].message}var Zn,Kn,Jn,Qn=null;function ei(){en=window.innerWidth,tn=window.innerHeight,on=Ce.titleIconH,pt(),Oa.curMode&&Oa.curMode.onResize&&Oa.curMode.onResize(),Pn(),we(),Xt(),$("#lbMsCnt").length>0&&$("#lbMsCnt").css({top:tn-80,left:en/2})}function ti(){var e,t=[["btn_freehand","btnFreehand"],["btn_arrow","btnArrow"],["btn_eraser","btnEraser"],["btn_line","btnLine"],["btn_rectangleLine","btnRectangle"],["btn_rectangle","btnFilledRectangle"],["btn_circleLine","btnEllipse"],["btn_circle","btnFilledEllipse"],["btn_erase_all","btnEraseAll"],["btn_text","btnText"],["btn_setting","btnSetting"],["btn_capture","btnCapture"],["btn_freeze","btnFreezeLiveView"],["btn_timesave","btnIntervalShooting"],["btn_mirrow","btnFlipVertical"],["btn_flip","btnFlipHorizontal"],["btn_zoom","btnZoom"],["btn_importPic","btnImportImageFile"],["btn_redo","btnRedo"],["btn_undo","btnUndo"],["btn_record","btnRecord"],["btn_whitebalance","btnWhiteBalance"],["btn_brightness","btnBrightness"],["btn_config","btnConfig"],["mode_about","btnAbout"],["mode_preview","btnLiveView"],["mode_playback","btnGallery"],["mode_drawingBoard","btnDrawingBoard"],["mode_scan","btnScanMode"],["mode_multiscan","btnMultiScanMode"],["sys_close","btnCloseWindow"],["sys_fullScreen","btnMaxWindow"],["sys_fullPhoto","btnHideFunctionIcon"],["sys_smallScreen","btnMinWindow"],["btn_saveDisk","btnSaveToDisk"],["btn_delete","btnDelete"],["btn_toggleAll","btnToogleSelectAll"],["btn_Next","btn_Next"],["btn_Previous","btn_Previous"],["ppbtn_savePlayback","btnSaveToGallery"],["ppbtn_closeAndBackPlayback","btnBackToGallery"],["ppbtn_zoom","btnZoom"],["ppbtn_importPic","btnImportImageFile"],["ppbtn_redo","btnRedo"],["ppbtn_undo","btnUndo"],["ppbtn_transform","ppbtn_transform"],["ppbtn_ocr","ppbtn_ocr"],["dbbtn_savePlayback","btnSaveToGallery"],["dbbtn_redo","btnRedo"],["dbbtn_undo","btnUndo"],["dbbtn_importPic","btnImportImageFile"],["sdVideoRsoIcon","textVideoResolution"],["sdFontIcon","textFont"],["periodicCaptureDlg_periodIcon","textInterval"],["periodicCaptureDlg_intervalIcon","textDuration"],["periodicCaptureDlg_startIcon","btnStart"],["periodicCaptureInfoBar","btnCancel"],["drawingOpacity","textTransparency"],["drawingLineWidth","textWidth"],["scbtn_transform","scbtn_transform"],["scbtn_importPic","scbtn_importPic"],["scbtn_fullcrop","scbtn_fullcrop"],["scbtn_redo","scbtn_redo"],["scbtn_redo2","scbtn_redo"],["scbtn_undo","scbtn_undo"],["scbtn_undo2","scbtn_undo"],["scbtn_preview","scbtn_preview"],["scbtn_saveDisk","scbtn_saveDisk"],["scbtn_ocr","scbtn_ocr"],["scbtn_flip","scbtn_flip"],["scbtn_mirrow","scbtn_mirrow"],["scbtn_fullcrop","scbtn_fullcrop"],["mscbtn_capture","mscbtn_capture"],["mscbtn_merge","mscbtn_merge"],["mscbtn_fullcrop","mscbtn_fullcrop"],["configDlg-brightness-icon","config_brightness"],["configDlg-brightness-slider","config_brightness"],["configDlg-brightness-reset","config_reset"],["configDlg-rotate-icon","config_rotate"],["configDlg-rotate-slider","config_rotate"],["configDlg-rotate-reset","config_reset"],["configDlg-whiteBalence-icon","config_wb"],["configDlg-whiteBalence-slider","config_wb"],["configDlg-whiteBalence-reset","config_reset"],["dialogSave","dlgSave"]],o=[["pbFileInfo_Text","lbPage"],["fontStyle-lbNormal","lbNormal"],["fontStyle-lbBold","lbBold"],["fontStyle-lbItalic","lbItalic"],["fontStyle-lbBoldItalic","lbBoldItalic"],["periodicCaptureDlg_periodUnit","lbSeconds"],["periodicCaptureDlg_intervalUnit","lbMinutes"]],a=document.getElementById("sdLanguageFamily").selectedIndex,n=Le[a][2];xe.languageIdx=a,$.getJSON(n,(function(a){for(Zn=a,e=0;e<t.length;e++)Vn(t[e][0],t[e][1]);for(e=0;e<o.length;e++)Nn(o[e][0],o[e][1])}))}window.onresize=function(e){if(xe.resizeDelayMs){if(Oa.resizeDelayMs=xe.resizeDelayMs,Qn)return;Qn=setInterval((function(){Oa.resizeDelayMs-=xe.resizeDelayMs/2,Oa.resizeDelayMs<=0&&(clearInterval(Qn),Qn=null,ei())}),xe.resizeDelayMs/2)}else ei()},window.onmousemove=function(){rn()},window.onload=async function(){var e,t,o,a,n,i;ei(),$("body").css("background-color",Ce.bgColor),(e={position:"absolute",width:Ce.toolBarIconW,height:Ce.toolBarIconH,"margin-left":"0px"}).width=Ce.toolBarIconW,e.height=Ce.toolBarIconH,C(ft,e,"uiArea","playbackRToolBar","right"),1===Ce.disableDrawingToolBar?(C(Be,e,"uiArea","drawingToolBar","right",ho),W(Be)):(C($e,e,"uiArea","drawingToolBar","right",ho),W($e)),C(Me,e,"uiArea","thumbnailToolBar","left",Ia),W(Me),C(Pe,e,"uiArea","picPlaybackToolBar","left",Ca),W(Pe),C(ze,e,"uiArea","drawingBoardToolBar","left",Ea),W(ze),C(We,e,"uiArea","previewToolBar","left",Go),W(We),C(_e,e,"uiArea","scanToolBarS1","left",Fo),W(_e),C(ke,e,"uiArea","scanToolBarS2","left",Fo),W(ke),C(Te,e,"uiArea","multiscanToolBar","left",Oo),W(Te),C(He,e,"uiArea","sysToolBar","top-right",co),W(He),e.width=Ce.modeIconW/2,e.height=xe.drawSetH,C(Se,e,"uiArea","bottomToolBarData","bottom",Go),W(Se),$("#btn_pause").hide(),e.width=Ce.modeIconW,e.height=Ce.modeIconH,C(De,e,"uiArea","modeToolBar","top-left",go),W(De),$("#Dummy").unbind("mouseenter mouseleave click"),function(){var e,t=["playbackRToolBar","previewToolBar","drawingToolBar","thumbnailToolBar","picPlaybackToolBar","drawingBoardToolBar","scanToolBarS1","scanToolBarS2"];for(e=0;e<t.length;e++)ht(t[e],!1)}(),wt(),$t(),Tt(),de(),s("uiArea",o="configDlg"),t="#"+o,$(t).css("background",xe.ColorLeave),$(t).css("top","calc(50%)"),$(t).css("left",Ce.toolBarIconW+"px"),$(t).css("width","370px"),$(t).css("height","200px"),$(t).css("position","absolute"),$(t).hide(),t="#"+re(o,t=o+"-brightness","brightness.png",24,36),$(t).attr({type:"range",max:2,min:0,step:.01,value:1}),$(t).on("input",(function(e){Oa.previewBrightnessAdj=Math.floor(e.currentTarget.value),Oa.curMode&&yn(b.brightness)})),t="#"+re(o,t=o+"-rotate","rotate.png",24,84),$(t).attr({type:"range",max:180,min:-180,step:5,value:0}),$(t).on("input",(function(e){Oa.previewRotate=Math.floor(e.currentTarget.value)})),t="#"+re(o,t=o+"-whiteBalence","wb.png",24,132),$(t).attr({type:"range",max:1.5,min:.5,step:.01,value:1}),$(t).on("input",(function(e){Oa.previewWhiteBalanceAdj=Math.floor(e.currentTarget.value),Oa.curMode&&yn(b.whiteBalance)})),ie(),Ce.aboutWinW=400,Ce.aboutWinH=380,function(){var e,t,o="aboutDlg",a=o+"-close",n=o+"-content";s("uiArea",o),s(o,a),s(o,n),e="#"+o,$(e).css("top","calc(50% - "+(Ce.aboutWinH-Ce.titleIconH)/2+"px)"),$(e).css("left","calc(50% - "+Ce.aboutWinW/2+"px)"),$(e).css("width",Ce.aboutWinW+"px"),$(e).css("height",Ce.aboutWinH+"px"),$(e).css("position","absolute"),$(e).css("background",Ce.aboutBkg),$(e).css("opacity",Ce.aboutOpacity),e="#"+a,t=En("close.png"),$(e).css("background",t),$(e).css("top","0px"),$(e).css("left","calc(100% - "+Ce.aboutIconW+"px)"),$(e).css("width",Ce.aboutIconW+"px"),$(e).css("height",Ce.aboutIconH+"px"),$(e).css("position","absolute"),$(e).click((function(){m("aboutDlg",!1)})),e="#"+n,$(e).css("top",Ce.aboutIconH+"px"),$(e).css("left",Ce.aboutGapX+"px"),$(e).css("width",Ce.aboutWinW-2*Ce.aboutGapX+"px"),$(e).css("height",Ce.aboutWinH-Ce.aboutIconH+"px"),$(e).css("position","absolute"),$(e).html('<center><img src="css/images/icon/logo 60.png"></img></center><label><font size="5" color="#FAFAFA"><center>Documate</center></font></label><BR><label><font size="2" color="#FAFAFA"><center>Ver : 1.25.0108</center></font></label><BR><div id="companyLink" align="center"><font size="2" color="#88F">Official site : www.inswan.com</font></div><div id="manualLink" align="center"><font size="2" color="#88F">Email : service@inswan.com</font></div><BR><font size="2" color="#FAFAFA"><center>Inswan Copyright  ©  2024. All rights reserved.</center></font>'),e="#companyLink",$(e).click((function(){window.open("https://www.inswan.com/")})),e="#manualLink",$(e).click((function(){window.open("mailto:service@inswan.com")})),m(o,!1)}(),function(){var e,t,o,a,n,i="periodicCaptureDlg",r=i+"_periodIcon",c=i+"_periodText",l=i+"_periodUnit",d=i+"_intervalIcon",u=i+"_intervalText",p=i+"_intervalUnit",g=i+"_close",m=i+"_startIcon",f=(Ce.pcdIconH-Ce.pcdTextH)/2,h=(Ce.pcdIconH-Ce.pcdUnitH)/2;s("uiArea",i),a=Ce.pcdIconW+Ce.pcdTextW+Ce.pcdUnitW+Ce.pcdExtraW,n=4*Ce.pcdIconH-3*Ce.pcdIconOverlayY,e="#"+i,$(e).css("position","absolute"),$(e).css("background",Ce.pcdBkg),$(e).css("opacity",Ce.pcdOpacity),$(e).css("left","calc(50% - "+a/2+"px)"),$(e).css("top","calc(50% - "+(n-Ce.titleIconH)/2+"px)"),$(e).css("width",a+"px"),$(e).css("height",n+"px"),Ft(i,g,"close.png",t=a-Ce.pcdIconW,o=0),$("#"+g).on("click",pa),Ft(i,r,"timesave_time.png",t=0,o+=Ce.pcdIconH-Ce.pcdIconOverlayY),At(i,c,t+=Ce.pcdIconW,o+f,Oa.capturePeriodSec),Rt(i,l,t+=Ce.pcdTextW,o+h,""),Ft(i,d,"timesave_keep.png",t=0,o+=Ce.pcdIconH-Ce.pcdIconOverlayY),At(i,u,t+=Ce.pcdIconW,o+f,Oa.captureIntervalHour),Rt(i,p,t+=Ce.pcdTextW,o+h,""),o+=Ce.pcdIconH-Ce.pcdIconOverlayY,Ft(i,m,"timesave_star.png",t=(a-Ce.pcdIconW)/2,o),$("#"+m).on("click",fa),Et(!1)}(),function(){var e,t="periodicCaptureInfoBar",o=t+"_text",a=t+"_icon";l("uiArea",t),Lt(),g(t,o),e="#"+o,$(e).css("position","absolute"),$(e).css("left",0),$(e).css("top",(Ce.pcibIconH-Ce.pcibTextH)/2+"px"),$(e).css("width",Ce.pcibTextW+"px"),$(e).css("height",Ce.pcibTextH+"px"),$(e).css("text-align","center"),$(e).css("line-height",Ce.pcibTextH+"px"),$(e).css("font-size",Ce.pcibTextFontSize),$(e).css("color",Ce.pcibTextColor),l(t,a),e="#"+a,$(e).css("position","absolute"),$(e).css("left",Ce.pcibTextW+"px"),$(e).css("top",0),$(e).css("width",Ce.pcibIconW+"px"),$(e).css("height",Ce.pcibIconH+"px"),$(e).css("background",En("timesave_star.png")),$(e).on("click",Ot),Yt(!1)}(),Gt(),i={position:"absolute",background:Ce.mouseColorLeave,padding:"0 0 0 0px",top:"0px",height:Ce.titleIconH+"px",opacity:Ce.mouseOpacityLeave},a=Ce.modeIconW*De.length,n=Ce.toolBarIconW*He.length,i.left=a+"px",i.width="calc(100% - "+(a+n)+"px)",Va(),Yo.init(),wa.init(),Ra.init(),jt(),Xa(Yo);try{await async function(){try{await Ei()}catch(e){alert("Please connect the camera."),qi()}}()}catch(e){}to(),ti()},document.body.addEventListener("keydown",(function(e){Hn(e)})),document.body.addEventListener("keyup",(function(e){!function(e){"Control"!=e.key||(Oa.ctrlPress=!1)}(e)})),document.body.addEventListener("wheel",(function(e){Mn(e)})),document.oncontextmenu=function(){return!1};const oi=30;var ai=!1;async function ni(){if(ai)return;ai=!0,Jn=[];const e=await a(),o=e.transaction(t,"readonly").objectStore(t).count();o.onsuccess=()=>{var a=o.result;Oa.thumbnailTotalPage=parseInt((a-1)/oi)+1,Oa.thumbnailCurrPage=Math.min(Oa.thumbnailCurrPage,Oa.thumbnailTotalPage-1);let n=0;var i=oi*Oa.thumbnailCurrPage,r=Math.min(i+oi,a);e.transaction(t,"readonly").objectStore(t).openCursor(null,"prev").onsuccess=e=>{const t=e.target.result;return t?(n>=i&&n<r&&Jn.push(t.value),n++,n<r?void t.continue():(ii(),void(ai=!1))):(ii(),void(ai=!1))}}}function ii(){Oa.thumbSelectedFileCnt=0,Oa.thumbnailCnt=0,Oa.thumbFileCnt=0,ya(!1),$("#thumbDiv").empty();for(var e=0;e<Jn.length;e++)Jn[e].name.indexOf(".jpg")>0&&(Oa.thumbnailCnt+=1,ri(Jn[e],e)),(Jn[e].name.indexOf(".mp4")>0||Jn[e].name.indexOf(".webm")>0)&&ci(Jn[e],e);fi(),setTimeout((function(){ya(!0)}),100)}function ri(e,t,o=!1){var a,n,i,r="thumb_"+t,c="img_"+t,l=Ce.thumbW,d=Ce.thumbH,p=Ce.thumbPadding;if(o){var g=document.createElement("div");g.id=r,document.getElementById("thumbDiv").prepend(g)}else s("thumbDiv",r);n=l-2*p,i=d-2*p,a="#"+r,$(a).css("width",n+"px"),$(a).css("height",i+"px"),$(a).css("padding",p+"px"),$(a).css("position","relative"),$(a).css("display","inline-block"),u(r,c);var m=new Image;m.addEventListener("load",(function(){var t=Zt(n,i,m.width,m.height),o=Ce.thumbFrmSize+"px solid "+Ce.thumbFrmColorNormal;a="#"+c;var r={left:t.x+p,top:t.y+p,width:t.w,height:t.h,position:"absolute",border:o};$(a).css(r),$(a).addClass("thumbImg"),(a=document.getElementById(c)).src=e.thumbnailImage,a.fileName=e.name,a.checked=!1,$(a).on("click",(function(e){var t,o,a=document.getElementById(e.target.id);a.checked?(a.checked=!1,t=Ce.thumbFrmColorNormal,ui()):(si(!1),a.checked=!0,t=Ce.thumbFrmColorChecked,di()),o=Ce.thumbFrmSize+"px solid "+t,$(this).css("border",o),$(this).toggleClass("selected")})),$(a).dblclick((function(){document.getElementById(this.id).checked=!0;var t=Ce.thumbFrmColorChecked;di();var o=Ce.thumbFrmSize+"px solid "+t;$(this).css("border",o),$(this).toggleClass("selected");var a=new Image;a.src=e.normalImage,a.addEventListener("load",(function(){Da(a)}))})),li()})),m.src=e.thumbnailImage}function ci(e,t,o=!1){var a,n,i,r="thumb_"+t,c="img_"+t,l="vIcon_"+t,d=Ce.thumbW,u=Ce.thumbH,p=Ce.thumbPadding;if(o){var g=document.createElement("div");g.id=r,document.getElementById("thumbDiv").prepend(g)}else s("thumbDiv",r);n=d-2*p,i=u-2*p,a="#"+r,$(a).css("width",n+"px"),$(a).css("height",i+"px"),$(a).css("padding",p+"px"),$(a).css("position","relative"),$(a).css("display","inline-block");let m=document.getElementById(r),f=document.createElement("video");f.id=c,m.appendChild(f),s(r,l);var h=Zt(n,i,1280,720),b=Ce.thumbFrmSize+"px solid "+Ce.thumbFrmColorNormal;a="#"+c;var v={left:h.x+p,top:h.y+p,width:h.w,height:h.h,position:"absolute",border:b};$(a).css(v),$(a).addClass("thumbImg"),a=document.getElementById(c),e.name.indexOf(".mp4"),a.src=URL.createObjectURL(e.video),a.autoplay=!1,a.controls=!1,a.loop=!1,a.fileName=e.name,a.checked=!1,v={right:6,bottom:17,width:36,height:12,position:"absolute",backgroundColor:"#000",color:"#EEE",textAlign:"center",fontSize:12,opacity:.75},$("#"+l).css(v),a.addEventListener("loadedmetadata",(function(){var e=Math.round(a.duration);document.getElementById(l).innerText=Math.floor(e/60)+":"+ki(e%60,2)})),$(a).on("click",(function(e){var t,o,a=document.getElementById(e.target.id);a.checked?(a.checked=!1,t=Ce.thumbFrmColorNormal,ui()):(si(!1),a.checked=!0,t=Ce.thumbFrmColorChecked,di()),o=Ce.thumbFrmSize+"px solid "+t,$(this).css("border",o),$(this).toggleClass("selected")})),$(a).dblclick((function(){var e=document.getElementById(this.id);e.checked=!0;var t=Ce.thumbFrmColorChecked;di();var o,a=Ce.thumbFrmSize+"px solid "+t;$(this).css("border",a),$(this).toggleClass("selected"),e.muted=!1,e.currentTime=0,(o=e).webkitRequestFullscreen?o.webkitRequestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.requestFullscreen?o.requestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()})),a.addEventListener("ended",(function(e){null!=document.fullscreenElement&&document.exitFullscreen()}),!1),a.addEventListener("mouseover",(function(e){var t=a.play();void 0!==t&&t.then((e=>{a.muted=!0,a.play()})).catch((e=>{}))})),a.addEventListener("mouseleave",(function(e){var t=a.play();void 0!==t&&t.then((e=>{a.pause(),a.currentTime=0})).catch((e=>{}))})),li()}function Kt(o){var a;const n=indexedDB.open(e);n.onsuccess=e=>{const n=e.target.result.transaction(t,"readwrite").objectStore(t).openCursor();n.onsuccess=e=>{const t=e.target.result;if(t)for(a=0;a<o.length;a++)t.value.name===o[a].fileName?t.delete():t.continue()},n.onerror=e=>{}},n.onerror=e=>{},ni()}function si(e){var t,o,a,n,i,r=$(".thumbImg"),c="selected";for(e?(a=!0,n=Ce.thumbFrmColorChecked):(a=!1,n=Ce.thumbFrmColorNormal),i=Ce.thumbFrmSize+"px solid "+n,o=0;o<r.length;o++)document.getElementById(r[o].id).checked=a,(t=$("#"+r[o].id)).css("border",i),e?t.addClass(c):t.removeClass(c)}function li(){Oa.thumbFileCnt+=1,fi()}function di(){mi()}function ui(){mi()}var pi,gi=-1;function mi(){-1==gi?(gi=2,setTimeout(mi,100)):gi>0?(gi-=1,setTimeout(mi,100)):(gi=-1,function(){var e=$(".thumbImg"),t="selected";Oa.thumbSelectedFileCnt=0;for(var o=0;o<e.length;o++){var a=document.getElementById(e[o].id),n=$("#"+e[o].id);a.checked?(Oa.thumbSelectedFileCnt+=1,n.addClass(t)):n.removeClass(t)}fi()}())}function fi(){var e,t,o="PAGE: "+Math.min(Oa.thumbnailCurrPage+1,Oa.thumbnailTotalPage)+"/"+Oa.thumbnailTotalPage,a="IMAGE： "+Math.min(Oa.thumbFileCnt,oi);e=o,t=a,Ln(document.getElementById("pbFileInfo_Page"),e),Ln(document.getElementById("pbFileInfo_Item"),t),function(){var e;e=Oa.thumbFileCnt&&Oa.thumbFileCnt===Oa.thumbSelectedFileCnt?"btnUnselectAll":"btnSelectAll";Vn("btn_toggleAll",e)}()}var hi,bi,vi,wi,yi,Ii,xi=[],Ci=!1,$i=!1,Bi=900;function Si(e){var t,o=["btn_setting","btn_capture","btn_freeze","btn_timesave","btn_mirrow","btn_flip","btn_config","btn_zoom","btn_importPic","btn_redo","btn_undo","btn_freehand","btn_arrow","btn_eraser","btn_line","btn_rectangleLine","btn_rectangle","btn_circleLine","btn_circle","btn_erase_all","btn_text","btn_configDraw","drawingCfgColorBar","drawingOpacity","drawingLineWidth"];for(t=0;t<o.length;t++)ht(o[t],e);e?document.getElementById("sysToolBar").style.background=Ce.toolBarColorLeave:document.getElementById("sysToolBar").style.backgroundColor="#000"}async function Wi(){if(!Ci)return Ci=!0,Oa.imgW,Oa.imgH,Si(!1),$n(),$("#btn_pause").show(),void setTimeout(Wi,500);$i=!1,document.getElementById("recordtime").style.fontSize="18px",document.getElementById("recordtime").style.fontWeight="bold",document.getElementById("recordtime").style.color="red",document.getElementById("recordtime").style.position="absolute",document.getElementById("recordtime").style.bottom="60px",document.getElementById("recordtime").style.left=document.documentElement.clientWidth/2-32+"px",document.getElementById("recordtime").style.visibility="visible";var e=new Date;hi=e.getTime(),vi=0,Ti();var o=Yo.combineCanvas,n=document.getElementById("sdAudioinputScrollbar").value;const i=await navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:n}}});let r;wi=o.captureStream(),i.getAudioTracks().forEach((e=>wi.addTrack(e))),Ii=window.stream,window.stream=wi,xi=[],MediaRecorder.isTypeSupported('video/webm; codecs="vp9, opus"')?(r='video/webm; codecs="vp9, opus"',yi="webm"):MediaRecorder.isTypeSupported('video/webm; codecs="vp8, vorbis"')?(r='video/webm; codecs="vp8, vorbis"',yi="webm"):MediaRecorder.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')?(r='video/mp4; codecs="avc1.42E01E, mp4a.40.2"',yi="mp4"):MediaRecorder.isTypeSupported("video/webm")?(r="video/webm",yi="webm"):MediaRecorder.isTypeSupported("video/mp4")&&(r="video/mp4",yi="mp4"),(pi=new MediaRecorder(wi,{audioBitsPerSecond:128e3,videoBitsPerSecond:5e6,mimeType:r})).ondataavailable=function(e){e.data&&e.data.size>0&&(xi.push(e.data),async function(){var e=Tn(yi);if("mp4"==yi){const o=(await a()).transaction(t,"readwrite").objectStore(t);let n=new Blob(xi,{type:"video/mp4"});const i={name:e,video:n};o.add(i),xi=[],n=null}else if("webm"==yi){let o=new Blob(xi,{type:"video/webm"});setTimeout((function(){ysFixWebmDuration(o,bi,(async function(n){const i=(await a()).transaction(t,"readwrite").objectStore(t),r={name:e,video:n};i.add(r),xi=[],o=null}))}),100)}}())},pi.start()}async function _i(){Ci=!1,document.getElementById("recordtime").style.visibility="hidden",Si(!0),$("#btn_pause").hide(),pi.stop(),wi.getTracks().forEach((function(e){e.stop(),wi.removeTrack(e)})),window.stream=Ii;var e=(new Date).getTime();$i?($i=!1,bi=vi):bi=vi+e-hi}function ki(e,t){return(e=""+e).length>=t?e:ki("0"+e,t)}function Ti(){if(Ci&&!$i){var e=(new Date).getTime();bi=vi+e-hi;var t=Math.floor(bi/1e3);if(t>=Bi)return void _i();document.getElementById("recordtime").innerText=ki(Math.floor(t/60),2)+" : "+ki(t%60,2),setTimeout((()=>{Ti()}),1e3)}}let Di="",Hi="",Mi=Ce.defPreviewRsoX,Pi=Ce.defPreviewRsoY;const zi=document.getElementById("videoSrc");let Fi;let Ri=!1;let Ai=!1;async function Ei(){if(await async function(){try{const e=await navigator.permissions.query({name:"camera"}),t=await navigator.permissions.query({name:"microphone"});return"granted"===e.state&&"granted"===t.state||await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),!0}catch(e){return qi(),!1}}()){await async function(){try{const e=document.getElementById(Oa.idVideoinputSelect),t=document.getElementById(Oa.idAudioinputSelect),o=await navigator.mediaDevices.enumerateDevices();e.innerHTML="",t.innerHTML="";let a=null,n=null,i=null,r=null;return Ai=!1,o.forEach((o=>{if("videoinput"===o.kind){if(-1!=o.label.indexOf("visual"))return;if(-1!=o.label.indexOf("Basler"))return;null==a&&(a=o.deviceId),-1!=o.label.indexOf("Document Camera")&&(Oa.reqVideoResolutionList=nt[0][2],Ai=!0,a=o.deviceId,i=o.deviceId);const t=document.createElement("option");t.value=o.deviceId,t.textContent=o.label||`未命名裝置 (${o.deviceId})`,t.isDC=Ai,e.appendChild(t)}if("audioinput"===o.kind){const e=document.createElement("option");e.value=o.deviceId,e.textContent=o.label||`未命名裝置 (${o.deviceId})`,t.appendChild(e),null==n&&(n=o.deviceId),-1!=o.label.indexOf("Document Camera")&&(r=o.deviceId)}})),null!=a&&(Ai&&(a=i),e.value=a,Di=a,t.value=r||n,!0)}catch(e){return qi(),!1}}()&&await Oi()}}function Li(e){e?($("#btn_record").hover(D,H),$("#btn_record").css("background-image","url('css/images/icon/record2.png')")):($("#btn_record").off("mouseenter mouseleave"),$("#btn_record").css("background-image","url('css/images/icon/record3.png')"))}async function Oi(){const e=await async function(){const e=document.getElementById(Oa.idVideoinputSelect),t=e.options[e.selectedIndex],o=document.getElementById(Oa.idAudioinputSelect);let a;if(t.isDC)a={audio:{deviceId:{exact:o.value}},video:{deviceId:{exact:t.value},width:{exact:Oa.reqImgW,max:1920},height:{exact:Oa.reqImgH,max:1080}}},Oa.reqVideoResolutionList=nt[0][2],await Un();else{const e=(await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:t.value}}})).getVideoTracks()[0].getSettings(),n=e.width,i=e.height;Oa.reqVideoResolutionList=[[e.width,e.height,1]],await Un(),a=o.value?{audio:{deviceId:{exact:o.value}},video:{deviceId:{exact:t.value},width:{exact:n},height:{exact:i}}}:{video:{deviceId:{exact:t.value},width:{exact:n},height:{exact:i}}}}return a}();try{const t=await navigator.mediaDevices.getUserMedia(e);window.stream=t;const o=e.video.width.exact,a=e.video.height.exact;if(async function(e,t){const o=Oa.curMode;Yo.imgW=e,Yo.imgH=t,lt(o,e,t),pn(),mn(o),Oa.imgW=e,Oa.imgH=t,pt(),Pn(),Rn(),On(),Xn(),Gn()}(o,a),Hi=Di,!window.stream)return;window.stream.getAudioTracks().length>0&&(window.stream.getAudioTracks()[0].enabled=!1),zi.srcObject=window.stream,zi.onloadeddata=()=>{!function(){let e=document.getElementById("previewArea-WebGL");if(!(Vi=e.getContext("webgl")))throw new Error("WebGL not supported");const t="\n    attribute vec4 a_position;\n    attribute vec2 a_texCoord;\n    varying vec2 v_texCoord;\n    void main() {\n      gl_Position = a_position;\n      v_texCoord = a_texCoord;\n    }\n  ",o="\n    precision mediump float;\n    uniform sampler2D u_image;\n    uniform float u_brightness;\n    uniform vec3 u_whiteBalance;\n    varying vec2 v_texCoord;\n    void main() {\n      vec4 color = texture2D(u_image, v_texCoord);\n      color.rgb *= u_brightness; // Apply brightness adjustment\n      color.r *= u_whiteBalance.r;\n      color.g *= u_whiteBalance.g;\n      color.b *= u_whiteBalance.b;\n      gl_FragColor = color;\n    }\n  ";ji=nr(Vi,Vi.VERTEX_SHADER,t),Zi=nr(Vi,Vi.FRAGMENT_SHADER,o),Ki=function(e,t,o){const a=e.createProgram();if(e.attachShader(a,t),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))return e.deleteProgram(a),null;return a}(Vi,ji,Zi),Ji=Vi.getAttribLocation(Ki,"a_position"),Qi=Vi.getAttribLocation(Ki,"a_texCoord"),er=Vi.getUniformLocation(Ki,"u_brightness"),tr=Vi.getUniformLocation(Ki,"u_whiteBalance"),or=Vi.createBuffer(),Vi.bindBuffer(Vi.ARRAY_BUFFER,or),Vi.bufferData(Vi.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),Vi.STATIC_DRAW),ar=Vi.createBuffer(),Vi.bindBuffer(Vi.ARRAY_BUFFER,ar),Vi.bufferData(Vi.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),Vi.STATIC_DRAW),Ni=Vi.createTexture(),Vi.bindTexture(Vi.TEXTURE_2D,Ni),Vi.texParameteri(Vi.TEXTURE_2D,Vi.TEXTURE_WRAP_S,Vi.CLAMP_TO_EDGE),Vi.texParameteri(Vi.TEXTURE_2D,Vi.TEXTURE_WRAP_T,Vi.CLAMP_TO_EDGE),Vi.texParameteri(Vi.TEXTURE_2D,Vi.TEXTURE_MIN_FILTER,Vi.LINEAR)}(),Vi.viewport(0,0,o,a)},zi.setAttribute("playsinline",""),zi.setAttribute("webkit-playsinline",""),await zi.load();const n=zi.play();void 0!==n&&await n.then((e=>{zi.muted=!0,zi.hidden=!0,Ri=!0})),Li(!0)}catch(e){qi()}}async function Yi(){window.stream&&window.stream.getTracks().forEach((e=>e.stop())),Ri=!1,Li(!1)}let Xi=[];const Gi=function(e,t){let o;return function(...a){clearTimeout(o),o=setTimeout((()=>e.apply(this,a)),t)}}((async function(){Ri&&"ended"===window.stream.getVideoTracks()[0].readyState&&(await Yi(),Ui(),await o(500)),navigator.mediaDevices.enumerateDevices().then((async e=>{const t=e.map((e=>e.deviceId));JSON.stringify(t)!==JSON.stringify(Xi)&&(await Ei(),Xi=t)}))}),100);function o(e){return new Promise((t=>setTimeout(t,e)))}function qi(){Li(!1),Ui()}function Ui(){const e=document.getElementById("displayCanvas"),t=e.getContext("2d");t.fillStyle="rgba(128, 128, 128, 1)",t.fillRect(0,0,e.width,e.height)}var Vi,Ni,ji,Zi,Ki,Ji,Qi,er,tr,or,ar;function nr(e,t,o){const a=e.createShader(t);return e.shaderSource(a,o),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)?a:(e.deleteShader(a),null)}navigator.mediaDevices.addEventListener("devicechange",Gi),$(document.body).on("click",(e=>{if(e.target===document.body)$n();else if("displayCanvas"===e.target.id)$n()}));