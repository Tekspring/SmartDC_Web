"use strict";const e="ImageDatabase",t="Images";function o(){return new Promise(((o,a)=>{const n=indexedDB.open(e,1);n.onupgradeneeded=e=>{e.target.result.createObjectStore(t,{keyPath:"name"})},n.onsuccess=e=>{const t=e.target.result;o(t)},n.onerror=e=>{a(e.target.error)}}))}var a,n=(a=navigator.userAgent).match(/chrome|chromium|crios/i)?"Chrome":a.match(/firefox|fxios/i)?"Firefox":a.match(/safari/i)?"Safari":a.match(/opr\//i)?"Opera":a.match(/edg/i)?"Edge":a.match(/msie|trident/i)?"Internet Explorer":"unknown";function r(e,t,o){var a=document.getElementById(t),n=document.createElement(e);n.id=o,a.appendChild(n)}function c(e,t){r("canvas",e,t)}function s(e,t){r("div",e,t)}function l(e,t){r("span",e,t)}function d(e,t){r("select",e,t)}function u(e,t){r("img",e,t)}function p(e,t){r("input",e,t)}function g(e,t){r("label",e,t)}function m(e,t){document.getElementById(e).hidden=!t}if(void 0===f)var f={over:0,normal:1,click:2};if(void 0===h)var h={left:1,right:3};if(void 0===b)var b={start:0,move:1,end:2,undo:3,redo:4,mirror:5,flip:6,brightness:7,zoom:8,pan:9,whiteBalance:10};if(void 0===v)var v={w:0,h:1,data:2};if(void 0===w)var w={value:0,status:1};if(void 0===I)var I={before:0,after:1};if(void 0===y)var y={toolBar:0,scrollBar:1,colorBar:2,sysToolBar:3,displayCanvas:4};if(void 0===x)var x={id:0,pic:1,state:2,groupId:3};function C(e,t,o,a,n,r){s(o,a),$("#"+a).data("btnData",e),function(e,t){var o,a="",n=e.length;for(o=0;o<n;o++)a+='<span class="'+t+' toolBar" id="'+e[o][x.id]+'"></span>';$("#"+t).html(a)}(e,a);var i="."+a;$(i).css(t);var c,l,d=!1,u=!1,p=!1,g=t.width,m=t.height;"right"===n&&(u=!0,g=0,d=!0),"left"===n&&(g=0,d=!0),"top-right"===n&&(u=!0,m=0,g=-t.width),"top-left"===n&&(m=0),"bottom"===n&&(g=60,m=0,p=!0),$(i).attr("style",(function(e,o){return o+(u?" left: calc(100% - "+(t.width-e*g)+"px);":" left: "+e*g+"px;")+(" top: "+(0+e*m)+"px;")})),$(i).hover(D,H),null==r?$(i).on("click",M):$(i).on("click",r),d&&(c={top:En+"px",height:"calc(100% - "+En+"px)",width:t.width+"px",background:xe.toolBarColorLeave,opacity:xe.toolBarOpacityLeave,position:"absolute"},u?c.right="0px":c.left="0px",$("#"+a).css(c)),p&&(l={top:"calc(100% - "+xe.scrollIconH+"px)",left:"340px",height:"30px",width:"60px",background:"#00000000",opacity:xe.toolBarOpacityLeave,position:"absolute"},$("#"+a).css(l))}function B(e,t){var o,a=e.length;for(o=0;o<a;o++)if(t===e[o][x.id])return o;return-1}function S(e,t,o){var a,n,r,i;a="#"+e[t][x.id],n=xr(e[t][x.pic]),$(a).css("background",n),Co?o===f.over?(r=xe.toolBarColorEnter,i=xe.toolBarOpacityEnter):o===f.normal?(r=xe.toolBarColorHide,i=xe.toolBarOpacityHide):(r=xe.toolBarColorClick,i=xe.toolBarOpacityClick):o===f.over?(r=xe.toolBarColorEnter,i=xe.toolBarOpacityEnter):o===f.normal?(r=xe.toolBarColorLeave,i=xe.toolBarOpacityLeave):(r=xe.toolBarColorClick,i=xe.toolBarOpacityClick),$(a).css("background-color",r),$(a).css("background-position","center center"),$(a).css("background-repeat","no-repeat"),$(a).css("opacity",i)}function W(e){var t,o=e.length;for(t=0;t<o;t++)1===e[t][x.state]?S(e,t,f.click):2===e[t][x.state]?S(e,t,f.over):S(e,t,f.normal)}function k(e,t){var o,a=e.length;for(o=0;o<a;o++)if(t===e[o][x.groupId]&&e[o][x.state]>0)return o;return-1}function _(e,t){var o,a=1;if(e[t][x.state]&&(a=0),o=e[t][x.groupId],function(e,t){var o,a=0,n=e.length;for(o=0;o<n;o++)t===e[o][x.groupId]&&(a+=1);return a}(e,o)>1&&(a=1),o>0){var n=k(e,o);n>=0&&o===e[n][x.groupId]&&(e[n][x.state]=0,S(e,n,f.normal))}e[t][x.state]=a,a&&(S(e,t,f.click),0===o&&setTimeout((function(){e[t][x.state]=0,S(e,t,f.normal)}),100))}function T(e,t){var o="#"+e.target.id,a=$(o).parent().data("btnData"),n=B(a,e.target.id);0===a[n][x.state]&&S(a,n,t)}function D(e){T(e,f.over)}function H(e){T(e,f.normal)}function M(e){pr(y.toolBar,f.click,e);var t=$("#"+e.target.id).parent().data("btnData"),o=B(t,e.target.id);o>=0&&_(t,o)}function z(e,t,o){var a,n=$("#"+e).data("btnData");for(a=0;a<n.length;a++)if(t==n[a][x.id])return n[a][x.state]=o,void W(n)}function P(e,t){var o,a=$("#"+e).data("btnData");for(o=0;o<a.length;o++)a[o][x.state]=t;W(a)}if(void 0===F)var F={color:0,state:1};function R(e,t,o,a,n){var r,i,c,l;s(o,a),r={position:"absolute","margin-left":"0px",background:xe.drawSetBackground,opacity:xe.drawSetOpacity},i=e.length,c=xe.colorIconW,l=xe.colorIconH,r.width=c*i+"px",r.height=l+"px",r.left="calc(100% - "+c*i+"px)",r.top="0px",$("#"+a).css(r),e.fnNotify=n,$("#"+a).data("colorData",e),function(e,t){var o,a,n=e.length;for(o=0;o<n;o++)s(t,a=e[o][F.color]),$("#"+a).addClass(t+" colorBar")}(e,a);var d="."+a;$(d).css(t),$(d).attr("style",(function(o,a){return a+(" left: calc(100% - "+t.width*(o+1)+"px);")+" top: 0px;"+(" background: #"+e[o][F.color]+";")+(" margin: "+xe.colorIconMarginNormal+"px;")+(" width: "+(t.width-2*xe.colorIconMarginNormal)+"px;")+(" height: "+(t.height-2*xe.colorIconMarginNormal)+"px;")})),$(d).hover(E,O),$(d).on("click",A),q($("#"+a))}function A(e){var t,o=$("#"+e.target.id).parent().data("colorData");for(t=0;t<o.length;t++)e.target.id===o[t][F.color]?o[t][F.state]=1:o[t][F.state]=0;X(o),q($("#"+e.target.id).parent()),pr(y.colorBar,f.click,e)}function L(e,t){var o="#"+e.target.id,a=$(o).parent().data("colorData"),n=function(e,t){var o,a=e.length;for(o=0;o<a;o++)if(t===e[o][F.color])return o;return-1}(a,e.target.id);0===a[n][F.state]&&Y(a,n,t)}function E(e){L(e,f.over)}function O(e){L(e,f.normal)}function Y(e,t,o){var a,n,r="#"+e[t][F.color];o===f.over?(a=xe.colorIconMarginOver,n=xe.colorIconW-2*xe.colorIconMarginNormal):o===f.normal?(a=xe.colorIconMarginNormal,n=xe.colorIconW-2*xe.colorIconMarginNormal):(a=xe.colorIconMarginClick,n=xe.colorIconW-2*xe.colorIconMarginClick),$(r).css("margin",a+"px"),$(r).css("width",n+"px"),$(r).css("height",n+"px")}function X(e){var t,o=e.length;for(t=0;t<o;t++)1===e[t][F.state]?Y(e,t,f.click):Y(e,t,f.normal)}function G(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,o,a){return t+t+o+o+a+a}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function q(e){var t,o,a,n,r,i=$(e).data("colorData");if(i.fnNotify)for(o=0;o<i.length;o++)i[o][F.state]&&(a=G("#"+(t=i[o][F.color])).r,n=G("#"+t).g,r=G("#"+t).b,i.fnNotify(t,a,n,r))}if(void 0===F)F={color:0,state:1};function V(e,t,o,a,n){var r,i,s,d;l(o,a),r={position:"absolute","margin-left":"0px",background:xe.drawSetBackground,opacity:xe.drawSetOpacity},i=e.length,s=xe.cb2BlockW,d=xe.cb2BlockH,r.width=s*i+"px",r.height=d+"px",r.left="calc(100% - "+s*i+"px)",r.top="0px",$("#"+a).css(r),e.fnNotify=n,$("#"+a).data("colorData",e),function(e,t){var o,a,n,r,i,s,d,u,p,g,m,f,h=e.length;d=xe.cb2BlockW-2*xe.cb2FrameGap,u=xe.cb2BlockH-2*xe.cb2FrameGap;var b={position:"absolute",left:xe.cb2FrameGap,top:xe.cb2FrameGap,width:d,height:u,opacity:1},v={position:"absolute",left:0,top:0,width:xe.scrollIconW,height:xe.scrollIconH,opacity:1};for(o=0;o<h;o++){p=Q("#"+(f=e[o][F.color])).r,g=Q("#"+f).g,m=Q("#"+f).b,l(t,a=f),r="#"+a,v.left=(h-1-o)*xe.scrollIconW,$(r).css(v),c(a,n=a+"_canvas"),r="#"+n,$(r).hover(j,Z),$(r).on("click",U),$(r).css(b),$(r).attr("width",d),$(r).attr("height",u),s=(i=document.getElementById(n)).getContext("2d"),Nn(i);var w="rgba("+p+", "+g+", "+m+", 1)";s.fillStyle=w,s.fillRect(0,0,d,u)}}(e,a),ee($("#"+a))}function U(e){var t,o=e.target.id,a=$("#"+o).parent().attr("id"),n=$("#"+a).parent().attr("id"),r=$("#"+n).data("colorData");for(t=0;t<r.length;t++)a===r[t][F.color]?r[t][F.state]=1:r[t][F.state]=0;J(r),ee($("#"+n)),pr(y.colorBar,f.click,e)}function N(e,t){var o=e.target.id,a=$("#"+o).parent().attr("id"),n=$("#"+a).parent().attr("id"),r=$("#"+n).data("colorData"),i=function(e,t){var o,a=e.length;for(o=0;o<a;o++)if(t===e[o][F.color])return o;return-1}(r,a);0===r[i][F.state]&&K(r,i,t)}function j(e){N(e,f.over)}function Z(e){N(e,f.normal)}function K(e,t,o){var a,n="#"+e[t][F.color];a=o===f.over?xe.cb2MouseColorEnter:o===f.normal?xe.cb2MouseColorLeave:xe.cb2MouseColorClick,$(n).css("background",a)}function J(e){var t,o=e.length;for(t=0;t<o;t++)1===e[t][F.state]?K(e,t,f.click):K(e,t,f.normal)}function Q(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,o,a){return t+t+o+o+a+a}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function ee(e){var t,o,a,n,r,i=$(e).data("colorData");if(i.fnNotify)for(o=0;o<i.length;o++)i[o][F.state]&&(a=Q("#"+(t=i[o][F.color])).r,n=Q("#"+t).g,r=Q("#"+t).b,i.fnNotify(t,a,n,r))}function te(e){var t="#"+e.target.id,o=$(t).parent().data("scrollData"),a=e.offsetX;a<=xe.scrollTickH/2&&(a=0),a>o.length&&(a=o.length),o.curPos=a,oe(o.id),ae(o.id)}function oe(e){var t,o,a,n,r,i,c,s,l=$("#"+e).data("scrollData");o=(t=document.getElementById(e+"-canvas")).getContext("2d"),Nn(t),s=(l.iconSize-xe.scrollTickH)/2,a=xe.scrollTickH/2,n=s+(xe.scrollTickH-xe.scrollLineH)/2,r=l.length,i=xe.scrollLineH,o.rect(a,n,r,i),o.fillStyle=l.color,o.fill(),a=xe.scrollTickH/2+l.curPos,n=s+xe.scrollTickH/2,c=xe.scrollTickH/2,o.arc(a,n,c,0,2*Math.PI,!1),o.fillStyle=l.color,o.fill()}function ae(e){var t=$("#"+e).data("scrollData");t.fnNotify&&t.fnNotify(t.length,t.curPos)}function ne(e,t){var o=$("#"+e).data("scrollData");t<=o.length&&(o.curPos=t,oe(e))}function re(e,t,o,a,n){var r=t+"-icon";l(e,r),r="#"+r,$(r).css({background:xr(o),top:n,left:a,width:xe.toolBarIconW+"px",height:xe.toolBarIconH+"px",position:"absolute"});var i=t+"-slider";return p(e,i),r="#"+i,$(r).attr("class","slider"),$(r).css({top:n,left:a+xe.toolBarIconW+16,width:"200px",height:xe.toolBarIconH+"px",position:"absolute"}),l(e,r=t+"-reset"),r="#"+r,$(r).css("background",xr("undo.png")),$(r).css("top",n+"px"),$(r).css("left",a+xe.toolBarIconW+16+200+16+"px"),$(r).css("width",xe.toolBarIconW+"px"),$(r).css("height",xe.toolBarIconH+"px"),$(r).css("position","absolute"),$(r).on("click",(function(){$("#"+i).val(0),$("#"+i).trigger("input")})),i}function ie(e,t,o,a,n,r=!1){var i,s,d,u,p={position:"absolute","margin-left":"0px",background:xe.scrollDlgBkg,opacity:xe.scrollDlgOpacity};l(o,a),s=e.iconSize+xe.scrollIconGap+e.length+xe.scrollTickH,void 0!==e.iconR&&(s+=xe.scrollIconGap+e.iconSize),d=e.iconSize+xe.toolBarIconH,p.left="calc(50% - "+s/2+"px)",p.top="calc(50% - "+(d-xe.titleIconH)/2+"px)",p.width=s+"px",p.height=d+"px",$("#"+a).css(p),l(a,i=a+"-close"),i="#"+i,u=xr("close.png"),$(i).css("background",u),$(i).css("top","0px"),$(i).css("left",s-xe.toolBarIconW+"px"),$(i).css("width",xe.toolBarIconW+"px"),$(i).css("height",xe.toolBarIconH+"px"),$(i).css("position","absolute"),$(i).on("click",ce),r&&(l(a,i=a+"-reset"),i="#"+i,u=xr("undo.png"),$(i).css("background",u),$(i).css("top","0px"),$(i).css("left",s/2-xe.toolBarIconW/2+"px"),$(i).css("width",xe.toolBarIconW+"px"),$(i).css("height",xe.toolBarIconH+"px"),$(i).css("position","absolute"),$(i).on("click",(function(){ne(a+"-scrollbar",e.length/2),oe(a+"-scrollbar"),ae(a+"-scrollbar")}))),i=a+"-scrollbar",e.startY=xe.toolBarIconH,function(e,t,o,a,n){var r,i,s,d,u,p,g,m,b;l(o,a),g=e.iconSize+xe.scrollIconGap+e.length+xe.scrollTickH,void 0!==e.iconR&&(g+=xe.scrollIconGap+e.iconSize),t.left=e.startX+"px",t.top=e.startY+"px",t.width=g+"px",t.height=e.iconSize+"px",$("#"+a).css(t),e.id=a,e.mouseDown=!1,e.fnNotify=n,$("#"+a).data("scrollData",e),l(a,r=a+"-iconL"),c(a,m=a+"-canvas"),d=0,i="#"+r,s=xr(e.iconL),$(i).css("background",s),$(i).css("top","0px"),$(i).css("left",d+"px"),$(i).css("width",e.iconSize+"px"),$(i).css("height",e.iconSize+"px"),$(i).css("position","absolute"),d+=e.iconSize,d+=xe.scrollIconGap,i="#"+m,u=e.length+xe.scrollTickH,p=e.iconSize,$(i).css("top","0px"),$(i).css("left",d+"px"),$(i).css("width",u+"px"),$(i).css("height",p+"px"),$(i).css("position","absolute"),$(i).attr("width",u),$(i).attr("height",p),d+=u,void 0!==e.iconR&&(l(a,r=a+"-iconR"),d+=xe.scrollIconGap,i="#"+r,s=xr(e.iconR),$(i).css("background",s),$(i).css("top","0px"),$(i).css("left",d+"px"),$(i).css("width",e.iconSize+"px"),$(i).css("height",e.iconSize+"px"),$(i).css("position","absolute")),ae(a),i="#"+m,b=$("#"+a).data("scrollData"),$(i).on("mousedown",(function(e){h.left===e.which&&(b.mouseDown=!0,te(e),pr(y.scrollBar,f.click,e))})).on("mousemove",(function(e){b.mouseDown&&te(e)})).on("mouseup",(function(){h.left===event.which&&(b.mouseDown=!1)})).on("mouseout",(function(){h.left===event.which&&(b.mouseDown=!1)})).on("touchstart",(function(e){Fn(e)})).on("touchmove",(function(e){Fn(e)})).on("touchend",(function(){Fn(event)})).on("touchcancel",(function(){Fn(event)}))}(e,t,a,i,n),oe(i)}function ce(e){cr()}if(void 0===se)var se={move:0,trAnchor:1,tlAnchor:2,brAnchor:3,blAnchor:4,down:5};function le(){var e,t,o,a={dispX:0,dispY:0,dispW:0,dispH:0,imgSrc:0,isActive:!1,x:0,y:0,w:0,h:0,mouseDown:!1,type:se.down,startX:0,startY:0};$("#importPictureWin").data("picData",a),e=xe.ipwRadius,t={position:"absolute",left:e+"px",top:e+"px",width:"calc(100% - "+2*e+"px)",height:"calc(100% - "+2*e+"px)",opacity:xe.ipwOpacity},c("importPictureWin","importPicture"),$("#importPicture").css(t),fe("importPicture",se.move),$("#importPictureWin").on("dblclick",(function(e){we(!0)})),o=xe.ipwRadiusExpandRatio,(o=Math.floor(o))<1&&(o=1),Bn.ipwRadiusExpandRatio=o,de("tlAnchor",se.tlAnchor),de("trAnchor",se.trAnchor),de("blAnchor",se.blAnchor),de("brAnchor",se.brAnchor),be(!1)}function de(e,t){var o,a,n,r,i,s="#"+e,l=xe.ipwRadius;switch(i=(r=2*l)*((n=Bn.ipwRadiusExpandRatio)-1)/2,Bn.ipwExtraSpace=i,c("importPictureWin",e),t){case se.trAnchor:o="calc(100% - "+(r+i)+"px)",a=-i+"px";break;case se.tlAnchor:o=-i+"px",a=-i+"px";break;case se.brAnchor:o="calc(100% - "+(r+i)+"px)",a="calc(100% - "+(r+i)+"px)";break;case se.blAnchor:o=-i+"px",a="calc(100% - "+(r+i)+"px)"}var d={position:"absolute",left:o,top:a,width:(r*=n)+"px",height:r+"px",opacity:xe.ipwOpacity};$(s).css(d),$(s).attr("width",r),$(s).attr("height",r);var u=2*Math.PI,p=document.getElementById(e).getContext("2d");p.fillStyle=xe.ipwColor,p.strokeStyle=xe.ipwColor,p.lineWidth=xe.ipwLineWidth,p.beginPath(),p.arc(l+i,l+i,l,0,u,!1),p.closePath(),p.fill(),fe(e,t)}var ue=!1;function pe(){var e=Bn.curMode.imgW/Xe,t="#importPictureWin",o=$(t).data("picData");o.x=($(t).offset().left-qe)*e,o.y=($(t).offset().top-Ve)*e,o.w=$(t).width()*e,o.h=$(t).height()*e,o.dispX=$(t).offset().left-qe,o.dispY=$(t).offset().top-Ve,o.dispW=$(t).width(),o.dispH=$(t).height()}function ge(e,t){var o=$("#importPictureWin").data("picData"),a=t.clientX-o.startX,n=t.clientY-o.startY,r=o.dispX,i=o.dispY,c=o.dispW,s=o.dispH;switch(e){case se.trAnchor:c+=a,i+=n,s-=n;break;case se.tlAnchor:r+=a,c-=a,i+=n,s-=n;break;case se.brAnchor:c+=a,s+=n;break;case se.blAnchor:r+=a,c-=a,s+=n}var l={left:qe+r,top:Ve+i,width:c,height:s};$("#importPictureWin").css(l)}function me(e){var t=$("#importPictureWin").data("picData"),o=e.clientX-t.startX,a=e.clientY-t.startY,n={left:qe+t.dispX+o,top:Ve+t.dispY+a};$("#importPictureWin").css(n)}function fe(e,t){var o="#importPictureWin",a=$(o).data("picData");Bn.curMode,xe.ipwRadius;o="#"+e,$(o).on("mousedown",(function(e){h.left===e.which&&function(e,t){var o,a,n=2*xe.ipwRadius,r=Bn.ipwExtraSpace;return se.move==t||(o=e.offsetX,a=e.offsetY,o>=r&&o<r+n&&a>=r&&a<r+n)}(e,t)&&(a.mouseDown=!0,a.startX=e.clientX,a.startY=e.clientY,a.type=t,ue=!0)})).on("dblclick",(function(e){we(!0)})).on("mousemove",(function(e){if(a.mouseDown)switch(a.type){case se.move:me(e);break;case se.trAnchor:case se.tlAnchor:case se.brAnchor:case se.blAnchor:ge(a.type,e)}})).on("mouseup",(function(e){h.left===e.which&&(a.mouseDown=!1,pe(),ue=!1)})).on("mouseout",(function(e){h.left,e.which})).on("touchstart",(function(e){Fn(e)})).on("touchmove",(function(e){Fn(e)})).on("touchend",(function(e){Fn(e)})).on("touchcancel",(function(e){Fn(e)}))}function he(e){var t,o,a=Bn.curMode,n="#importPictureWin",r=xe.ipwRadius;t=e.width,o=e.height;var i=200;t<i&&(o=o*i/t,t=i),o<i&&(t=t*i/o,o=i);var c,s,l,d,u=a.imgW-2*r,p=a.imgH-2*r;t>u&&(o=o*u/t,t=u),o>p&&(t=t*p/o,o=p),e.width,e.height,l=t+2*r,d=o+2*r,c=(a.imgW-l)/2,s=(a.imgH-d)/2;var g=$(n).data("picData");g.imgSrc=e,g.dispW=Xe,g.dispH=Ge,g.x=c,g.y=s,g.w=l,g.h=d,g.isActive=!0,ve(),n="#importPicture",$(n).attr("width",e.width),$(n).attr("height",e.height),document.getElementById("importPicture").getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height),be(!0)}function be(e){var t=$("#importPictureWin").data("picData");m("importPictureWin",e),t.isActive=e}function ve(){var e,t,o,a,n,r=$("#importPictureWin").data("picData"),i=Bn.curMode;if(void 0!==r&&0!=r.isActive){n=Xe/i.imgW,e=r.x*n,t=r.y*n,o=r.w*n,a=r.h*n;var c={position:"absolute",left:qe+e,top:Ve+t,width:o,height:a,opacity:xe.ipwOpacity};$("#importPictureWin").css(c),r.dispX=e,r.dispY=t,r.dispW=o,r.dispH=a}}function we(e){if(e){var t=$("#importPictureWin").data("picData"),o=Bn.curMode,a=Bn.drawContext,n=xe.ipwRadius*o.imgW/Xe;0!=t.isActive&&(jn(),a.drawImage(t.imgSrc,0,0,t.imgSrc.width,t.imgSrc.height,t.x+n,t.y+n,t.w-2*n,t.h-2*n),ar(b.end),o.imageProcess&&o.imageProcess(),be(!1),qo&&attachCropBox(Xe,Ge))}else be(!1)}const Ie="SmartDc";var ye={resizeDelayMs:100,iconW:48,iconH:48,drawSetH:30,ColorEnter:"#555",ColorLeave:"#222",ColorClick:"#5B0303",ColorHide:"#000",OpacityEnter:"0.8",OpacityLeave:"0.8",OpacityClick:"0.8",OpacityHide:"0",resolutionIdx:-1,languageIdx:0},xe={cfgVersion:"1.5.0",bgColor:"#000",titleIconH:ye.iconH,toolBarIconW:ye.iconW,toolBarIconH:ye.iconH,modeIconW:100,modeIconH:ye.iconH,mouseColorEnter:ye.ColorEnter,mouseColorLeave:ye.ColorLeave,mouseColorClick:ye.ColorClick,mouseOpacityEnter:ye.OpacityEnter,mouseOpacityLeave:ye.OpacityLeave,mouseOpacityClick:ye.OpacityClick,drawSetH:ye.drawSetH,drawSetBackground:ye.ColorLeave,drawSetOpacity:ye.OpacityLeave,colorIconW:30,colorIconH:ye.drawSetH,colorIconMarginClick:3,colorIconMarginNormal:6,colorIconMarginOver:4,colorIconOpacity:"1.0",cb2Apply:1,cb2BlockW:30,cb2BlockH:ye.drawSetH,cb2FrameGap:6,cb2MouseColorEnter:ye.ColorEnter,cb2MouseColorLeave:ye.ColorLeave,cb2MouseColorClick:ye.ColorClick,scrollIconW:30,scrollIconH:ye.drawSetH,scrollIconGap:0,scrollTickH:12,scrollLineH:2,scrollColor:"#EEE",scrollGroupGap:8,scrollOpacityW:90,scrollOpacityDefPos:80,scrollLineWidthW:90,scrollLineWidthDefPos:30,lineWidthMin:4,lineWidthMax:40,scrollDlgBkg:ye.ColorLeave,scrollDlgOpacity:ye.OpacityLeave,scrollBrighnessW:180,scrollBrighnessDefPos:90,brightnewwMin:-128,brightnewwMax:128,whiteBalanceMin:-25,whiteBalanceMax:25,scrollZoomW:180,scrollZoomDefPos:0,zoomMaxRatio:8,panWinGapX:4,panWinGapY:4,panWinColor:ye.ColorLeave,panCropColor:"#555",panOpacity:ye.OpacityLeave,sdBkg:ye.ColorLeave,sdOpacity:ye.OpacityLeave,sdIconW:ye.iconW,sdIconH:ye.iconH,sdExtraW:14,sdIconScrollGap:4,sdGroupGap:0,sdScrollGap:8,sdFrameGapX:4,sdFrameGapY:4,sdScrollH:30,sdVideoRsoW:120,sdFontFamilyW:120,sdFontStyleW:120,sdFontSizeW:60,tidBkg:ye.ColorLeave,tidOpacity:ye.OpacityLeave,tidIconW:ye.iconW,tidIconH:ye.iconH,tidTextFrmW:300,tidTextFrmH:200,tidFrameGap:8,tidIconFrmGap:4,tidTextSize:20,eraserOpacity:.8,minArrowSize:10,toolBarColorEnter:ye.ColorEnter,toolBarColorLeave:ye.ColorLeave,toolBarColorClick:ye.ColorClick,toolBarColorHide:ye.ColorHide,toolBarOpacityEnter:ye.OpacityEnter,toolBarOpacityLeave:ye.OpacityLeave,toolBarOpacityClick:ye.OpacityClick,toolBarOpacityHide:ye.OpacityHide,ipwColor:"#AAA",ipwOpacity:1,ipwLineWidth:6,ipwRadius:16,ipwRadiusExpandRatio:1,defPreviewRsoX:1280,defPreviewRsoY:720,defDrawingBoardW:1920,defDrawingBoardH:1080,drawingBoardBgColor:"#FFF",defPictureW:1920,defPictureH:1080,thumbW:160,thumbH:120,thumbPadding:10,thumbFrmSize:4,thumbFrmColorNormal:"#000",thumbFrmColorChecked:"#FF0",pbInfoW:240,pbInfoH:24,pbInfoColor:"#FF0",pbInfoColor_Page:"#FF0",pbInfoColor_Item:"#3F3",pbInfoFontSize:"150%",pbInfoFontWWeight:"normal",aboutWinW:400,aboutWinH:340,aboutBkg:"#222",aboutOpacity:1,aboutIconW:ye.iconW,aboutIconH:ye.iconH,aboutGapX:30,pcdBkg:ye.ColorLeave,pcdOpacity:ye.OpacityLeave,pcdIconOverlayY:20,pcdIconW:ye.iconW,pcdIconH:ye.iconH,pcdTextW:80,pcdTextH:20,pcdUnitW:60,pcdUnitH:16,pcdUnitOffsetY:4,pcdExtraW:12,pcdCapturePeriodSec:1,pcdCaptureIntervalHour:1,pcibBkg:ye.ColorLeave,pcibOpacity:ye.OpacityLeave,pcibIconW:ye.iconW,pcibIconH:ye.iconH,pcibTextH:24,pcibTextW:120,pcibTextColor:"#2F2",pcibTextFontSize:"150%",pcidGapY:4,cdIconW:ye.iconW,cdIconH:ye.iconH,cdFrameGap:26,cdIconGap:10,cdBkg:ye.ColorLeave,cdOpacity:ye.OpacityLeave,cdMouseColorEnter:ye.ColorEnter,cdMouseColorLeave:ye.ColorLeave,cdMouseColorClick:ye.ColorClick,sysInfoWinW:88,sysInfoWinH:82,sysInfoH:16,sysInfoGap:4,disableDrawingCanvasOverlay:0,disableDrawingToolBar:0,disableColorBar:0,disableDrawingOpacityScrollBar:0,disableDrawingLineWidthScrollBar:0,disableDrawTextSetting:0},Ce=[["btn_freehand","freeHand.png",0,1],["btn_arrow","arrow.png",0,1],["btn_eraser","ereser.png",0,1],["btn_line","line.png",0,1],["btn_rectangleLine","rectangleLine.png",0,1],["btn_rectangle","rectangle.png",0,1],["btn_circleLine","circleLine.png",0,1],["btn_circle","circle.png",0,1],["btn_erase_all","clearAll.png",0,0],["btn_text","text.png",0,1]],$e=[],Be=[["btn_record","record.png",0,0]],Se=[["btn_setting","setting.png",0,0],["btn_capture","capture.png",0,0],["btn_freeze","Freeze.png",0,3],["btn_timesave","timesave.png",0,0],["btn_mirrow","mirrow.png",0,5],["btn_flip","flip.png",0,6],["btn_config","config.png",0,0],["btn_zoom","zoom.png",0,0],["btn_importPic","inportPic.png",0,0],["btn_redo","redo.png",0,0],["btn_undo","undo.png",0,0]],We=[["scbtn_transform","perspectiveImage.png",0,0],["scbtn_importPic","inportPic.png",0,0],["Dummy","dummy.png",0,0],["scbtn_fullcrop","fullPhoto.png",0,6],["scbtn_redo","redo.png",0,0],["scbtn_undo","undo.png",0,0]],ke=[["scbtn_preview","backScanMode.png",0,0],["scbtn_saveDisk","savePlayback.png",0,0],["scbtn_ocr","ocr.png",0,0],["Dummy","dummy.png",0,0],["scbtn_mirrow","mirrow.png",0,5],["scbtn_flip","flip.png",0,6],["scbtn_redo2","redo.png",0,0],["scbtn_undo2","undo.png",0,0]],_e=[["mscbtn_capture","perspectiveImage.png",0,0],["mscbtn_merge","Merge_multiscan.png",0,0],["mscbtn_cancel","close.png",0,0],["Dummy","dummy.png",0,0],["mscbtn_fullcrop","fullPhoto.png",0,6]],Te=[["mode_about","about.png",0,0],["mode_preview","preview.png",1,1],["mode_playback","playback.png",0,1],["mode_drawingBoard","drawingboard.png",0,1]],De=[["sys_fullPhoto","fullPhoto.png",0,1]],He=[["btn_saveDisk","saveDisk.png",0,0],["btn_delete","delete.png",0,0],["Dummy","dummy.png",0,0],["btn_Next","next_page.png",0,0],["btn_Previous","previous_page.png",0,0]],Me=[["ppbtn_savePlayback","savePlayback.png",0,0],["ppbtn_closeAndBackPlayback","closeAndBackPlayback.png",0,0],["ppbtn_zoom","zoom.png",0,0],["ppbtn_importPic","inportPic.png",0,0],["ppbtn_redo","redo.png",0,0],["ppbtn_undo","undo.png",0,0]],ze=[["dbbtn_savePlayback","savePlayback.png",0,0],["dbbtn_redo","redo.png",0,0],["dbbtn_undo","undo.png",0,0],["dbbtn_importPic","inportPic.png",0,0]],Pe=[["782D91",0],["1B1464",0],["0000FF",1],["00FF00",0],["FFFF00",0],["F15A24",0],["FF0000",0],["FFFFFF",0],["999999",0],["000000",0]],Fe=[],Re=[["Arial",1],["Serif",0],["Verdana",0],["Courier New",0]],Ae=[["lbNormal",1],["lbBold",0],["lbItalic",0],["lbBoldItalic",0]],Le=[["English",1,"./locales/en/messages.json"],["Deutsch",0,"./locales/de/messages.json"],["Française",0,"./locales/fr/messages.json"],["Español",0,"./locales/es/messages.json"],["繁體中文",0,"./locales/zh_TW/messages.json"],["Русский",0,"./locales/ru/messages.json"]],Ee=[[8,0],[12,0],[16,0],[20,0],[24,0],[28,1],[36,0],[48,0],[72,0]];var Oe,Ye,Xe,Ge,qe,Ve,Ue=[[1280,720,1],[1024,768,0]],Ne=[[1920,1080,0],[1280,720,1],[1024,768,0]],je=[[1920,1080,0],[1280,720,1],[1024,768,0]],Ze=[[1920,1080,0],[1280,720,1],[1024,768,0]],Ke=[[4160,3120,0],[3840,2160,0],[2048,1536,0],[1920,1080,0],[1280,1024,0],[1280,960,0],[1280,720,1],[1024,768,0],[640,480,0]],Je=[[3264,2448,0],[2592,1944,0],[2048,1536,0],[1920,1080,0],[1600,1200,0],[1280,960,0],[1280,720,1],[1024,768,0]],Qe=[[1920,1080,0],[1280,720,1],[1024,768,0]],et=[[0,0,Qe],[1276,21264,Ue],[1276,21296,Ue],[1276,21305,Ue],[1276,25392,Ne],[1276,25401,Ne],[1276,25424,je],[1276,25433,je],[1276,25856,Ze],[1276,25865,Ze],[1276,34185,Ke],[4429,34185,Ke],[1276,9760,Je],[1276,9856,Je],[1276,8329,[[2592,1944,0],[2048,1536,0],[1920,1080,0],[1600,1200,0],[1280,960,0],[1280,720,1],[1024,768,0]]],[1276,9864,[[3840,3104,0],[3840,2160,0],[3264,2448,0],[2592,1944,0],[2048,1536,0],[1920,1080,0],[1600,1200,0],[1280,720,1],[1024,768,0]]],[1276,9808,[[2560,1920,0],[2560,1440,0],[2048,1536,0],[1920,1080,0],[1600,1200,0],[1280,960,0],[1280,720,1],[1024,768,0]]]];function tt(e,t,o){var a={position:"absolute",left:0,top:0,width:t,height:o,display:!1},n="#"+e;$(n).css(a),$(n).attr("width",t),$(n).attr("height",o)}function ot(e,t,o,a){c(e,t),tt(t,o,a)}function at(e){var t,o,a=["baseImageCanvas","imageProcessCanvas","drawingCanvas","tempDrawingCanvas","combineCanvas"];for(t=0;t<a.length;t++)o=e+"-"+a[t],document.getElementById(o).hidden=!0}function nt(e,t,o){var a,n=["baseImageCanvas","imageProcessCanvas","drawingCanvas","tempDrawingCanvas","combineCanvas"];for(a=0;a<n.length;a++)ot(e,e+"-"+n[a],t,o)}function rt(e,t,o){var a,n=["baseImageCanvas","imageProcessCanvas","drawingCanvas","tempDrawingCanvas","combineCanvas"];for(a=0;a<n.length;a++)tt(e.baseId+"-"+n[a],t,o)}function it(e){var t,o,a=["baseImageCanvas","imageProcessCanvas","drawingCanvas","tempDrawingCanvas","combineCanvas"],n=["baseImageContext","imageProcessContext","drawingContext","tempDrawingContext","combineContext"];for(o=0;o<a.length;o++)t=e.baseId+"-"+a[o],e[a[o]]=document.getElementById(t),e[n[o]]=e[a[o]].getContext("2d")}!function(){var e,t,o,a,n,i;e="div",t="baseArea",(o=document.createElement(e)).id=t,document.body.appendChild(o),s("baseArea","appTitle"),s("baseArea","previewArea"),r("video","previewArea","videoSrc"),nt("previewArea",xe.defPreviewRsoX,xe.defPreviewRsoY),s("baseArea","playbackArea"),nt("playbackArea",xe.defPictureW,xe.defPictureH),s("baseArea","drawingArea"),nt("drawingArea",xe.defDrawingBoardW,xe.defDrawingBoardH),s("baseArea","imageDisplayArea"),c("imageDisplayArea","displayCanvas"),c("imageDisplayArea","saveFileCanvas"),s("baseArea","uiArea"),l("uiArea","importPictureWin"),s("uiArea","drawingCfgArea"),a={position:"absolute","margin-left":"0px",background:xe.drawSetBackground,opacity:xe.drawSetOpacity},n=xe.toolBarIconW,i=xe.drawSetH,a.width="calc(100% - "+2*n+"px)",a.height=i+"px",a.left=n+"px",a.top="calc(100% - "+i+"px)",$("#drawingCfgArea").css(a),l("uiArea","panWin"),c("panWin","cropWin"),l("uiArea","settingDlg"),l("uiArea","textInputDlg"),Oe=document.getElementById("displayCanvas"),Ye=Oe.getContext("2d");const d=`${Oe.getAttribute("style")||""}; filter: url(#filter)`;Oe.setAttribute("style",d),at("previewArea"),at("playbackArea"),at("drawingArea"),m("saveFileCanvas",!1)}();var ct={position:"absolute",left:0,top:0,width:800,height:260,style:"border:1px dashed black",background:xe.bgColor};function st(){var e,t,o,a,n,r,i;Co?(t=An,o=Ln):(t=An-2*ye.iconW,o=Ln-En-ye.drawSetH),t*Bn.imgH<o*Bn.imgW?(r=t,a=(An-t)/2,i=Math.floor(r*Bn.imgH/Bn.imgW),n=Math.floor((o-i)/2)):(i=o,n=0,r=Math.floor(i*Bn.imgW/Bn.imgH),a=Math.floor((t-r)/2),Co||(a+=ye.iconW)),Co||(n+=En),ct.left=a,ct.top=n,ct.width=r,ct.height=i,(e=$("#displayCanvas")).css(ct),e.attr("width",r),e.attr("height",i),qe=a,Ve=n,Xe=r,Ge=i}var lt,dt,ut=[];function pt(e,t){m(e,t)}function gt(e,t,o,a){Bn.colorHex=e,Bn.colorR=t,Bn.colorG=o,Bn.colorB=a,er()}function mt(e,t,o,a,n){l(t,o);var r=o+"-iconL";l(o,r);var i=e.startX;d="#"+r;var c=xr(e.iconL);$(d).css("background",c),$(d).css("top","0px"),$(d).css("left",i+"px"),$(d).css("width",e.iconSize+"px"),$(d).css("height",e.iconSize+"px"),$(d).css("position","absolute"),i+=e.iconSize;var s=o+"-slider";p(t=o,s);var d="#"+s;$(d).attr("class","slider_min"),$(d).css({top:0,left:i,width:"100px",height:"30px",position:"absolute"}),$(d).attr({type:"range",max:100,min:0,step:2,value:n});d="#"+s;$(d).on("input",a),a(n)}function ft(){var e={position:"absolute","margin-left":"0px"};ie({iconL:"brightness_down.png",iconR:"brightness_up.png",iconSize:xe.toolBarIconW,length:xe.scrollBrighnessW,curPos:xe.scrollBrighnessDefPos,startX:0,startY:0,color:xe.scrollColor},e,"uiArea","brightnessDlg",vt,!0),ht(!1),ie({iconL:"wb_b.png",iconR:"wb_r.png",iconAuto:"undo.png",iconSize:xe.toolBarIconW,length:xe.scrollBrighnessW,curPos:xe.scrollBrighnessDefPos,startX:0,startY:0,color:xe.scrollColor},e,"uiArea","whiteBalanceDlg",wt,!0),bt(!1),function(){var e,t,o="zoomDlg",a=24,n=36,r=380,i=120;s("uiArea",o),e="#"+o,$(e).css("background",ye.ColorLeave),$(e).css("top","calc(50%)"),$(e).css("left",xe.toolBarIconW+"px"),$(e).css("width",r+"px"),$(e).css("height",i+"px"),$(e).css("position","absolute"),$(e).hide(),l(o,e=o+"-close"),e="#"+e;var c=xr("close.png");$(e).css("background",c),$(e).css("top","0px"),$(e).css("left",r-xe.toolBarIconW+"px"),$(e).css("width",xe.toolBarIconW+"px"),$(e).css("height",xe.toolBarIconH+"px"),$(e).css("position","absolute"),$(e).on("click",(function(){$("#"+o).hide()})),t=function(e,t,o,a,n,r){var i;l(e,i=t+"-icon-L"),i="#"+i,$(i).css({background:xr(o),top:r,left:n,width:xe.toolBarIconW+"px",height:xe.toolBarIconH+"px",position:"absolute"}),l(e,i=t+"-icon-R"),i="#"+i,$(i).css({background:xr(a),top:r,left:n+xe.toolBarIconW+16+200+16,width:xe.toolBarIconW+"px",height:xe.toolBarIconH+"px",position:"absolute"});var c=t+"-slider";return p(e,c),i="#"+c,$(i).attr("class","slider"),$(i).css({top:r,left:n+xe.toolBarIconW+16,width:"200px",height:xe.toolBarIconH+"px",position:"absolute"}),c}(o,e=o+"-zoom","zoom_in.png","zoom_out.png",a,n),e="#"+t,$(e).attr({type:"range",max:100,min:0,step:2,value:0}),$(e).on("input",(function(e){var t=1+(xe.zoomMaxRatio-1)*e.currentTarget.value/100;t=t.toFixed(1),Bn.curMode&&Br(t,e.currentTarget.value)}))}()}function ht(e){m("brightnessDlg",e)}function bt(e){m("whiteBalanceDlg",e)}function vt(e,t){var o;o=xe.brightnewwMin+(xe.brightnewwMax-xe.brightnewwMin)*t/e,o=Math.floor(o),Bn.previewBrightnessAdj=o,Bn.curMode&&ar(b.brightness)}function wt(e,t){var o;o=xe.whiteBalanceMin+(xe.whiteBalanceMax-xe.whiteBalanceMin)*t/e,o=Math.floor(o),Bn.previewWhiteBalanceAdj=o,Bn.curMode&&ar(b.whiteBalance)}function It(){var e,t,o,a,n,r,i,c,s,l,u,p={position:"absolute","margin-left":"0px",background:xe.sdBkg,opacity:xe.sdOpacity},g=3;1===xe.disableDrawTextSetting&&(g=1),e=2*xe.sdFrameGapX+xe.sdIconW+xe.sdIconScrollGap+xe.sdFontFamilyW+xe.sdFontStyleW+xe.sdFontSizeW+2*xe.sdScrollGap,e+=xe.sdExtraW,t=xe.sdFrameGapY*g+xe.sdIconH*(g+1)+xe.sdGroupGap,p.left="calc(50% - "+e/2+"px)",p.top="calc(50% - "+(t-xe.titleIconH)/2+"px)",p.width=e+"px",p.height=t+"px",$("#settingDlg").css(p),yt("settingDlg","sdClsoeIcon","close.png",o=e-xe.sdFrameGapX-xe.sdIconW,a=xe.sdFrameGapY),$("#sdClsoeIcon").on("click",Ua),a=+xe.sdIconH,yt("settingDlg","sdVideoRsoIcon","setting_reslution.png",o=xe.sdFrameGapX,a),o+=xe.sdIconW+xe.sdIconScrollGap,n="settingDlg",r="sdVideoRsoScrollbar",i=Bn.curVideoResolutionList,c=o,s=a,l=xe.sdVideoRsoW,Bn.idVideoResolutionList=r,d(n,r),Ct(i),u="#"+r,$(u).css("top",s+(xe.sdIconH-xe.sdScrollH)/2+"px"),$(u).css("left",c+"px"),$(u).css("width",l+"px"),$(u).css("height",xe.sdScrollH+"px"),$(u).css("position","absolute"),a+=xe.sdIconH+xe.sdGroupGap,0===xe.disableDrawTextSetting&&(yt("settingDlg","sdFontIcon","setting_textEdit.png",o=xe.sdFrameGapX,a),o+=xe.sdIconW+xe.sdIconScrollGap,$t("settingDlg","sdfontFamily",Re,o,a,xe.sdFontFamilyW),o+=xe.sdFontFamilyW+xe.sdScrollGap,function(e,t,o,a,n,r){var i,c,s,l="";for(d(e,t),l="",i=0;i<o.length;i++)c=t+"-"+o[i][w.value],s="WebMod",l+="<option"+(1===o[i][w.status]?' selected="true"':"")+' id="'+c+'">'+s+"</option>";$("#"+t).html(l),c="#"+t,$(c).css("top",n+(xe.sdIconH-xe.sdScrollH)/2+"px"),$(c).css("left",a+"px"),$(c).css("width",r+"px"),$(c).css("height",xe.sdScrollH+"px"),$(c).css("position","absolute")}("settingDlg","fontStyle",Ae,o,a,xe.sdFontStyleW),o+=xe.sdFontStyleW+xe.sdScrollGap,$t("settingDlg","fontSize",Ee,o,a,xe.sdFontSizeW),a+=xe.sdIconH+xe.sdGroupGap),yt("settingDlg","sdLanguageIcon","setting_language.png",o=xe.sdFrameGapX,a),o+=xe.sdIconW+xe.sdIconScrollGap,function(e,t,o,a,n,r){var i,c,s,l="";for(d(e,t),l="",i=0;i<o.length;i++)c=t+"-"+o[i][w.value],s=o[i][w.value],l+="<option"+(1===o[i][w.status]?' selected="true"':"")+' id="'+c+'">'+s+"</option>";$("#"+t).html(l),c="#"+t,$(c).css("top",n+(xe.sdIconH-xe.sdScrollH)/2+"px"),$(c).css("left",a+"px"),$(c).css("width",r+"px"),$(c).css("height",xe.sdScrollH+"px"),$(c).css("position","absolute")}("settingDlg","sdLanguageFamily",Le,o,a,xe.sdFontFamilyW),Bt(!1),dr()}function yt(e,t,o,a,n){var r,i;l(e,t),r="#"+t,i=xr(o),$(r).css("background",i),$(r).css("top",n+"px"),$(r).css("left",a+"px"),$(r).css("width",xe.sdIconW+"px"),$(r).css("height",xe.sdIconH+"px"),$(r).css("position","absolute")}function xt(e){var t;t="#"+Bn.idVideoResolutionList,$(t+" > option").remove(),Ct(e)}function Ct(e){var t,o,a,n,r,i="";for(r=Bn.idVideoResolutionList,i="",t=0;t<e.length;t++)o=r+"-"+e[t][v.w]+"x"+e[t][v.h],a=e[t][v.w]+" x "+e[t][v.h],-1==ye.resolutionIdx||ye.resolutionIdx>=e.length?1===e[t][v.data]?(n=' selected="true"',Bn.reqImgW=e[t][v.w],Bn.reqImgH=e[t][v.h]):n="":t==ye.resolutionIdx?(n=' selected="true"',Bn.reqImgW=e[t][v.w],Bn.reqImgH=e[t][v.h]):n="",i+="<option"+n+' id="'+o+'">'+a+"</option>";$("#"+r).html(i)}function $t(e,t,o,a,n,r){var i,c,s,l="";for(d(e,t),l="",i=0;i<o.length;i++)c=t+"-"+o[i][w.value],s=o[i][w.value],l+="<option"+(1===o[i][w.status]?' selected="true"':"")+' id="'+c+'">'+s+"</option>";$("#"+t).html(l),c="#"+t,$(c).css("top",n+(xe.sdIconH-xe.sdScrollH)/2+"px"),$(c).css("left",a+"px"),$(c).css("width",r+"px"),$(c).css("height",xe.sdScrollH+"px"),$(c).css("position","absolute")}function Bt(e){m("settingDlg",e)}function St(){var e,t,o,a,n,i;e=xe.tidFrameGap+xe.tidTextFrmW+xe.tidFrameGap,t=xe.tidFrameGap+xe.tidIconH+xe.tidIconFrmGap+xe.tidTextFrmH+xe.tidFrameGap,o="#textInputDlg",$(o).css("top","calc(50% - "+(t-xe.titleIconH)/2+"px)"),$(o).css("left","calc(50% - "+e/2+"px)"),$(o).css("width",e+"px"),$(o).css("height",t+"px"),$(o).css("position","absolute"),$(o).css("background",xe.tidBkg),$(o).css("opacity",xe.tidOpacity),l("textInputDlg","textInputClose"),o="#textInputClose",i=xr("yes.png"),a=e-xe.tidFrameGap-xe.tidIconW,n=xe.tidFrameGap,$(o).css("background",i),$(o).css("top",n+"px"),$(o).css("left",a+"px"),$(o).css("width",xe.tidIconW+"px"),$(o).css("height",xe.tidIconH+"px"),$(o).css("position","absolute"),$(o).on("click",fa),r("textarea","textInputDlg","textInputArea"),o="#textInputArea",a=xe.tidFrameGap,n=xe.tidFrameGap+xe.tidIconH+xe.tidIconFrmGap,$(o).css("position","absolute"),$(o).css("resize","none"),$(o).css("top",n+"px"),$(o).css("left",a+"px"),$(o).css("width",xe.tidTextFrmW+"px"),$(o).css("height",xe.tidTextFrmH+"px"),$(o).css("padding","0px"),$(o).attr("cols",xe.tidTextFrmW),$(o).attr("rows",xe.tidTextFrmH),Wt(!1)}function Wt(e){m("textInputDlg",e),e&&setTimeout((function(){$("#textInputArea").focus()}),300)}function kt(){return document.getElementById("textInputArea").value.length}function _t(){m("aboutDlg",!0)}function Tt(){m("aboutDlg",!1)}function Dt(e,t,o,a,n,r,i){var c,s;c="#"+e,i&&(s=xr(t),$(c).css("background",s)),$(c).css("top",a+"px"),$(c).css("left",o+"px"),$(c).css("width",n+"px"),$(c).css("height",r+"px"),$(c).css("position","absolute")}function Ht(e,t,o,a,n){l(e,t),Dt(t,o,a,n,xe.pcdIconW,xe.pcdIconH,!0)}function Mt(e,t,o,a,n){g(e,t),Dt(t,!1,o,a+xe.pcdUnitOffsetY,xe.pcdUnitW,xe.pcdUnitH,!1),$("#"+t).css("text-align","right"),function(e,t){e=document.getElementById(e),Cr(e,t)}(t,n)}function zt(e,t,o,a,n){var r="#"+t;p(e,t),Dt(t,!1,o,a,xe.pcdTextW,xe.pcdTextH,!1),$(r).keydown((function(e){-1!==$.inArray(e.keyCode,[46,8])||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()})),$(r).attr("value",n),$(r).css("text-align","center")}function Pt(e){m("periodicCaptureDlg",e)}function Ft(){var e,t,o,a;a=Math.min(Ve+Ge,Ln-xe.drawSetH),e=xe.pcibTextW+xe.pcibIconW,t=xe.pcibIconH,o="#periodicCaptureInfoBar",$(o).css("position","absolute"),$(o).css("background",xe.pcibBkg),$(o).css("opacity",xe.pcibOpacity),$(o).css("left","calc(50% - "+e/2+"px)"),$(o).css("top",a-t-xe.pcidGapY+"px"),$(o).css("width",e+"px"),$(o).css("height",t+"px")}function Rt(){Bn.capturePeriodRun=!1,At(!1)}function At(e){m("periodicCaptureInfoBar",e)}function Lt(){var e,t,o;e=2*xe.cdFrameGap+2*xe.cdIconW+xe.cdIconGap,t=2*xe.cdFrameGap+xe.cdIconH,o="#confirmDlg",$(o).css("position","absolute"),$(o).css("background",xe.cdBkg),$(o).css("opacity",xe.cdOpacity),$(o).css("left","calc(50% - "+e/2+"px)"),$(o).css("top","calc(50% - "+t/2+"px)"),$(o).css("width",e+"px"),$(o).css("height",t+"px")}function Et(){var e,t,o="confirmDlg",a=o+"_yes",n=o+"_no";function r(e,t,a,n){var r,i;l(o,e),r="#"+e,i=xr(t),$(r).css("background",i),$(r).css("left",a+"px"),$(r).css("top",n+"px"),$(r).css("width",xe.cdIconW+"px"),$(r).css("height",xe.cdIconH+"px"),$(r).css("position","absolute"),$(r).on("mousedown",(function(e){h.left===e.which&&($(r).css("background-color",xe.cdMouseColorClick),function(e){var t,o="confirmDlg",a=o+"_yes";t=document.getElementById(o),t.clickHandler&&t.clickHandler(e==a)}(e.target.id))})).on("mousemove",(function(e){$(r).css("background-color",xe.cdMouseColorEnter)})).on("mouseout",(function(){$(r).css("background-color",xe.cdMouseColorLeave)}))}l("uiArea",o),Lt(),r(n,"no.png",e=xe.cdFrameGap,t=xe.cdFrameGap),r(a,"yes.png",e+=xe.cdIconW+xe.cdIconGap,t),Ot(!1)}function Ot(e){m("confirmDlg",e)}function Yt(e){document.getElementById("confirmDlg").clickHandler=e}function Xt(){var e=lt.files;e.length&&-1!=e[0].type.indexOf("image")&&function(e){var t=new Image;if(t.addEventListener("load",(function(){e.name,t.width,t.height,e.type,Math.round(e.size/1024);he(t)})),-1!=e.type.indexOf("tif")){var o=new FileReader;o.onload=function(e){var o=e.target.result,a=new Tiff({buffer:o}).toCanvas();a&&(t.src=a.toDataURL())},o.readAsArrayBuffer(e)}else t.src=window.URL.createObjectURL(e)}(e[0])}function Gt(){$("#imgInput").val(""),lt.click(),document.body.onfocus=function(){qo&&setTimeout((function(){document.getElementById("importPictureWin").hidden&&attachCropBox(Xe,Ge)}),200),document.body.onfocus=null}}function qt(){p("uiArea","imgInput"),(lt=document.getElementById("imgInput")).hidden=!0,lt.type="file",lt.accept=".jpg, .png, .jpeg, .bmp, .tif, .tiff|image/*",lt.onchange=Xt,Lr()}function Vt(e,t,o,a){var n={x:0,y:0,w:0,h:0};return e*a<o*t?(n.w=e,n.x=0,n.h=Math.floor(n.w*a/o),n.y=Math.floor((t-n.h)/2)):(n.h=t,n.y=0,n.w=Math.floor(n.h*o/a),n.x=Math.floor((e-n.w)/2)),n}$(document).on("webkitfullscreenchange",(function(){if(document.fullscreenElement)(dt=document.fullscreenElement).style.border="none";else{var e=xe.thumbFrmSize+"px solid "+xe.thumbFrmColorChecked;dt.style.border=e}}));var Ut=!1;function Nt(e,t,o,a=!1){var n,r,i,c="thumb_"+o,l="img_"+o,d=xe.thumbW,p=xe.thumbH,g=xe.thumbPadding;if(a){var m=document.createElement("div");m.id=c,document.getElementById("thumbDiv").prepend(m)}else s("thumbDiv",c);r=d-2*g,i=p-2*g,n="#"+c,$(n).css("width",r+"px"),$(n).css("height",i+"px"),$(n).css("padding",g+"px"),$(n).css("display","inline-block"),$(n).css("position","relative"),u(c,l),e.file((function(o){var a=new Image;a.addEventListener("load",(function(){var c=Vt(r,i,a.width,a.height),s=xe.thumbFrmSize+"px solid "+xe.thumbFrmColorNormal;n="#"+l;var d={left:c.x+g,top:c.y+g,width:c.w,height:c.h,position:"absolute",border:s};$(n).css(d),$(n).addClass("thumbImg"),(n=document.getElementById(l)).src=a.src,n.fileName=o.name,n.fileEntrySub=e,n.fileEntryOrg=t,n.checked=!1,$(n).on("click",(function(e){var t,o,a=document.getElementById(e.target.id);a.checked?(a.checked=!1,t=xe.thumbFrmColorNormal,Jt()):(jt(!1),a.checked=!0,t=xe.thumbFrmColorChecked,Kt()),o=xe.thumbFrmSize+"px solid "+t,$(this).css("border",o),$(this).toggleClass("selected")})),$(n).dblclick((function(){var e=document.getElementById(this.id);e.checked=!0;var t=xe.thumbFrmColorChecked;Kt();var o=xe.thumbFrmSize+"px solid "+t;$(this).css("border",o),$(this).toggleClass("selected");var a=new Image;e.fileEntryOrg.file((function(e){a.src=window.URL.createObjectURL(e),a.addEventListener("load",(function(){fn(a)}))}))})),Zt()})),a.src=window.URL.createObjectURL(o)}),(function(e){}))}function jt(e){var t,o,a,n,r,i=$(".thumbImg"),c="selected";for(e?(a=!0,n=xe.thumbFrmColorChecked):(a=!1,n=xe.thumbFrmColorNormal),r=xe.thumbFrmSize+"px solid "+n,o=0;o<i.length;o++)document.getElementById(i[o].id).checked=a,(t=$("#"+i[o].id)).css("border",r),e?t.addClass(c):t.removeClass(c)}function Zt(){Bn.thumbFileCnt+=1,to()}function Kt(){eo()}function Jt(){eo()}var Qt=-1;function eo(){-1==Qt?(Qt=2,setTimeout(eo,100)):Qt>0?(Qt-=1,setTimeout(eo,100)):(Qt=-1,function(){var e=$(".thumbImg"),t="selected";Bn.thumbSelectedFileCnt=0;for(var o=0;o<e.length;o++){var a=document.getElementById(e[o].id),n=$("#"+e[o].id);a.checked?(Bn.thumbSelectedFileCnt+=1,n.addClass(t)):n.removeClass(t)}to()}())}function to(){var e,t,o=Math.min(Bn.thumbnailCurrPage+1,Bn.thumbnailTotalPage)+"/"+Bn.thumbnailTotalPage,a="[ "+Math.min(Bn.thumbSelectedFileCnt,Bn.thumbFileCnt)+"/"+Math.min(Bn.thumbFileCnt,100)+" ]";e=o,t=a,Cr(document.getElementById("pbFileInfo_Page"),e),Cr(document.getElementById("pbFileInfo_Item"),t),function(){var e;e=Bn.thumbFileCnt&&Bn.thumbFileCnt===Bn.thumbSelectedFileCnt?"btnUnselectAll":"btnSelectAll";Tr("btn_toggleAll",e)}()}function oo(e){var t;for(t=0;t<e.length;t++)e[t].fileEntrySub&&e[t].fileEntrySub.remove((function(){}),(function(){})),e[t].fileEntryOrg.remove((function(){}),(function(){})),$("#"+e[t].id).parent().remove();Lr()}async function ao(e,t){if(0!=e.length&&!(Pr.length<=0)){for(var o=0;o<Pr.length;o++)if(Pr[o].name==e[0].fileName){var a;a=Pr[o].name.indexOf("mp4")>0?URL.createObjectURL(Pr[o].video):Pr[o].normalImage;const e=document.createElement("a");e.href=a,e.download=Pr[o].name,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(a);break}return}}var no,ro="",io="",co=1280,so=720,lo=document.getElementById("videoSrc");function uo(e,t){var o,a=et.length;for(o=0;o<a;o++)if(e===et[o][0]&&t===et[o][1])return Bn.reqVideoResolutionList=et[o][2],!0;return!1}var po=!1;async function go(){var e;if("Firefox"==n){await navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(e=await navigator.mediaDevices.enumerateDevices()).catch()}else await async function(){await navigator.permissions.query({name:"camera"}).then((async function(e){"granted"!=e.state&&await navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then().catch()}))}(),e=await navigator.mediaDevices.enumerateDevices();var t=await function(e){for(var t=!1,o=0;o<e.length;o++){var a=e[o];if("videoinput"===a.kind&&a.label.length>0){if(!0===uo(parseInt("0x"+a.label.split(":")[0].split("(")[1],16),parseInt("0x"+a.label.split(")")[0].split(":")[1],16))){_r(),t=!0,ro=a.deviceId;break}if("Document Camera"==a.label){Bn.reqVideoResolutionList=et[0][2],_r(),t=!0,ro=a.deviceId;break}}}return t}(e);t?po&&io==ro||(zo&&await Yo(),wo()):po&&(zo&&await Yo(),po=!1,fo())}var mo=null;function fo(){if(window.stream){var e=navigator.appVersion.match(/Chrome\/(\d+)/i);null===e?window.stream.getVideoTracks()[0].stop():null!=e[0]&&e[1]<=46?window.stream.stop():window.stream.getVideoTracks()[0].stop()}}navigator.mediaDevices.ondevicechange=async function(e){null!=mo&&clearTimeout(mo),mo=setTimeout((function(){mo=null,go()}),2e3)};var ho=function(e){io=ro,window.stream=e,lo||(lo=document.getElementById("videoSrc")),e.getAudioTracks()[0].enabled=!1,lo.srcObject=e,lo.load();var t=lo.play();void 0!==t&&t.then((e=>{lo.muted=!0,lo.hidden=!0,po=!0})).catch((e=>{}))},bo=0,vo=async function(e){if(bo>0){bo-=1;var t={audio:!0,video:{deviceId:ro,width:{min:co,max:co},height:{min:so,max:so}}};await navigator.mediaDevices.getUserMedia(t).then(ho).catch(vo)}};async function wo(){if(ro){await fo();var e={audio:!0,video:{deviceId:ro,width:{min:co,max:co},height:{min:so,max:so}}};bo=3,await navigator.mediaDevices.getUserMedia(e).then(ho).catch(vo)}}var Io=-1;function yo(){lo||(lo=document.getElementById("videoSrc"));var e=lo.currentTime;e&&e!==Io&&(Io=e,no=new Date,function(e){var t=$a;if(t.freeze&&!Ra){Fa.width=$a.imgW,Fa.height=$a.imgH,Fa.getContext("2d").drawImage(e,0,0)}if(Ra=t.freeze,function(){var e,t;if(0==Bn.frameRateInit){for(Bn.frameRateInit=!0,Bn.frameLastTime=new Date,Bn.frameSlotIdx=Bn.frameCnt,e=0;e<Bn.frameCnt;e++)Bn.frameInterval[e]=0;return}var o=new Date,a=o-Bn.frameLastTime,n=Bn.frameSlotIdx%Bn.frameCnt;for(Bn.frameLastTime=o,Bn.frameInterval[n]=a,t=0,e=0;e<Bn.frameCnt;e++)t+=Bn.frameInterval[e];Bn.frameRate=1e3*Bn.frameCnt/t,Bn.frameRate=Bn.frameRate.toFixed(2),0==n&&Ir();Bn.frameSlotIdx=n+1}(),Bn.checkVideoResolution)return Bn.checkVideoResolution=!1,void Na();if(t.freeze&&qo)return;Pa[0]=1+Bn.previewBrightnessAdj/100+Bn.previewWhiteBalanceAdj/100,Pa[6]=1+Bn.previewBrightnessAdj/100,Pa[12]=1+Bn.previewBrightnessAdj/100-Bn.previewWhiteBalanceAdj/100;var o="",a=document.querySelector("#filter feColorMatrix");null!=a&&(Pa.forEach((e=>o+=e+" ")),a.setAttribute("values",o),t.baseImageContext.filter="url(#filter)");t.freeze?za(t.baseImageContext,Fa):za(t.baseImageContext,e);La()}(lo)),requestAnimationFrame(yo)}var xo,Co=!1,$o=!1,Bo=0,So=0;function Wo(e){Co=e,window.onresize(),Bn.showToolBar=!Bn.showToolBar,Sn(Bn.showToolBar),function(){var e;e=Bn.showToolBar?"btnHideFunctionIcon":"btnShowFunctionIcon";Tr("sys_fullPhoto",e)}(),Xn()}function ko(e){switch(e.target.id){case"sys_close":if(zo)return Yo(),void setTimeout((function(){ko(e)}),1e3);1==chrome.app.window.current().isFullscreen()&&document.webkitCancelFullScreen(),window.close();break;case"sys_fullScreen":return document.body.clientWidth>=window.screen.width&&document.body.clientHeight>=window.screen.height-50&&!$o?($("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),document.webkitCancelFullScreen(),void window.resizeTo(840,660)):($o?($("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),window.resizeTo(Bo,So)):(Bo=document.body.clientWidth,So=document.body.clientHeight,window.resizeTo(window.screen.width,window.screen.height)),void($o=!$o));case"sys_fullPhoto":Wo(!Co);break;case"sys_smallScreen":if(zo||Bn.capturePeriodRun)return $("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),$("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){zo&&Yo(),Bn.capturePeriodRun&&Rt(),chrome.windows.update(appID,{state:"minimized"}),$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Minimizing the window will stop taking pictures or videos. Continue?<br/> "),void $("#dialogSave").dialog("open");chrome.app.window.current().minimize()}}var _o,To,Do,Ho,Mo=[],zo=!1,Po=!1,Fo=1280,Ro=720,Ao=900;function Lo(e){m("bottomToolBarData",e),e&&$("#btn_pause").hide()}function Eo(e){var t,o=["btn_setting","btn_capture","btn_freeze","btn_timesave","btn_mirrow","btn_flip","btn_config","btn_zoom","btn_importPic","btn_redo","btn_undo","btn_freehand","btn_arrow","btn_eraser","btn_line","btn_rectangleLine","btn_rectangle","btn_circleLine","btn_circle","btn_erase_all","btn_text","drawingCfgColorBar","drawingOpacity","drawingLineWidth"];for(t=0;t<o.length;t++)pt(o[t],e);e?document.getElementById("sysToolBar").style.background=xe.toolBarColorLeave:document.getElementById("sysToolBar").style.backgroundColor="#000"}function Oo(){if(!zo)return zo=!0,Fo=Bn.imgW,Ro=Bn.imgH,Lo(!1),Eo(!1),cr(),$("#btn_pause").show(),ur(1280,720),void setTimeout(Oo,2500);Po=!1,document.getElementById("recordtime").style.fontSize="18px",document.getElementById("recordtime").style.fontWeight="bold",document.getElementById("recordtime").style.color="red",document.getElementById("recordtime").style.position="absolute",document.getElementById("recordtime").style.bottom="35px",document.getElementById("recordtime").style.right=document.documentElement.clientWidth/2-30+"px",document.getElementById("recordtime").style.visibility="visible";var e=new Date;_o=e.getTime(),Do=0,Go();var a=$a.combineCanvas;let n;Ho=a.captureStream(),null!=window.stream&&(window.stream.getAudioTracks()[0].enabled=!0,Ho.addTrack(window.stream.getAudioTracks()[0])),Mo=[],MediaRecorder.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')?n='video/mp4; codecs="avc1.42E01E, mp4a.40.2"':MediaRecorder.isTypeSupported('video/webm; codecs="vp8, vorbis"')&&(n='video/webm; codecs="vp8, vorbis"'),(xo=new MediaRecorder(Ho,{audioBitsPerSecond:128e3,videoBitsPerSecond:5e6,mimeType:n})).ondataavailable=function(e){e.data&&e.data.size>0&&(Mo.push(e.data),async function(){var e=gr("mp4");const a=await o(),n=a.transaction(t,"readwrite").objectStore(t);let r=new Blob(Mo,{type:"video/mp4"});const i={name:e,video:r};n.add(i),Mo=[],r=null,(1280!=Fo||720!=Ro)&&ur(Fo,Ro)}())},xo.start(),Lo(!0)}async function Yo(){zo=!1,document.getElementById("recordtime").style.visibility="hidden",Eo(!0),$("#btn_pause").hide(),xo.stop(),Ho.getTracks().forEach((function(e){e.stop(),Ho.removeTrack(e)})),null!=window.stream&&(window.stream.getAudioTracks()[0].enabled=!1);var e=(new Date).getTime();Po?(Po=!1,To=Do):To=Do+e-_o}function Xo(e,t){return(e=""+e).length>=t?e:Xo("0"+e,t)}function Go(){if(zo&&!Po){var e=(new Date).getTime();To=Do+e-_o;var t=Math.floor(To/1e3);if(t>=Ao)return void Yo();document.getElementById("recordtime").innerText=Xo(Math.floor(t/60),2)+" : "+Xo(t%60,2),setTimeout((()=>{Go()}),1e3)}}var qo=!1,Vo=!1,Uo={freeze:!1,flip:!1,mirror:!1,zoomRatio:1,zoomX:0,zoomY:0,zoomW:0,zoomH:0,panWinW:0,panWinH:0,zoomScrollBarPos:0,previewRotate:0,canvas:null};function No(e){e.freeze=!1,e.flip=!1,e.mirror=!1,e.zoomRatio=1,e.zoomX=0,e.zoomY=0,e.zoomW=0,e.zoomH=0,e.panWinW=0,e.panWinH=0,e.zoomScrollBarPos=0,Bn.previewRotate=0}function jo(e){if("mode_about"!=e.target.id){if(!$("#dialogSave").is(":visible")){if(zo)return Yo(),void setTimeout((function(){jo(e)}),1e3);switch(Bn.curMode.baseId){case"playbackArea":"mode_about"!=e.target.id&&"mode_playback"!=e.target.id&&rn(Bn.curMode);break;case"previewArea":var t=Bn.curMode;if(1==Bn.capturePeriodRun)return $("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){$(this).dialog("close"),Rt(),setTimeout((function(){jo(e)}),500)}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Discard Interval Timer Shooting?<br/> "),void $("#dialogSave").dialog("open");if("mode_preview"!=e.target.id&&Rt(),!qo&&!Vo){if("mode_preview"==e.target.id)return;o=t,Uo.freeze=o.freeze,Uo.flip=o.flip,Uo.mirror=o.mirror,Uo.zoomRatio=o.zoomRatio,Uo.zoomX=o.zoomX,Uo.zoomY=o.zoomY,Uo.zoomW=o.zoomW,Uo.zoomH=o.zoomH,Uo.panWinW=o.panWinW,Uo.panWinH=o.panWinH,Uo.zoomScrollBarPos=o.zoomScrollBarPos,Uo.previewRotate=Bn.previewRotate,null==Uo.canvas&&(Uo.canvas=document.createElement("canvas")),Uo.canvas.width=o.baseImageCanvas.width,Uo.canvas.height=o.baseImageCanvas.height,Uo.canvas.getContext("2d").drawImage(o.baseImageCanvas,0,0),$("#captureHit").hide()}if(qo&&(ha=!1,Kn(t),$("#displayCanvas").css("transform","scale(1,1)"),P("scanToolBarS2",0),No($a)),Vo&&wa.length)return $("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),$("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){wa=[],xa(),$(this).dialog("close"),setTimeout((function(){jo(e)}),300)}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Discard captured images?<br/> "),void $("#dialogSave").dialog("open");t.imageProcess&&t.imageProcess(),removeCropBox(),qo=!1,Vo=!1;break;case"drawingArea":P("drawingToolBar",0),Bn.fnDraw=null}var o;switch(e.target.id){case"mode_preview":Lo(!0),function(e){e.freeze=Uo.freeze,e.flip=Uo.flip,e.mirror=Uo.mirror,e.zoomRatio=Uo.zoomRatio,e.zoomX=Uo.zoomX,e.zoomY=Uo.zoomY,e.zoomW=Uo.zoomW,e.zoomH=Uo.zoomH,e.panWinW=Uo.panWinW,e.panWinH=Uo.panWinH,e.zoomScrollBarPos=Uo.zoomScrollBarPos,Bn.previewRotate=Uo.previewRotate}($a),Wn($a),Uo.freeze&&(!function(e){null!=Uo.canvas&&(e.baseImageContext.drawImage(Uo.canvas,0,0),e.imageProcess())}($a),$a.imageProcess());break;case"mode_playback":Lr(),Wn(on),Lo(!1);break;case"mode_drawingBoard":Wn(yn),Lo(!1);break;case"mode_about":lr("mode_about",_t,Tt);break;case"mode_scan":qo=!0,Kn($a),No($a),$a.imageProcess(),Wn($a),Ko(),pt(Bn.curMode.lToolBar,!1),pt(Bn.curMode.rToolBar,!1),pt(Bn.curMode.bToolBar,!1),Lo(!1),pt(Bn.curMode.lS1ToolBar,!0),pt(Bn.curMode.lS2ToolBar,!1),pt(Bn.curMode.lMsToolBar,!1),ba=!1,attachCropBox(Xe,Ge,!0),P("scanToolBarS1",0);break;case"mode_multiscan":Vo=!0,No($a),Wn($a),Ko(),pt(Bn.curMode.lToolBar,!1),pt(Bn.curMode.rToolBar,!1),pt(Bn.curMode.bToolBar,!1),Lo(!1),pt(Bn.curMode.lMsToolBar,!0),pt(Bn.curMode.lS1ToolBar,!1),pt(Bn.curMode.lS2ToolBar,!1),ba=!1,attachCropBox(Xe,Ge,!0),P("multiscanToolBar",0),wa.length?ya():xa()}M(e)}}else lr("mode_about",_t,Tt)}if(void 0===Zo)var Zo={id:0,fn:1};function Ko(){P("drawingToolBar",0),Bn.fnDraw=null}function Jo(e){cr();var t,o=[["btn_freehand",aa],["btn_arrow",na],["btn_eraser",ia],["btn_line",ca],["btn_rectangleLine",sa],["btn_rectangle",la],["btn_circleLine",da],["btn_circle",ua],["btn_text",pa]],a=Bn.curMode;if("btn_erase_all"==e.target.id)Nn(a.drawingCanvas),Zn(a),a.imageProcess&&a.imageProcess();else for(t=0;t<o.length;t++)e.target.id==o[t][Zo.id]&&(Bn.fnDraw=o[t][Zo.fn]);M(e)}function Qo(e,t,o,a){var n={x:0,y:0,w:0,h:0,centerX:0,centerY:0,endX:0,endY:0,regularX:0,regularY:0,regularSide:0};return n.x=Math.min(e,o),n.y=Math.min(t,a),n.w=Math.abs(o-e),n.h=Math.abs(a-t),n.centerX=n.x+n.w/2,n.centerY=n.y+n.h/2,n.endX=n.x+n.w,n.endY=n.y+n.h,n.regularX=n.x,n.regularY=n.y,n.w>n.h?(n.regularSide=n.h,n.regularX!==e&&(n.regularX=e-n.regularSide)):(n.regularSide=n.w,n.regularY!==t&&(n.regularY=t-n.regularSide)),n}function ea(e,t,o,a,n){var r,i;t=(r=Qo(t,o,a,n)).x,o=r.y,i=r.centerX,r.centerY,a=r.endX,n=r.endY,e.moveTo(i,o),e.bezierCurveTo(a,o,a,n,i,n),e.bezierCurveTo(t,n,t,o,i,o)}var ta=0,oa=new Array;function aa(e){var t=Bn.drawContext;switch(e){case b.start:jn(),t.strokeStyle=Bn.drawStyle,t.lineWidth=Bn.lineWidth,oa.push({x:Bn.drawStartX,y:Bn.drawStartY}),oa.push({x:Bn.drawStartX,y:Bn.drawStartY}),oa.push({x:Bn.drawStartX,y:Bn.drawStartY});break;case b.move:if(0==oa.length)return;if((n=new Date).getTime()-ta<10)break;ta=n.getTime(),oa.push({x:Bn.drawCurX,y:Bn.drawCurY}),t.clearRect(0,0,Bn.drawCanvas.width,Bn.drawCanvas.height),t.moveTo(oa[0].x,oa[0].y),t.beginPath();for(var o=1;o<oa.length-2;o++){var a=(oa[o].x+oa[o+1].x)/2,n=(oa[o].y+oa[o+1].y)/2;t.quadraticCurveTo(oa[o].x,oa[o].y,a,n)}t.quadraticCurveTo(oa[o].x,oa[o].y,oa[o+1].x,oa[o+1].y),t.stroke();break;case b.end:oa=[]}}function na(e){switch(e){case b.start:break;case b.move:jn();var t={x:Bn.drawStartX,y:Bn.drawStartY},o={x:Bn.drawCurX,y:Bn.drawCurY},a=function(e,t,o){var a={end1:{x:0,y:0},end2:{x:0,y:0}},n=t.x-e.x,r=t.y-e.y,i=Math.sqrt(n*n+r*r),c=n/i,s=r/i;return a.end1.x=t.x-c*o-s*o,a.end1.y=t.y-s*o+c*o,a.end2.x=t.x-c*o+s*o,a.end2.y=t.y-s*o-c*o,a}(t,o,Math.max(2*Bn.lineWidth,xe.minArrowSize)),n=Bn.drawContext;n.fillStyle=Bn.drawStyle,n.strokeStyle=Bn.drawStyle,n.lineWidth=Bn.lineWidth,n.beginPath(),n.moveTo(t.x,t.y),n.lineTo((a.end1.x+a.end2.x)/2,(a.end1.y+a.end2.y)/2),n.closePath(),n.stroke(),n.moveTo(o.x,o.y),n.lineTo(a.end1.x,a.end1.y),n.lineTo(a.end2.x,a.end2.y),n.closePath(),n.fill();case b.end:}}function ra(e,t,o,a,n){var r,i;r=t-a/2,i=o-a/2,void 0===n?(r-=1,i-=1,a+=2,e.clearRect(r,i,a,a)):(e.beginPath(),e.strokeStyle=n,e.fillStyle=n,e.lineWidth=0,e.rect(r,i,a,a),e.fill(),e.stroke())}function ia(e){var t=Bn.baseContext,o=2*Bn.lineWidth;switch(o<10&&(o=10),e){case b.start:jn(),ra(t,Bn.drawCurX,Bn.drawCurY,o,Bn.eraserStyle);break;case b.move:ra(t,Bn.drawLastX,Bn.drawLastY,o),ra(t,Bn.drawCurX,Bn.drawCurY,o,Bn.eraserStyle);break;case b.end:ra(t,Bn.drawCurX,Bn.drawCurY,o)}}function ca(e){switch(e){case b.start:break;case b.move:jn();var t=Bn.drawContext;t.strokeStyle=Bn.drawStyle,t.lineWidth=Bn.lineWidth,t.beginPath(),t.moveTo(Bn.drawStartX,Bn.drawStartY),t.lineTo(Bn.drawCurX,Bn.drawCurY),t.stroke();case b.end:}}function sa(e){switch(e){case b.start:break;case b.move:jn();var t,o=Bn.drawContext;o.strokeStyle=Bn.drawStyle,o.lineWidth=Bn.lineWidth,t=Qo(Bn.drawStartX,Bn.drawStartY,Bn.drawCurX,Bn.drawCurY),o.beginPath(),Bn.drawRegularShape?o.rect(t.regularX,t.regularY,t.regularSide,t.regularSide):o.rect(t.x,t.y,t.w,t.h),o.stroke();case b.end:}}function la(e){switch(e){case b.start:break;case b.move:jn();var t,o=Bn.drawContext;o.fillStyle=Bn.drawStyle,o.strokeStyle=Bn.clearStyle,o.lineWidth=0,t=Qo(Bn.drawStartX,Bn.drawStartY,Bn.drawCurX,Bn.drawCurY),Bn.drawRegularShape?o.rect(t.regularX,t.regularY,t.regularSide,t.regularSide):o.rect(t.x,t.y,t.w,t.h),o.fill();case b.end:}}function da(e){switch(e){case b.start:break;case b.move:var t,o=Bn.drawContext;jn(),o.strokeStyle=Bn.drawStyle,o.lineWidth=Bn.lineWidth,o.beginPath(),Bn.drawRegularShape?ea(o,(t=Qo(Bn.drawStartX,Bn.drawStartY,Bn.drawCurX,Bn.drawCurY)).regularX,t.regularY,t.regularX+t.regularSide/3*4,t.regularY+t.regularSide):ea(o,Bn.drawStartX,Bn.drawStartY,Bn.drawCurX,Bn.drawCurY),o.closePath(),o.stroke();case b.end:}}function ua(e){switch(e){case b.start:break;case b.move:var t,o=Bn.drawContext;jn(),o.fillStyle=Bn.drawStyle,Bn.drawRegularShape?ea(o,(t=Qo(Bn.drawStartX,Bn.drawStartY,Bn.drawCurX,Bn.drawCurY)).regularX,t.regularY,t.regularX+t.regularSide/3*4,t.regularY+t.regularSide):ea(o,Bn.drawStartX,Bn.drawStartY,Bn.drawCurX,Bn.drawCurY),o.fill();case b.end:}}function pa(e){switch(e){case b.start:0==Bn.drawText&&lr("textInputDlg",ga,ma);break;case b.move:break;case b.end:0==Bn.drawText&&kt()&&ar(b.end)}}function ga(){var e,t;t="rgb("+Bn.colorR+","+Bn.colorG+","+Bn.colorB+")",e="#textInputArea",$(e).css("font",xe.tidTextSize+"px "+Bn.fontFamily),$(e).css("color",t),-1!=Bn.fontStyle.indexOf("Bold")?($(e).css("font-weight","bold"),Bn.fontBold=!0):($(e).css("font-weight","normal"),Bn.fontBold=!1),-1!=Bn.fontStyle.indexOf("Italic")?($(e).css("font-style","italic"),Bn.fontItalic=!0):($(e).css("font-style","normal"),Bn.fontItalic=!1),document.getElementById("textInputArea").value="",Bn.drawFontStyle=Bn.drawStyle,Bn.drawing=!1,Bn.drawText=!0,Wt(!0)}function ma(){Wt(!1),jn(),Bn.drawText=!1,Bn.fnDraw&&Bn.fnDraw(b.end)}function fa(){Wt(!1),jn(),function(){var e,t,o,a,n,r,i,c,s,l;if(0==kt())return;e=Bn.drawStartX,t=Bn.drawStartY,a=Bn.fontSize,n=Bn.drawContext,r=function(){return document.getElementById("textInputArea").value}(),l="",Bn.fontBold&&(l+="Bold ");Bn.fontItalic&&(l+="Italic ");n.fillStyle=Bn.drawFontStyle,n.strokeStyle=Bn.drawStyle,n.font=l+a+"pt "+Bn.fontFamily,i=r,o=t;for(;-1!=i.indexOf("\n");)o+=a,s=i.indexOf("\n"),c=i.substring(0,s),n.fillText(c,e,o),i=i.substring(s+1);n.fillText(i,e,o+a)}(),Bn.drawText=!1,Bn.fnDraw&&Bn.fnDraw(b.end)}var ha=!1,ba=!1;async function va(e){var t,o,a,n,r,i=$a;switch(e.target.id){case"scbtn_importPic":we(!1),removeCropBox(),Gt();break;case"scbtn_fullcrop":ba?attachCropBox(Xe,Ge,!0):attachCropBoxFull(Xe,Ge),ba=!ba;break;case"scbtn_transform":if(0==$("#cropBox").length)return;o=gn(),a=o.width,n=o.height,r=new Image,Bn.curMode.freeze=!0,r.width=a,r.height=n,r.src=o.toDataURL(),r.onload=function(){var e=Bn.curMode,t=e.baseImageContext,o=e.imgW/a,i=e.imgH/n;jn(),t.beginPath(),t.rect(0,0,e.imgW,e.imgH),t.fillStyle="black",t.fill(),a/n>=e.imgW/e.imgH?t.drawImage(r,0,(e.imgH-n*o)/2,e.imgW,n*o):t.drawImage(r,(e.imgW-a*i)/2,0,a*i,e.imgH),ar(b.end),e.imageProcess&&e.imageProcess()},removeCropBox(),Kn(i),pt(Bn.curMode.lS1ToolBar,!1),pt(Bn.curMode.rToolBar,!0),pt(Bn.curMode.bToolBar,!0),pt(Bn.curMode.lS2ToolBar,!0),ha=!0;break;case"scbtn_preview":!function(){var e=$a;e.freeze=!1,removeCropBox(),Kn(e),Nn(document.getElementById("previewArea-combineCanvas")),jn(),function(){var e=document.getElementById("displayCanvas");e.width+=0}(),e.imageProcess&&e.imageProcess();ba?attachCropBoxFull(Xe,Ge):attachCropBox(Xe,Ge);pt(Bn.curMode.lS2ToolBar,!1),pt(Bn.curMode.rToolBar,!1),pt(Bn.curMode.bToolBar,!1),pt(Bn.curMode.lS1ToolBar,!0),P("scanToolBarS2",0),e.mirror=!1,e.flip=!1,ha=!1}();break;case"scbtn_mirrow":i.mirror=!i.mirror,ar(b.mirror);break;case"scbtn_flip":i.flip=!i.flip,ar(b.flip);break;case"scbtn_config":cr(),$("#configDlg").toggle(500);break;case"scbtn_setting":lr("btn_setting",qa,Va);break;case"scbtn_ocr":t={launch:!0,senderName:Ie},chrome.runtime.sendMessage(OcrAppID,t,(function(e){if(chrome.runtime.lastError)return $("#dialogOcr").dialog({dialogClass:"no-close",autoOpen:!1,width:250,height:140,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{"Add it now":function(){var e=OcrAppLink;window.open(e),$(this).dialog("close")},Later:function(){$(this).dialog("close")}}}),$("#dlgOcrTxt").text("This feature requires installing a free OCR extension from the Chrome Web Store."),void $("#dialogOcr").dialog("open");document.getElementById("previewArea-combineCanvas").toBlob((function(e){setTimeout((function(){mn(e)}),200)}))}));break;case"scbtn_saveDisk":Da(),mr(i.combineCanvas);break;case"scbtn_redo":case"scbtn_redo2":ar(b.redo);break;case"scbtn_undo":ar(b.undo);break;case"scbtn_undo2":if(1==i.canvasStep)return;ar(b.undo)}M(e)}var wa=[];function Ia(e=null){$("#dialogSave").dialog({dialogClass:"no-close",autoOpen:!1,width:250,height:80,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{JPG:function(){$(this).dialog("close"),async function(e){var t=gr("");if(Bn.lastSaveFilename==t)return;for(var o=0;o<e.length;o++)mr(e[o],t+"-"+o)}(wa),wa=[],e&&jo(e),xa()},PDF:function(){$(this).dialog("close"),async function(e){for(var t=gr(""),o=-1,a=-1,n=0;n<e.length;n++)e[n].width>o&&(o=e[n].width),e[n].height>a&&(a=e[n].height);for(var r=new jsPDF({orientation:o>a?"l":"p",unit:"pt",format:[o,a]}),i=0;i<e.length;i++){var c=(o-e[i].width)/2,s=(a-e[i].height)/2;i>0&&r.addPage();var l=await e[i].toDataURL("image/jpeg",1);await r.addImage(l,"JPEG",c,s,e[i].width,e[i].height)}r.save(t+".pdf")}(wa),wa=[],e&&jo(e),xa()},X:function(){$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html(""),$("#dialogSave").dialog("open")}function ya(e=""){$("#lbMsCnt").text(e),$("#lbMsCnt").show(),$("#mscbtn_cancel").show()}function xa(){$("#lbMsCnt").hide(),$("#mscbtn_cancel").hide()}function Ca(e){var t,o,a,n=$a;switch(e.target.id){case"mscbtn_capture":if(0==$("#cropBox").length||0==po)return;$("#dialogSave").is(":visible")&&$("#dialogSave").dialog("close");var r=gn();wa.push((t=r,o=document.createElement("canvas"),a=o.getContext("2d"),o.width=t.width,o.height=t.height,a.drawImage(t,0,0),o)),0==$("#lbMsCnt").length&&(g("uiArea","lbMsCnt"),$("#lbMsCnt").addClass("MultiScanCnt"),$("#lbMsCnt").css({top:Ln-80,left:An/2,position:"absolute"})),ya(wa.length),n.imageProcess&&n.imageProcess();break;case"mscbtn_merge":if(0==wa.length)return $("#dialogSave").dialog({dialogClass:"no-close",title:"!",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{OK:function(){$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br>Please take pictures first."),void $("#dialogSave").dialog("open");Ia();break;case"mscbtn_cancel":if(wa.length)return $("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){wa=[],xa(),$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Discard captured images?<br/> "),void $("#dialogSave").dialog("open");break;case"mscbtn_fullcrop":ba?attachCropBox(Xe,Ge,!0):attachCropBoxFull(Xe,Ge),ba=!ba}n.mirror&&n.flip?$("#displayCanvas").css("transform","scale(-1,-1)"):!n.mirror&&n.flip?$("#displayCanvas").css("transform","scale(1,-1)"):n.mirror&&!n.flip?$("#displayCanvas").css("transform","scale(-1,1)"):n.mirror||n.flip||$("#displayCanvas").css("transform","scale(1,1)"),M(e)}var $a={baseId:"previewArea",lToolBar:"previewToolBar",lS1ToolBar:"scanToolBarS1",lS2ToolBar:"scanToolBarS2",lMsToolBar:"multiscanToolBar",rToolBar:"drawingToolBar",bToolBar:"drawingCfgArea",taskCtrl:function(e){var t=$a;e?(t.panMove=!1,Bn.capturePeriodRun&&At(!0),t.zoomRatio>1&&kr(!0)):(we(!1),At(!1),kr(!1))},start:function(){Na(),Ba()},init:function(){var e=$a;co=e.imgW=Bn.reqImgW,so=e.imgH=Bn.reqImgH,rt(e,co,so),it(e),Jn(e),function(){function e(e,t){var o,a,n,r,i=Bn.curMode,c=i.panWinW/i.imgW;return o=i.zoomX*c,a=i.zoomY*c,n=i.zoomW*c,r=i.zoomH*c,e>=o&&e<=o+n&&t>=a&&t<=a+r}$("#cropWin").on("mousedown",(function(t){e(t.offsetX,t.offsetY)&&(Bn.panMove=!0,Bn.panMoveX=t.offsetX,Bn.panMoveY=t.offsetY)})).on("mousemove",(function(e){Bn.panMove&&function(e,t){var o=Bn.curMode,a=o.imgW/o.panWinW;o.zoomX+=(e-Bn.panMoveX)*a,o.zoomY+=(t-Bn.panMoveY)*a,o.zoomX=Math.max(o.zoomX,0),o.zoomY=Math.max(o.zoomY,0),o.zoomX+o.zoomW>o.imgW&&(o.zoomX=o.imgW-o.zoomW);o.zoomY+o.zoomH>o.imgH&&(o.zoomY=o.imgH-o.zoomH);Wr(),ar(b.pan),Bn.panMoveX=e,Bn.panMoveY=t}(e.offsetX,e.offsetY)})).on("mouseup",(function(e){Bn.panMove=!1})).on("mouseout",(function(e){Bn.panMove=!1})).on("touchstart",(function(e){Fn(e)})).on("touchmove",(function(e){Fn(e)})).on("touchend",(function(){Fn(event)})).on("touchcancel",(function(){Fn(event)}))}(),kr(!1),_n(e,!1)},onResize:Ba,canvasCtrl:function(e){var t=$a;switch(e){case b.start:return!1;case b.move:t.hasTempDraw=!0;break;case b.end:0==Bn.drawText&&(t.hasTempDraw=!1,t.mergeTempDraw=!0);break;case b.undo:t.canvasStep>0&&(t.reqUndo=!0);break;case b.redo:t.canvasStep<t.canvasArray.length-1&&(t.reqRedo=!0)}return!t.freeze},imageProcess:La,chgBaseImgCtrl:function(e,t,o){var a=$a;switch(e){case I.before:a.zoomRatio=1,kr(!1),a.freeze=!1,z("previewToolBar","btn_freeze",0),fo(),co=a.imgW=t,so=a.imgH=o;break;case I.after:wo()}},imgW:xe.defPreviewRsoX,imgH:xe.defPreviewRsoY,freeze:!1,hasTempDraw:!1,mergeTempDraw:!1,reqUndo:!1,reqRedo:!1,flip:!1,mirror:!1,zoomRatio:1,zoomX:0,zoomY:0,zoomW:xe.defPreviewRsoX,zoomH:xe.defPreviewRsoY,panWinW:0,panWinH:0,zoomScrollBarPos:0};function Ba(){$a.freeze&&Tn(),!qo&&!Vo||ha||(removeCropBox(),attachCropBox(Xe,Ge)),Sr(),Wr(),Ft()}async function Sa(e){var t=$a;switch(e.target.id){case"btn_freeze":t.freeze=!t.freeze;break;case"btn_undo":ar(b.undo);break;case"btn_redo":ar(b.redo);break;case"btn_mirrow":t.mirror=!t.mirror,t.zoomX=t.imgW-t.zoomX-t.zoomW,Wr(),ar(b.mirror);break;case"btn_flip":t.flip=!t.flip,t.zoomY=t.imgH-t.zoomY-t.zoomH,Wr(),ar(b.flip);break;case"btn_config":cr(),$("#configDlg").toggle(500);break;case"btn_brightness":lr("btn_brightness",Oa,Ya);break;case"btn_whitebalance":lr("btn_whitebalance",Xa,Ga);break;case"btn_zoom":$("#configDlg").hide(),$("#zoomDlg").toggle(500);break;case"btn_setting":lr("btn_setting",qa,Va);break;case"btn_capture":if(void 0===window.stream||!window.stream.active||!po)break;mr(t.combineCanvas),$("#captureHit").css({position:"absolute",top:"60px",left:An/2-20+"px"}),$("#captureHit").show(100),_a=1500,null==ka&&(ka=setInterval(Ta,500));break;case"btn_timesave":if(void 0===window.stream||!window.stream.active||!po)break;0==Bn.capturePeriodRun&&lr("btn_timesave",Ka,Za);break;case"btn_importPic":Gt();break;case"btn_record":if(void 0===window.stream||!window.stream.active||!po)break;$("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),Bn.capturePeriodRun&&Rt(),Kn(t),(t.flip||t.mirror)&&(t.flip=!1,t.mirror=!1,Wr(),ar(b.flip),ar(b.mirror),z("previewToolBar","btn_flip",0),z("previewToolBar","btn_mirrow",0)),t.zoomRatio>1&&$r(),t.freeze&&(t.freeze=!1,z("previewToolBar","btn_freeze",0)),zo?Yo():Oo();break;case"btn_pause":zo&&(Po?(clearInterval(Wa),function(){Po=!1,xo.resume();var e=new Date;_o=e.getTime(),Go()}()):(Wa=setInterval(Ma,2e3),function(){Po=!0,xo.pause();var e=(new Date).getTime();Do+=e-_o}()));break;case"btn_test":chrome.windows.getCurrent((function(e){chrome.windows.update(e.id,{state:"minimized"})}))}M(e)}var Wa,ka=null,_a=0;function Ta(){(_a-=500)<=0&&($("#captureHit").hide(150),clearInterval(ka),ka=null)}function Da(){$("#SaveHit").css({position:"absolute",top:"60px",left:An/2-20+"px"}),$("#SaveHit").show(100),_a=1500,null==ka&&(ka=setInterval(Ha,500))}function Ha(){(_a-=500)<=0&&($("#SaveHit").hide(150),clearInterval(ka),ka=null)}function Ma(){$("#recordtime").fadeOut(500),$("#recordtime").fadeIn(500)}function za(e,t){var o=$a;e.drawImage(t,0,0,o.imgW,o.imgH)}var Pa=["1","0","0","0","0","0","1","0","0","0","0","0","1","0","0","0","0","0","1","0"],Fa=document.createElement("canvas"),Ra=!1;var Aa=0;function La(){var e=$a,t=e.imageProcessContext,o=1,a=1,n=0,r=0;e.mirror&&(o=-1,n=e.imgW),e.flip&&(a=-1,r=e.imgH),0==Bn.previewRotate?(t.save(),t.translate(n,r),t.scale(o,a),za(e.imageProcessContext,e.baseImageCanvas),t.restore(),Aa=0):(Bn.previewRotate!=Aa&&(t.fillStyle="black",t.fillRect(0,0,e.imgW,e.imgH)),t.save(),t.translate(e.imgW/2,e.imgH/2),t.rotate(Math.PI/180*Bn.previewRotate),t.scale(o,a),t.drawImage(e.baseImageCanvas,-e.imgW/2,-e.imgH/2,e.imgW,e.imgH),t.restore(),Aa=Bn.previewRotate),function(){var e=$a;e.reqUndo?(e.reqUndo=!1,rr(e)):e.reqRedo?(e.reqRedo=!1,ir(e)):function(){var e=$a;1==e.zoomRatio?za(e.combineContext,e.imageProcessCanvas):e.combineContext.drawImage(e.imageProcessCanvas,e.zoomX,e.zoomY,e.zoomW,e.zoomH,0,0,e.imgW,e.imgH);if(1===xe.disableDrawingCanvasOverlay)return void Ea();e.mergeTempDraw&&(e.mergeTempDraw=!1,za(e.drawingContext,e.tempDrawingCanvas),Zn(e));za(e.combineContext,e.drawingCanvas),function(){var e=$a;e.hasTempDraw&&za(e.combineContext,e.tempDrawingCanvas);Ea()}()}()}()}function Ea(){kn($a)&&Tn()}function Oa(){ht(!0)}function Ya(){ht(!1)}function Xa(){bt(!0)}function Ga(){bt(!1)}function qa(){Bt(!0)}function Va(){Bt(!1),dr(),Na(),Ar()}function Ua(){cr()}function Na(){var e;e=document.getElementById("sdVideoRsoScrollbar").selectedIndex,Bn.reqImgW=Bn.curVideoResolutionList[e][v.w],Bn.reqImgH=Bn.curVideoResolutionList[e][v.h],Bn.reqImgW==Bn.imgW&&Bn.reqImgH==Bn.imgH||(ur(Bn.reqImgW,Bn.reqImgH),function(e){var t;if(e<=Bn.curVideoResolutionList.length-1){for(t=0;t<Bn.curVideoResolutionList.length;t++)Bn.curVideoResolutionList[t][v.data]=0;Bn.curVideoResolutionList[e][v.data]=1}}(e))}function ja(){cr()}function Za(){Pt(!1)}function Ka(){Pt(!0)}function Ja(){var e;cr(),Bn.capturePeriodSec=document.getElementById("periodicCaptureDlg_periodText").value,Bn.captureIntervalHour=document.getElementById("periodicCaptureDlg_intervalText").value,Bn.capturePeriodSec<1||(e=60*Bn.captureIntervalHour/Bn.capturePeriodSec,e=Math.floor(e),Bn.capturePeriodTotalCnt=e,Bn.capturePeriodTotalCnt&&(Bn.capturePeriodRun=!0,Bn.capturePeriodCurCnt=0,Bn.capturePeriodMs=1e3*Bn.capturePeriodSec,en(),At(!0)))}var Qa=null;function en(){var e=$a;if(null==Qa&&(Qa=document.createElement("canvas")),Bn.capturePeriodCurCnt>=Bn.capturePeriodTotalCnt)return Bn.capturePeriodRun=!1,void At(!1);if(0!=Bn.capturePeriodRun){var t;mr(e.combineCanvas)&&(Bn.capturePeriodCurCnt+=1,t=Bn.capturePeriodCurCnt+" / "+Bn.capturePeriodTotalCnt,Cr(document.getElementById("periodicCaptureInfoBar_text"),t),Bn.capturePeriodCurCnt>=Bn.capturePeriodTotalCnt&&(Bn.capturePeriodMs=1e3)),setTimeout((function(){en()}),Bn.capturePeriodMs)}}if(void 0===tn)var tn={thumbnail:0,image:1};var on={baseId:"playbackArea",lToolBar:"thumbnailToolBar",rToolBar:"playbackRToolBar",bToolBar:"playbackInfoBar",taskCtrl:function(e){e?Qn(!1):(we(!1),Qn(!0),kr(!1))},start:function(){var e=on;e.curMode==tn.image?(bn(),Qn(!0),e.zoomRatio>1&&(Sr(),Wr(),kr(!0))):(e.zoomScrollBarPos=0,e.zoomRatio=1)},init:function(){var e=on;it(e),Jn(e),function(){s("playbackArea","thumbDiv");var e=xe.toolBarIconW,t=xe.toolBarIconH,o=xe.titleIconH,a={position:"absolute",left:e+"px",top:o+"px",width:"calc(100% - "+2*e+"px)",height:"calc(100% - "+(o+t)+"px)","text-align":"center",overflow:"auto"};$("#thumbDiv").css(a)}(),function(){var e="playbackInfoBar",t="#"+e;l("uiArea",e);var o={top:"calc(100% - "+xe.toolBarIconH+"px)",left:xe.toolBarIconW+"px",height:ye.iconH+"px",width:"calc(100% - "+2*xe.toolBarIconW+"px)",background:xe.toolBarColorLeave,opacity:xe.toolBarOpacityLeave,position:"absolute"};$(t).css(o),m(e,!1),g(e,"pbFileInfo_Text"),g(e,"pbFileInfo_Page"),g(e,"pbFileInfo_Item"),t="#"+(e="pbFileInfo_Text"),o.top=(ye.iconH-xe.pbInfoH)/2+"px",o.left="calc(40% - "+xe.pbInfoW/2+"px)",o.height=xe.pbInfoH,o.width=xe.pbInfoW/2,$(t).css(o),$(t).css("line-height",xe.pbInfoH+"px"),$(t).css("font-size",xe.pbInfoFontSize),$(t).css("font-weight",xe.pbInfoFontWWeight),$(t).css("color",xe.pbInfoColor_Page),$(t).css("text-align","left"),t="#"+(e="pbFileInfo_Page"),o.top=(ye.iconH-xe.pbInfoH)/2+"px",o.left="calc(40% - "+(xe.pbInfoW/2-xe.pbInfoW/2)+"px)",o.height=xe.pbInfoH,o.width=xe.pbInfoW-xe.pbInfoW/2,$(t).css(o),$(t).css("line-height",xe.pbInfoH+"px"),$(t).css("font-size",xe.pbInfoFontSize),$(t).css("font-weight",xe.pbInfoFontWWeight),$(t).css("color",xe.pbInfoColor_Page),$(t).css("text-align","left"),t="#"+(e="pbFileInfo_Item"),o.top=(ye.iconH-xe.pbInfoH)/2+"px",o.left="calc(60% - "+xe.pbInfoW/2+"px)",o.height=xe.pbInfoH,o.width=xe.pbInfoW,$(t).css(o),$(t).css("line-height",xe.pbInfoH+"px"),$(t).css("font-size",xe.pbInfoFontSize),$(t).css("font-weight",xe.pbInfoFontWWeight),$(t).css("color",xe.pbInfoColor_Item),$(t).css("text-align","left")}(),_n(e,!1)},onResize:function(){Tn(),Sr(),Wr()},canvasCtrl:function(e){var t=on;switch(e){case b.start:return!1;case b.move:t.hasTempDraw=!0;break;case b.end:0==Bn.drawText&&(t.hasTempDraw=!1,t.mergeTempDraw=!0);break;case b.undo:t.canvasStep>0&&(t.reqUndo=!0);break;case b.redo:t.canvasStep<t.canvasArray.length-1&&(t.reqRedo=!0)}return!1},imageProcess:bn,chgBaseImgCtrl:function(e,t,o){var a=on;switch(e){case I.before:break;case I.after:if(0==a.curImage)return;sn(!1),ln(tn.image),sn(!Co),a.imgW=a.curImage.width,a.imgH=a.curImage.height,a.baseImageContext.drawImage(a.curImage,0,0,a.curImage.width,a.curImage.height),bn(),an(!1),Qn(!0)}},imgW:xe.defPictureW,imgH:xe.defPictureH,curImage:0,curMode:tn.thumbnail,zoomRatio:1,zoomX:0,zoomY:0,zoomW:xe.defPreviewRsoX,zoomH:xe.defPreviewRsoY,panWinW:0,panWinH:0,zoomScrollBarPos:0};function an(e){m("thumbDiv",e)}function nn(e){var t,o;switch(e.target.id){case"btn_delete":(t=$("img.selected,Video.selected")).length&&lr("btn_delete",wn,In);break;case"btn_saveDisk":for(t=$("img.selected,Video.selected"),o=0;o<t.length;o++)if("IMG"==t[o].tagName){0;break}ao(t);break;case"btn_toggleAll":Bn.thumbFileCnt!=Bn.thumbSelectedFileCnt?(jt(!0),Bn.thumbSelectedFileCnt=Bn.thumbFileCnt):(jt(!1),Bn.thumbSelectedFileCnt=0),to();break;case"btn_Next":Ut||(Ut=!0,setTimeout((()=>{Ut=!1}),300),Bn.thumbnailCurrPage+=1,Bn.thumbnailCurrPage=Bn.thumbnailCurrPage%Bn.thumbnailTotalPage,Er());break;case"btn_Previous":Ut||(Ut=!0,setTimeout((()=>{Ut=!1}),300),Bn.thumbnailCurrPage+=Bn.thumbnailTotalPage-1,Bn.thumbnailCurrPage=Bn.thumbnailCurrPage%Bn.thumbnailTotalPage,Er())}M(e)}function rn(e){sn(!1),ln(tn.thumbnail),sn(!0),Qn(!1),an(!0),e.curMode=tn.thumbnail,e.zoomRatio=1,e.zoomScrollBarPos=0,kr(!1),cr()}function cn(e){var t,o=on;switch("ppbtn_transform"==e.target.id&&(0==$("#cropBox").length?(attachCropBox(Xe,Ge),lr("btn_delete",un,pn)):(lr("btn_delete",un,pn),removeCropBox())),e.target.id){case"ppbtn_closeAndBackPlayback":rn(o);break;case"ppbtn_redo":ar(b.redo);break;case"ppbtn_undo":ar(b.undo);break;case"ppbtn_importPic":Gt();break;case"ppbtn_savePlayback":mr(o.combineCanvas,"",!0);break;case"ppbtn_zoom":$("#configDlg").hide(),$("#zoomDlg").toggle(500);break;case"ppbtn_transform":break;case"ppbtn_ocr":t={launch:!0,senderName:Ie},chrome.runtime.sendMessage(OcrAppID,t,(function(e){if(chrome.runtime.lastError)return $("#dialogOcr").dialog({dialogClass:"no-close",autoOpen:!1,width:250,height:140,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{"Add it now":function(){var e=OcrAppLink;window.open(e),$(this).dialog("close")},Later:function(){$(this).dialog("close")}}}),$("#dlgOcrTxt").text("This feature requires installing a free OCR extension from the Chrome Web Store."),void $("#dialogOcr").dialog("open");document.getElementById("displayCanvas").toBlob((function(e){setTimeout((function(){mn(e)}),200)}))}))}M(e)}function sn(e){var t=on;m(t.lToolBar,e),m(t.rToolBar,e),m(t.bToolBar,e)}function ln(e){var t=on;switch(e){case tn.thumbnail:t.lToolBar="thumbnailToolBar",t.rToolBar="playbackRToolBar",t.bToolBar="playbackInfoBar";break;case tn.image:t.lToolBar="picPlaybackToolBar",t.rToolBar="drawingToolBar",t.bToolBar="drawingCfgArea"}}function dn(e){e&&function(){var e=document.getElementById("croppath").getAttribute("d").split(/(?=[LMC])/),t=[],o=[];t[0]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[1]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[1]),t[2]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[3]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[1]),t[4]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[5]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[1]),t[6]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[7]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[1]);var a=on,n=a.curImage,r=document.getElementById("displayCanvas").width,i=document.getElementById("displayCanvas").height;a.zoomRatio>1?(t[0]=parseInt(a.zoomX+t[0]/r*n.width/a.zoomRatio),t[1]=parseInt(a.zoomY+t[1]/i*n.height/a.zoomRatio),t[2]=parseInt(a.zoomX+t[2]/r*n.width/a.zoomRatio),t[3]=parseInt(a.zoomY+t[3]/i*n.height/a.zoomRatio),t[4]=parseInt(a.zoomX+t[4]/r*n.width/a.zoomRatio),t[5]=parseInt(a.zoomY+t[5]/i*n.height/a.zoomRatio),t[6]=parseInt(a.zoomX+t[6]/r*n.width/a.zoomRatio),t[7]=parseInt(a.zoomY+t[7]/i*n.height/a.zoomRatio)):(t[0]=t[0]/r*n.width,t[1]=t[1]/i*n.height,t[2]=t[2]/r*n.width,t[3]=t[3]/i*n.height,t[4]=t[4]/r*n.width,t[5]=t[5]/i*n.height,t[6]=t[6]/r*n.width,t[7]=t[7]/i*n.height);var c=(t[0]+t[6])/2,s=(t[1]+t[3])/2,l=Math.floor((t[2]+t[4])/2-c),d=Math.floor((t[7]+t[5])/2-s);o[0]=c,o[1]=s,o[2]=c+l,o[3]=s,o[4]=c+l,o[5]=s+d,o[6]=c,o[7]=s+d,perspectiveTran=PerspT(t,o);for(var u=y(n),p=u.getContext("2d",{willReadFrequently:!0}),g=p.getImageData(0,0,l,d),m=p.getImageData(0,0,n.width,n.height).data.slice(0),f=0;f<d;f++)for(var h=0;h<l;h++){var b=perspectiveTran.transformInverse(h+c,f+s),v=4*(f*l+h),w=4*(Math.round(b[1])*n.width+Math.round(b[0]));g.data[v]=m[w],g.data[v+1]=m[w+1],g.data[v+2]=m[w+2]}(u=document.getElementById("saveFileCanvas")).width=l,u.height=d,u.getContext("2d",{willReadFrequently:!0}).putImageData(g,0,0);var I=new Image;function y(e){var t=document.getElementById("saveFileCanvas"),o=t.getContext("2d",{willReadFrequently:!0});return $("#saveFileCanvas").attr("width",e.width),$("#saveFileCanvas").attr("height",e.height),o.drawImage(e,0,0,e.width,e.height),t}I.onload=function(){fn(this)},I.width=l,I.height=d,I.src=u.toDataURL(),$r()}(),cr()}function un(){Yt(dn),Ot(!0)}function pn(){Ot(!1),$a.freeze=!1}function gn(){var e=document.getElementById("croppath").getAttribute("d").split(/(?=[LMC])/),t=[],o=[],a=[],n=[],r=[];a[0]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[1]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[1]),a[2]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[3]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[1]),a[4]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[5]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[1]),a[6]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[7]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[1]);var c=(a[1]+a[3]+a[5]+a[7])/4;for(i=0;i<4;i++){a[2*i+1]-c<0?(n.push(a[2*i]),n.push(a[2*i+1])):(r.push(a[2*i]),r.push(a[2*i+1]))}for(;n.length>0;){var s=0,l=9999;for(i=0;i<n.length;i++)n[2*i]<l&&(l=n[2*i],s=i);t.push(n[2*s]),t.push(n[2*s+1]),n.splice(2*s,2)}for(;r.length>0;){var d=0,u=-9999;for(i=0;i<r.length;i++)n[2*i]>u&&(u=n[2*i],d=i);t.push(r[2*d]),t.push(r[2*d+1]),r.splice(2*d,2)}var p=$a,g=document.getElementById("displayCanvas").width,m=document.getElementById("displayCanvas").height;t[0]=t[0]/g*p.imgW,t[1]=t[1]/m*p.imgH,t[2]=t[2]/g*p.imgW,t[3]=t[3]/m*p.imgH,t[4]=t[4]/g*p.imgW,t[5]=t[5]/m*p.imgH,t[6]=t[6]/g*p.imgW,t[7]=t[7]/m*p.imgH;var f=(t[0]+t[6])/2,h=(t[1]+t[3])/2,b=Math.abs(Math.floor((t[2]+t[4])/2-f)),v=Math.abs(Math.floor((t[7]+t[5])/2-h));o[0]=f,o[1]=h,o[2]=f+b,o[3]=h,o[4]=f+b,o[5]=h+v,o[6]=f,o[7]=h+v,perspectiveTran=PerspT(t,o);var w=document.getElementById("previewArea-combineCanvas"),I=document.getElementById("tempCanvas");I.width=w.width,I.height=w.height;var y=I.getContext("2d",{willReadFrequently:!0});y.drawImage(w,0,0);for(var x=new ImageData(b,v),C=y.getImageData(0,0,p.imgW,p.imgH).data.slice(0),$=0;$<v;$++)for(var B=0;B<b;B++){var S=perspectiveTran.transformInverse(B+f,$+h),W=4*($*b+B),k=4*(Math.round(S[1])*p.imgW+Math.round(S[0]));x.data[W]=C[k],x.data[W+1]=C[k+1],x.data[W+2]=C[k+2],x.data[W+3]=255}var _=document.getElementById("saveFileCanvas");return _.width=b,_.height=v,_.getContext("2d",{willReadFrequently:!0}).putImageData(x,0,0),_}function mn(e){var t=262144,o=0,a=t,n=e.size%t,r=Math.floor(e.size/t),i=0;0!=n&&(r+=1);var c=new FileReader;document.getElementById("displayCanvas");function s(){if(!(++i>r)){i==r&&0!=n&&(a=o+n);var s=e.slice(o,a);o=a,a+=t,c.readAsBinaryString(s)}}c.onload=function(){var e={blobAsText:c.result,mimeString:"mimeString",chunks:r};chrome.runtime.sendMessage(OcrAppID,e,(function(e){chrome.runtime.lastError})),s()},c.onerror=function(){appendLog("An error ocurred while reading file")},s()}function fn(e){var t=on;t.curImage=e,t.curMode=tn.image,ur(e.width,e.height),cr(),Sr(),Wr()}function hn(e,t){var o=on;e.drawImage(t,0,0,o.imgW,o.imgH,0,0,o.imgW,o.imgH)}function bn(){var e=on;hn(e.imageProcessContext,e.baseImageCanvas),function(){var e=on;e.reqUndo?(e.reqUndo=!1,rr(e)):e.reqRedo?(e.reqRedo=!1,ir(e)):function(){var e=on;1==e.zoomRatio?hn(e.combineContext,e.imageProcessCanvas):e.combineContext.drawImage(e.imageProcessCanvas,e.zoomX,e.zoomY,e.zoomW,e.zoomH,0,0,e.imgW,e.imgH);e.mergeTempDraw&&(e.mergeTempDraw=!1,hn(e.drawingContext,e.tempDrawingCanvas),Zn(e));hn(e.combineContext,e.drawingCanvas),function(){var e=on;e.hasTempDraw&&hn(e.combineContext,e.tempDrawingCanvas);!function(){var e=on;kn(e)&&Tn()}()}()}()}()}function vn(e){var t;cr(),e&&(t=$("img.selected, video.selected"),oo(t))}function wn(){var e,t,o;Yt(vn),e="btnCancel",o=(t="confirmDlg")+"_no",Tr(t+"_yes","btnDelete"),Tr(o,e),Ot(!0)}function In(){Ot(!1)}var yn={baseId:"drawingArea",lToolBar:"drawingBoardToolBar",rToolBar:"drawingToolBar",bToolBar:"drawingCfgArea",taskCtrl:function(e){e||we(!1)},start:function(){xn()},init:function(){var e=yn;it(e),Jn(e),e.baseImageContext.rect(0,0,e.imgW,e.imgH),e.baseImageContext.fillStyle=xe.drawingBoardBgColor,e.baseImageContext.fill(),e.combineContext.drawImage(e.baseImageCanvas,0,0,e.imgW,e.imgH,0,0,e.imgW,e.imgH),_n(e,!1)},onResize:xn,canvasCtrl:function(e){var t=yn;switch(e){case b.start:return!1;case b.move:t.hasTempDraw=!0;break;case b.end:0==Bn.drawText&&(t.hasTempDraw=!1,t.mergeTempDraw=!0);break;case b.undo:t.canvasStep>0&&(t.reqUndo=!0);break;case b.redo:t.canvasStep<t.canvasArray.length-1&&(t.reqRedo=!0)}return!1},imageProcess:function(){var e=yn;$n(e.imageProcessContext,e.baseImageCanvas),function(){var e=yn;e.reqUndo?(e.reqUndo=!1,rr(e)):e.reqRedo?(e.reqRedo=!1,ir(e)):function(){var e=yn;$n(e.combineContext,e.imageProcessCanvas),e.mergeTempDraw&&(e.mergeTempDraw=!1,$n(e.drawingContext,e.tempDrawingCanvas),Zn(e));$n(e.combineContext,e.drawingCanvas),function(){var e=yn;e.hasTempDraw&&$n(e.combineContext,e.tempDrawingCanvas);!function(){var e=yn;kn(e)&&Tn()}()}()}()}()},imgW:xe.defDrawingBoardW,imgH:xe.defDrawingBoardH,hasTempDraw:!1,mergeTempDraw:!1,reqUndo:!1,reqRedo:!1};function xn(){Tn()}function Cn(e){var t=yn;switch(e.target.id){case"dbbtn_undo":ar(b.undo);break;case"dbbtn_redo":ar(b.redo);break;case"dbbtn_importPic":Gt();break;case"dbbtn_savePlayback":Da(),mr(t.combineCanvas)}M(e)}function $n(e,t){var o=yn;e.drawImage(t,0,0,o.imgW,o.imgH,0,0,o.imgW,o.imgH)}var Bn={appVersion:"20180904-1",curMode:void 0,showToolBar:!0,imgW:void 0,imgH:void 0,reqImgW:void 0,reqImgH:void 0,baseCanvas:void 0,baseContext:void 0,drawCanvas:void 0,drawContext:void 0,drawStyle:void 0,eraserStyle:void 0,clearStyle:"rgba(0,0,0,0)",opacity:void 0,lineWidth:void 0,colorHex:void 0,colorR:void 0,colorG:void 0,colorB:void 0,drawStartX:void 0,drawStartY:void 0,drawCurX:void 0,drawCurY:void 0,drawLastX:void 0,drawLastY:void 0,drawing:void 0,drawingMove:!1,fnDraw:void 0,activeDlg:!1,activeDlgCloseFn:!1,previewBrightnessAdj:0,previewWhiteBalanceAdj:0,previewRotate:0,fontFamily:"Arial",fontStyle:"Normal",fontSize:12,fontBold:!1,fontItalic:!1,drawText:!1,drawFontStyle:void 0,thumbnailCnt:0,thumbnailBuild:!1,thumbnailCurrPage:0,thumbnailTotalPage:1,thumbnailEntries:null,thumbnailReflesh:!1,capturing:!1,lastSaveFilename:"",ctrlPress:!1,showSysInfo:!1,frameRateInit:!1,frameCnt:16,frameSlotIdx:0,frameInterval:[],frameLastTime:0,frameRate:0,thumbFileCnt:0,thumbSelectedFileCnt:0,capturePeriodRun:!1,capturePeriodSec:xe.pcdCapturePeriodSec,captureIntervalHour:xe.pcdCaptureIntervalHour,capturePeriodTotalCnt:0,capturePeriodCurCnt:0,capturePeriodMs:0,resizeDelayMs:ye.resizeDelayMs,ipwRadiusExpandRatio:1,ipwExtraSpace:0,panMove:!1,panMoveX:0,panMoveY:0,drawRegularShape:!1,curVideoResolutionList:Qe,reqVideoResolutionList:!1,idVideoResolutionList:0,checkVideoResolution:!1};function Sn(e){document.getElementById("appTitle")&&pt("appTitle",e),pt("modeToolBar",e),pt("bottomToolBarData","previewArea"==Bn.curMode.baseId&&!qo&&!Vo&&e),void 0!==Bn.curMode.lToolBar&&pt(Bn.curMode.lToolBar,!qo&&!Vo&&e),void 0!==Bn.curMode.lS1ToolBar&&pt(Bn.curMode.lS1ToolBar,qo&&e&&!ha),void 0!==Bn.curMode.lS2ToolBar&&pt(Bn.curMode.lS2ToolBar,qo&&e&&ha),void 0!==Bn.curMode.lMsToolBar&&pt(Bn.curMode.lMsToolBar,Vo&&e),void 0!==Bn.curMode.rToolBar&&pt(Bn.curMode.rToolBar,(qo&&ha||!qo)&&!Vo&&e),void 0!==Bn.curMode.bToolBar&&pt(Bn.curMode.bToolBar,(qo&&ha||!qo)&&!Vo&&e)}function Wn(e){var t,o;Bn.curMode&&(Sn(!1),Bn.activeDlgCloseFn&&Bn.activeDlgCloseFn(),sr(),Bn.curMode.taskCtrl&&Bn.curMode.taskCtrl(!1),_n(Bn.curMode,!1)),Bn.curMode=e,Bn.curMode.taskCtrl&&Bn.curMode.taskCtrl(!0),t=Bn.curMode.imgW,o=Bn.curMode.imgH,Bn.imgW=t,Bn.imgH=o,st(),br(),Ir(),Bn.curMode.start&&Bn.curMode.start(),Bn.baseCanvas=Bn.curMode.drawingCanvas,Bn.baseContext=Bn.curMode.drawingContext,Bn.drawCanvas=Bn.curMode.tempDrawingCanvas,Bn.drawContext=Bn.curMode.tempDrawingContext,Bn.imgW=Bn.curMode.imgW,Bn.imgH=Bn.curMode.imgH,Sn(Bn.showToolBar),_n(Bn.curMode,!0)}function kn(e){return e===Bn.curMode}function _n(e,t){m(e.baseId,t)}function Tn(){var e=Bn.curMode;Ye.drawImage(e.combineCanvas,0,0,e.imgW,e.imgH,0,0,Xe,Ge)}function Dn(){var e;$("#displayCanvas").on("mousedown",qn).on("mousemove",Gn).on("mouseup",Vn).on("mouseout",Un).on("touchstart",Hn).on("touchend",Mn).on("touchmove",zn).on("touchcancel",Pn),e=0,l("uiArea","sysInfoWin"),vr("appVersion",e++),vr("cfgVersion",e++),vr("imgSize",e++),vr("frmRate",e++),vr("redoundo",e++),yr(!1)}function Hn(e){Fn(e)}function Mn(e){Fn(e)}function zn(e){Fn(e)}function Pn(e){}function Fn(e){if(e.originalEvent){Xn();var t=e.originalEvent.changedTouches[0],o="";switch(e.type){case"touchstart":o="mousedown";break;case"touchmove":o="mousemove";break;case"touchend":o="mouseup";break;default:return}var a="mousemove"==o?1:0,n=new MouseEvent(o,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,buttons:a,relatedTarget:null});t.target.dispatchEvent(n),e.preventDefault()}}var Rn,An,Ln,En,On=null,Yn=0;function Xn(){if(Co){var e=document.getElementById("sys_fullPhoto");e.style.backgroundColor=xe.toolBarColorLeave,e.style.opacity=xe.toolBarOpacityLeave,Yn=3,On||(On=setInterval((function(){if(0==(Yn-=1)){if(Co){var e=document.getElementById("sys_fullPhoto");e.style.backgroundColor=xe.toolBarColorHide,e.style.opacity=xe.toolBarOpacityHide}clearInterval(On),On=null}}),1e3))}}function Gn(e){if(Bn.fnDraw&&Bn.drawing&&(0==e.buttons?(void 0===Rn&&(Rn=e),or(Rn),Bn.fnDraw(b.end),Bn.drawing=!1,Bn.drawingMove&&ar(b.end)):(or(e),Rn=e,Bn.drawingMove=!0,Bn.fnDraw(b.move),ar(b.move))),ue){var t=$("#importPictureWin").data("picData");t.mouseDown&&(0==t.type?me(e):ge(t.type,e))}}function qn(e){pr(y.displayCanvas,f.click,e),!Bn.fnDraw||zo&&!Po||(jn(),Bn.drawing=!0,Bn.drawingMove=!1,function(e){var t=tr();Bn.drawStartX=e.offsetX*t,Bn.drawStartY=e.offsetY*t,Bn.drawStartX=Math.floor(10*Bn.drawStartX)/10,Bn.drawStartY=Math.floor(10*Bn.drawStartY)/10,Bn.drawCurX=Bn.drawLastX=Bn.drawStartX,Bn.drawCurY=Bn.drawLastY=Bn.drawStartY}(e),Bn.fnDraw(b.start),ar(b.start))}function Vn(e){if(Bn.fnDraw&&Bn.drawing&&(or(e),Bn.fnDraw(b.end),Bn.drawing=!1,ar(b.end)),ue){$("#importPictureWin").data("picData").mouseDown=!1,pe(),ue=!1}}function Un(e){Bn.fnDraw&&Bn.drawing&&2==k(Ce,1)&&(Bn.fnDraw(b.end),ar(b.end))}function Nn(e){e.width+=0}function jn(){Nn(Bn.drawCanvas)}function Zn(e){e.canvasArray.length&&e.canvasStep!=e.canvasArray.length-1&&(e.canvasArray.length=e.canvasStep+1),e.canvasStep+=1,e.canvasArray.push(e.drawingCanvas.toDataURL())}function Kn(e){e.canvasArray.length=0,e.canvasStep=-1,Nn(e.drawingCanvas),Zn(e)}function Jn(e){e.canvasArray=new Array,Kn(e)}function Qn(e){m("displayCanvas",e)}function er(){Bn.drawStyle="rgba("+Bn.colorR+", "+Bn.colorG+", "+Bn.colorB+", "+Bn.opacity+")",Bn.eraserStyle="rgba("+Bn.colorR+", "+Bn.colorG+", "+Bn.colorB+", "+xe.eraserOpacity+")"}function tr(){return Bn.imgW/Xe}function or(e){var t=tr();Bn.drawLastX=Bn.drawCurX,Bn.drawLastY=Bn.drawCurY,Bn.drawCurX=e.offsetX*t,Bn.drawCurY=e.offsetY*t,Bn.drawCurX=Math.floor(10*Bn.drawCurX)/10,Bn.drawCurY=Math.floor(10*Bn.drawCurY)/10}function ar(e){var t=Bn.curMode;if(t.canvasCtrl&&1==t.canvasCtrl(e))Ir();else{switch(e){case b.start:case b.move:case b.end:case b.undo:case b.redo:case b.mirror:case b.flip:case b.brightness:case b.whiteBalance:case b.zoom:case b.pan:t.imageProcess&&t.imageProcess()}Ir()}}function nr(e){var t=new Image;t.src=e.canvasArray[e.canvasStep],t.onload=function(){Nn(e.drawingCanvas),e.drawingContext.drawImage(t,0,0,e.imgW,e.imgH),e.imageProcess&&e.imageProcess()}}function rr(e){e.canvasStep>0&&(e.canvasStep-=1,nr(e))}function ir(e){e.canvasStep<e.canvasArray.length-1&&(e.canvasStep+=1,nr(e))}function cr(){Bn.activeDlgCloseFn&&Bn.activeDlgCloseFn(),sr()}function sr(){Bn.activeDlgCloseFn=!1,Bn.activeDlg=!1,$("#configDlg").hide(),$("#zoomDlg").hide(),removeCropBox()}function lr(e,t,o){Bn.activeDlgCloseFn&&(Bn.activeDlgCloseFn(),Bn.activeDlgCloseFn=!1),Bn.activeDlg!=e?(Bn.activeDlg=e,o&&(Bn.activeDlgCloseFn=o),t&&t()):Bn.activeDlg=!1}function dr(){var e;1!==xe.disableDrawTextSetting&&(e=document.getElementById("sdfontFamily").selectedIndex,Bn.fontFamily=Re[e][w.value],e=document.getElementById("fontStyle").selectedIndex,Bn.fontStyle=Ae[e][w.value],e=document.getElementById("fontSize").selectedIndex,Bn.fontSize=Ee[e][w.value])}function ur(e,t){var o=Bn.curMode;o.chgBaseImgCtrl&&o.chgBaseImgCtrl(I.before,e,t),rt(o,e,t),jn(),Kn(o),Bn.imgW=e,Bn.imgH=t,st(),br(),Ir(),o.chgBaseImgCtrl&&o.chgBaseImgCtrl(I.after,e,t),$r(),Sr(),Wr()}function pr(e,t,o){if(t===f.click)we(!0)}function gr(e){var t=new Date,o=t.getFullYear(),a=t.getMonth()+1,n=t.getDate(),r=t.getHours(),i=t.getMinutes(),c=t.getSeconds(),s=t.getMilliseconds();a<10&&(a="0"+a),n<10&&(n="0"+n),r<10&&(r="0"+r),i<10&&(i="0"+i),c<10&&(c="0"+c),s<10?s="00"+s:s<99&&(s="0"+s);var l=o+a+n+"-"+r+i+c+"-"+s;return""!=e&&(l+="."+e),l}async function mr(e,a="",n=!1){""==a&&(a=gr(""));var r=a+".jpg";if(Bn.lastSaveFilename==r)return!1;Bn.capturing=!0,Bn.lastSaveFilename=r;var i,c,s,l,d=xe.thumbW,u=xe.thumbH,p=xe.thumbPadding;i=d-2*p,c=u-2*p,e.width/e.height>i/c?(s=i,l=e.height*i/e.width):(s=e.width*c/e.height,l=c);var g=document.getElementById("tempCanvas");g.width=s,g.height=l,g.getContext("2d").drawImage(e,0,0,s,l);const m=(await o()).transaction(t,"readwrite").objectStore(t),f={name:r,normalImage:e.toDataURL(),thumbnailImage:g.toDataURL()};return m.add(f),!0}function fr(e){if("Control"!=e.key)switch(e.key){case"I":case"i":Bn.ctrlPress&&(Bn.showSysInfo=!Bn.showSysInfo,yr(Bn.showSysInfo))}else Bn.ctrlPress=!0}function hr(e){if(Bn.ctrlPress){var t=Bn.curMode.zoomScrollBarPos;t-=e.deltaY/10,t=Math.min(Math.max(t,0),xe.scrollZoomW),function(e,t){var o;o=(o=1+(xe.zoomMaxRatio-1)*t/e).toFixed(1),Bn.curMode&&Br(o,t)}(xe.scrollZoomW,t)}}function br(){var e,t,o,a,n={position:"absolute","margin-left":"0px",background:ye.ColorLeave,opacity:ye.OpacityLeave};o=xe.sysInfoWinW,a=xe.sysInfoWinH,e=Math.min(An-xe.toolBarIconW,qe+Xe),e-=o,t=Math.min(Ve+Ge,Ln-xe.drawSetH),n.width=o+"px",n.height=a+"px",n.left=e-xe.sysInfoGap+"px",n.top=t-xe.sysInfoGap-a+"px",$("#sysInfoWin").css(n);var r=document.getElementById("bottomToolBarData");if(r){var i=An/2-30;i<320&&(i=320),r.style.left=i+"px"}(r=document.getElementById("recordtime"))&&zo&&(r.style.right=document.documentElement.clientWidth/2-30+"px")}function vr(e,t){var o="sysInfoWin-"+e;g("sysInfoWin",o);var a={position:"absolute","margin-left":"0px"};a.left=xe.sysInfoGap+"px",a.top=xe.sysInfoGap+t*xe.sysInfoH+"px",a.height=xe.sysInfoH+"px",a.width=xe.sysInfoWinW-2*xe.sysInfoGap+"px",$("#"+o).css(a)}function wr(e,t){Cr(document.getElementById("sysInfoWin-"+e),t)}function Ir(){var e;wr("appVersion",Bn.appVersion),wr("cfgVersion",xe.cfgVersion),wr("imgSize",Bn.imgW+"x"+Bn.imgH),wr("frmRate",Bn.frameRate),wr("redoundo",(e=Bn.curMode).canvasStep+1+" / "+e.canvasArray.length)}function yr(e){e&&(br(),Ir()),m("sysInfoWin",e)}function xr(e){return"url('css/images/icon/"+e+"')"}function Cr(e,t){var o;o=document.createTextNode(t),e.innerText=o.textContent}function $r(){Br(1,0),$("#zoomDlg-zoom-slider").val(0)}function Br(e,t){var o,a,n,r,i,c,s=Bn.curMode;n=s.zoomX+s.zoomW/2,r=s.zoomY+s.zoomH/2,o=n-(i=s.imgW/e)/2,a=r-(c=s.imgH/e)/2,o=Math.max(o,0),a=Math.max(a,0),o=Math.min(o,s.imgW-i),a=Math.min(a,s.imgH-c),s.zoomRatio=e,s.zoomX=o,s.zoomY=a,s.zoomW=i,s.zoomH=c,ar(b.zoom),kr(!(e<=1)),Wr(),s.zoomScrollBarPos=t}function Sr(){var e,t,o=Bn.curMode,a={position:"absolute","margin-left":"0px",background:xe.panWinColor,opacity:xe.panOpacity},n=Xe/8,r=Ge/8;e=Math.max(xe.toolBarIconW,qe),t=Math.min(Ve+Ge,Ln-xe.drawSetH),a.width=n+"px",a.height=r+"px",a.left=e+xe.panWinGapX+"px",a.top=t-xe.panWinGapY-r+"px",$("#panWin").css(a),a.left=0,a.top=0,a.background="undefined",a.opacity=1,$("#cropWin").css(a),tt("cropWin",n,r),o.panWinW=n,o.panWinH=r}function Wr(){var e,t,o,a,n,r,i=Bn.curMode,c=i.panWinW/i.imgW;e=i.zoomX*c,t=i.zoomY*c,o=i.zoomW*c,a=i.zoomH*c,r=(n=document.getElementById("cropWin")).getContext("2d"),Nn(n),r.fillStyle=xe.panCropColor,r.fillRect(e,t,o,a)}function kr(e){m("panWin",e),m("cropWin",e)}function _r(){var e;Bn.reqVideoResolutionList!==Bn.curVideoResolutionList&&(Bn.curVideoResolutionList=Bn.reqVideoResolutionList,Bn.reqVideoResolutionList=!1,xt(Bn.curVideoResolutionList),e=document.getElementById("sdVideoRsoScrollbar").selectedIndex,co=Bn.curVideoResolutionList[e][v.w],so=Bn.curVideoResolutionList[e][v.h],kn($a)&&(Bn.checkVideoResolution=!0))}function Tr(e,t){var o;(o=document.getElementById(e))&&(o.title=Hr(t))}function Dr(e,t){var o;(o=document.getElementById(e))&&(o.innerHTML=Hr(t))}function Hr(e){return null==Mr[e]||void 0===Mr[e]?zr[e].message:Mr[e].message}var Mr,zr,Pr,Fr=null;function Rr(){An=window.innerWidth,Ln=window.innerHeight,En=xe.titleIconH,st(),Bn.curMode&&Bn.curMode.onResize&&Bn.curMode.onResize(),br(),ve(),Lt(),$("#lbMsCnt").length>0&&$("#lbMsCnt").css({top:Ln-80,left:An/2})}function Ar(){var e,t=[["btn_freehand","btnFreehand"],["btn_arrow","btnArrow"],["btn_eraser","btnEraser"],["btn_line","btnLine"],["btn_rectangleLine","btnRectangle"],["btn_rectangle","btnFilledRectangle"],["btn_circleLine","btnEllipse"],["btn_circle","btnFilledEllipse"],["btn_erase_all","btnEraseAll"],["btn_text","btnText"],["btn_setting","btnSetting"],["btn_capture","btnCapture"],["btn_freeze","btnFreezeLiveView"],["btn_timesave","btnIntervalShooting"],["btn_mirrow","btnFlipVertical"],["btn_flip","btnFlipHorizontal"],["btn_zoom","btnZoom"],["btn_importPic","btnImportImageFile"],["btn_redo","btnRedo"],["btn_undo","btnUndo"],["btn_record","btnRecord"],["btn_whitebalance","btnWhiteBalance"],["btn_brightness","btnBrightness"],["btn_config","btnConfig"],["mode_about","btnAbout"],["mode_preview","btnLiveView"],["mode_playback","btnGallery"],["mode_drawingBoard","btnDrawingBoard"],["mode_scan","btnScanMode"],["mode_multiscan","btnMultiScanMode"],["sys_close","btnCloseWindow"],["sys_fullScreen","btnMaxWindow"],["sys_fullPhoto","btnHideFunctionIcon"],["sys_smallScreen","btnMinWindow"],["btn_saveDisk","btnSaveToDisk"],["btn_delete","btnDelete"],["btn_toggleAll","btnToogleSelectAll"],["btn_Next","btn_Next"],["btn_Previous","btn_Previous"],["ppbtn_savePlayback","btnSaveToGallery"],["ppbtn_closeAndBackPlayback","btnBackToGallery"],["ppbtn_zoom","btnZoom"],["ppbtn_importPic","btnImportImageFile"],["ppbtn_redo","btnRedo"],["ppbtn_undo","btnUndo"],["ppbtn_transform","ppbtn_transform"],["ppbtn_ocr","ppbtn_ocr"],["dbbtn_savePlayback","btnSaveToGallery"],["dbbtn_redo","btnRedo"],["dbbtn_undo","btnUndo"],["dbbtn_importPic","btnImportImageFile"],["sdVideoRsoIcon","textVideoResolution"],["sdFontIcon","textFont"],["periodicCaptureDlg_periodIcon","textInterval"],["periodicCaptureDlg_intervalIcon","textDuration"],["periodicCaptureDlg_startIcon","btnStart"],["periodicCaptureInfoBar","btnCancel"],["drawingOpacity","textTransparency"],["drawingLineWidth","textWidth"],["scbtn_transform","scbtn_transform"],["scbtn_importPic","scbtn_importPic"],["scbtn_fullcrop","scbtn_fullcrop"],["scbtn_redo","scbtn_redo"],["scbtn_redo2","scbtn_redo"],["scbtn_undo","scbtn_undo"],["scbtn_undo2","scbtn_undo"],["scbtn_preview","scbtn_preview"],["scbtn_saveDisk","scbtn_saveDisk"],["scbtn_ocr","scbtn_ocr"],["scbtn_flip","scbtn_flip"],["scbtn_mirrow","scbtn_mirrow"],["scbtn_fullcrop","scbtn_fullcrop"],["mscbtn_capture","mscbtn_capture"],["mscbtn_merge","mscbtn_merge"],["mscbtn_fullcrop","mscbtn_fullcrop"],["configDlg-brightness-icon","config_brightness"],["configDlg-brightness-slider","config_brightness"],["configDlg-brightness-reset","config_reset"],["configDlg-rotate-icon","config_rotate"],["configDlg-rotate-slider","config_rotate"],["configDlg-rotate-reset","config_reset"],["configDlg-whiteBalence-icon","config_wb"],["configDlg-whiteBalence-slider","config_wb"],["configDlg-whiteBalence-reset","config_reset"],["dialogSave","dlgSave"]],o=[["pbFileInfo_Text","lbPage"],["fontStyle-lbNormal","lbNormal"],["fontStyle-lbBold","lbBold"],["fontStyle-lbItalic","lbItalic"],["fontStyle-lbBoldItalic","lbBoldItalic"],["periodicCaptureDlg_periodUnit","lbSeconds"],["periodicCaptureDlg_intervalUnit","lbMinutes"]],a=document.getElementById("sdLanguageFamily").selectedIndex,n=Le[a][2];ye.languageIdx=a,$.getJSON(n,(function(a){for(Mr=a,e=0;e<t.length;e++)Tr(t[e][0],t[e][1]);for(e=0;e<o.length;e++)Dr(o[e][0],o[e][1])}))}async function Lr(){(await o()).transaction(t,"readonly").objectStore(t).getAll().onsuccess=e=>{const t=e.target.result;t.length>0&&(Pr=t,Er())}}function Er(){Bn.thumbSelectedFileCnt=0,Bn.thumbnailCnt=0,Bn.thumbFileCnt=0,$("#thumbDiv").empty(),an(!1);var e=Pr.length;Bn.thumbnailTotalPage=parseInt((e-1)/100)+1,Bn.thumbnailCurrPage=Math.min(Bn.thumbnailCurrPage,Bn.thumbnailTotalPage-1);var t=100*Bn.thumbnailCurrPage,o=Math.min(t+100,e);e=0;for(var a=t;a<o;a++)Pr[a].name.indexOf(".jpg")>0&&(Bn.thumbnailCnt+=1,Nt(Pr[a],a)),Pr[a].name.indexOf(".mp4")>0&&Or(Pr[a],a);to(),setTimeout((function(){an(!0)}),200)}function Nt(e,t,o=!1){var a,n,r,i="thumb_"+t,c="img_"+t,l=xe.thumbW,d=xe.thumbH,p=xe.thumbPadding;if(o){var g=document.createElement("div");g.id=i,document.getElementById("thumbDiv").prepend(g)}else s("thumbDiv",i);n=l-2*p,r=d-2*p,a="#"+i,$(a).css("width",n+"px"),$(a).css("height",r+"px"),$(a).css("padding",p+"px"),$(a).css("position","relative"),$(a).css("display","inline-block"),u(i,c);var m=new Image;m.addEventListener("load",(function(){var t=Vt(n,r,m.width,m.height),o=xe.thumbFrmSize+"px solid "+xe.thumbFrmColorNormal;a="#"+c;var i={left:t.x+p,top:t.y+p,width:t.w,height:t.h,position:"absolute",border:o};$(a).css(i),$(a).addClass("thumbImg"),(a=document.getElementById(c)).src=e.thumbnailImage,a.fileName=e.name,a.checked=!1,$(a).on("click",(function(e){var t,o,a=document.getElementById(e.target.id);a.checked?(a.checked=!1,t=xe.thumbFrmColorNormal,Jt()):(jt(!1),a.checked=!0,t=xe.thumbFrmColorChecked,Kt()),o=xe.thumbFrmSize+"px solid "+t,$(this).css("border",o),$(this).toggleClass("selected")})),$(a).dblclick((function(){document.getElementById(this.id).checked=!0;var t=xe.thumbFrmColorChecked;Kt();var o=xe.thumbFrmSize+"px solid "+t;$(this).css("border",o),$(this).toggleClass("selected");var a=new Image;a.src=e.normalImage,a.addEventListener("load",(function(){fn(a)}))})),Zt()})),m.src=e.thumbnailImage}function Or(e,t,o=!1){var a,n,i,c="thumb_"+t,l="img_"+t,d="vIcon_"+t,u=xe.thumbW,p=xe.thumbH,g=xe.thumbPadding;if(o){var m=document.createElement("div");m.id=c,document.getElementById("thumbDiv").prepend(m)}else s("thumbDiv",c);n=u-2*g,i=p-2*g,a="#"+c,$(a).css("width",n+"px"),$(a).css("height",i+"px"),$(a).css("padding",g+"px"),$(a).css("position","relative"),$(a).css("display","inline-block"),r("video",c,l),s(c,d);var f=Vt(n,i,1280,720),h=xe.thumbFrmSize+"px solid "+xe.thumbFrmColorNormal;a="#"+l;var b={left:f.x+g,top:f.y+g,width:f.w,height:f.h,position:"absolute",border:h};$(a).css(b),$(a).addClass("thumbImg"),(a=document.getElementById(l)).src=URL.createObjectURL(e.video),a.autoplay=!1,a.controls=!1,a.loop=!1,a.fileName=e.name,a.checked=!1,b={right:6,bottom:17,width:36,height:12,position:"absolute",backgroundColor:"#000",color:"#EEE",textAlign:"center",fontSize:12,opacity:.75},$("#"+d).css(b),a.addEventListener("loadedmetadata",(function(){var e=Math.round(a.duration);document.getElementById(d).innerText=Math.floor(e/60)+":"+Xo(e%60,2)})),$(a).on("click",(function(e){var t,o,a=document.getElementById(e.target.id);a.checked?(a.checked=!1,t=xe.thumbFrmColorNormal,Jt()):(jt(!1),a.checked=!0,t=xe.thumbFrmColorChecked,Kt()),o=xe.thumbFrmSize+"px solid "+t,$(this).css("border",o),$(this).toggleClass("selected")})),$(a).dblclick((function(){var e=document.getElementById(this.id);e.checked=!0;var t=xe.thumbFrmColorChecked;Kt();var o,a=xe.thumbFrmSize+"px solid "+t;$(this).css("border",a),$(this).toggleClass("selected"),e.muted=!1,e.currentTime=0,(o=e).webkitRequestFullscreen?o.webkitRequestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.requestFullscreen?o.requestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()})),a.addEventListener("ended",(function(e){null!=document.fullscreenElement&&document.exitFullscreen()}),!1),a.addEventListener("mouseover",(function(e){var t=a.play();void 0!==t&&t.then((e=>{a.muted=!0,a.play()})).catch((e=>{}))})),a.addEventListener("mouseleave",(function(e){var t=a.play();void 0!==t&&t.then((e=>{a.pause(),a.currentTime=0})).catch((e=>{}))})),Zt()}function oo(o){var a;const n=indexedDB.open(e);n.onsuccess=e=>{const n=e.target.result.transaction(t,"readwrite").objectStore(t).openCursor();n.onsuccess=e=>{const t=e.target.result;if(t)for(a=0;a<o.length;a++)t.value.name===o[a].fileName?t.delete():t.continue()},n.onerror=e=>{}},n.onerror=e=>{},Lr()}window.onresize=function(e){if(ye.resizeDelayMs){if(Bn.resizeDelayMs=ye.resizeDelayMs,Fr)return;Fr=setInterval((function(){Bn.resizeDelayMs-=ye.resizeDelayMs/2,Bn.resizeDelayMs<=0&&(clearInterval(Fr),Fr=null,Rr())}),ye.resizeDelayMs/2)}else Rr()},window.onmousemove=function(){Xn()},window.onload=async function(){var e,t,o,a,n,r,i,c,d,u;Rr(),$("body").css("background-color",xe.bgColor),(e={position:"absolute",width:xe.toolBarIconW,height:xe.toolBarIconH,"margin-left":"0px"}).width=xe.toolBarIconW,e.height=xe.toolBarIconH,C(ut,e,"uiArea","playbackRToolBar","right"),1===xe.disableDrawingToolBar?(C($e,e,"uiArea","drawingToolBar","right",Jo),W($e)):(C(Ce,e,"uiArea","drawingToolBar","right",Jo),W(Ce)),C(He,e,"uiArea","thumbnailToolBar","left",nn),W(He),C(Me,e,"uiArea","picPlaybackToolBar","left",cn),W(Me),C(ze,e,"uiArea","drawingBoardToolBar","left",Cn),W(ze),C(Se,e,"uiArea","previewToolBar","left",Sa),W(Se),C(We,e,"uiArea","scanToolBarS1","left",va),W(We),C(ke,e,"uiArea","scanToolBarS2","left",va),W(ke),C(_e,e,"uiArea","multiscanToolBar","left",Ca),W(_e),C(De,e,"uiArea","sysToolBar","top-right",ko),W(De),e.width=xe.modeIconW/2,e.height=ye.drawSetH,C(Be,e,"uiArea","bottomToolBarData","bottom",Sa),W(Be),$("#btn_pause").hide(),e.width=xe.modeIconW,e.height=xe.modeIconH,C(Te,e,"uiArea","modeToolBar","top-left",jo),W(Te),$("#Dummy").unbind("mouseenter mouseleave click"),function(){var e,t=["playbackRToolBar","previewToolBar","drawingToolBar","thumbnailToolBar","picPlaybackToolBar","drawingBoardToolBar","scanToolBarS1","scanToolBarS2"];for(e=0;e<t.length;e++)pt(t[e],!1)}(),t={position:"absolute",width:xe.colorIconW,height:xe.colorIconH,"margin-left":"0px",opacity:xe.colorIconOpacity},1===xe.disableColorBar?(R(Fe,t,"drawingCfgArea","drawingCfgColorBar",gt),X(Fe)):xe.cb2Apply?(V(Pe,0,"drawingCfgArea","drawingCfgColorBar",gt),J(Pe)):(R(Pe,t,"drawingCfgArea","drawingCfgColorBar",gt),X(Pe)),function(){var e={iconL:"30x_30alpha.png",iconSize:xe.scrollIconH,length:xe.scrollOpacityW,curPos:xe.scrollOpacityDefPos,startX:0,startY:0,color:xe.scrollColor};if(0===xe.disableDrawingOpacityScrollBar){function o(e){var t;t=e.currentTarget?e.currentTarget.value:e,Bn.opacity=.1+t/100*.9,Bn.opacity=Bn.opacity.toFixed(1),er()}mt(e,"drawingCfgArea","drawingOpacity",o,100)}var t={iconL:"30x30lineWidth.png",iconSize:xe.scrollIconH,length:xe.scrollLineWidthW,curPos:xe.scrollLineWidthDefPos,startX:160,startY:0,color:xe.scrollColor};if(0===xe.disableDrawingLineWidthScrollBar){function a(e){var t;t=e.currentTarget?e.currentTarget.value:e,Bn.lineWidth=xe.lineWidthMin+(xe.lineWidthMax-xe.lineWidthMin)*(t/100),Bn.lineWidth=Math.floor(Bn.lineWidth)}mt(t,"drawingCfgArea","drawingLineWidth",a,10)}}(),ft(),It(),St(),le(),function(){var e,t="configDlg";s("uiArea",t),e="#"+t,$(e).css("background",ye.ColorLeave),$(e).css("top","calc(50%)"),$(e).css("left",xe.toolBarIconW+"px"),$(e).css("width","420px"),$(e).css("height","200px"),$(e).css("position","absolute"),$(e).hide(),l(t,e=t+"-close"),e="#"+e;var o=xr("close.png");$(e).css("background",o),$(e).css("top","0px"),$(e).css("left",420-xe.toolBarIconW+"px"),$(e).css("width",xe.toolBarIconW+"px"),$(e).css("height",xe.toolBarIconH+"px"),$(e).css("position","absolute"),$(e).on("click",(function(){$("#"+t).hide()})),e="#"+re(t,e=t+"-brightness","brightness.png",24,36),$(e).attr({type:"range",max:90,min:-90,step:2,value:0}),$(e).on("input",(function(e){Bn.previewBrightnessAdj=Math.floor(e.currentTarget.value),Bn.curMode&&ar(b.brightness)})),e="#"+re(t,e=t+"-rotate","rotate.png",24,84),$(e).attr({type:"range",max:180,min:-180,step:5,value:0}),$(e).on("input",(function(e){Bn.previewRotate=Math.floor(e.currentTarget.value)})),e="#"+re(t,e=t+"-whiteBalence","wb.png",24,132),$(e).attr({type:"range",max:40,min:-40,step:1,value:0}),$(e).on("input",(function(e){Bn.previewWhiteBalanceAdj=Math.floor(e.currentTarget.value),Bn.curMode&&ar(b.whiteBalance)}))}(),r=(n="aboutDlg")+"-close",i=n+"-content",s("uiArea",n),s(n,r),s(n,i),o="#"+n,$(o).css("top","calc(50% - "+(xe.aboutWinH-xe.titleIconH)/2+"px)"),$(o).css("left","calc(50% - "+xe.aboutWinW/2+"px)"),$(o).css("width",xe.aboutWinW+"px"),$(o).css("height",xe.aboutWinH+"px"),$(o).css("position","absolute"),$(o).css("background",xe.aboutBkg),$(o).css("opacity",xe.aboutOpacity),o="#"+r,a=xr("close.png"),$(o).css("background",a),$(o).css("top","0px"),$(o).css("left","calc(100% - "+xe.aboutIconW+"px)"),$(o).css("width",xe.aboutIconW+"px"),$(o).css("height",xe.aboutIconH+"px"),$(o).css("position","absolute"),$(o).click((function(){m("aboutDlg",!1)})),o="#"+i,$(o).css("top",xe.aboutIconH+"px"),$(o).css("left",xe.aboutGapX+"px"),$(o).css("width",xe.aboutWinW-2*xe.aboutGapX+"px"),$(o).css("height",xe.aboutWinH-xe.aboutIconH+"px"),$(o).css("position","absolute"),$(o).html('\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<center><img src="css/images/icon/logo 60.png"></img></center>\t\t\t\t\t\t\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label><font size="5" color="#FF0"><center>Smart DC for Chrome OS</center></font></label>\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label><font size="3" color="#88F"><center>Version 1.24.1026</center></font></label>\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'),o="#companyLink",$(o).click((function(){window.open("http://www.tekspring.com")})),o="#manualLink",$(o).click((function(){window.open("https://www.dropbox.com/s/fa4rvuvi48uvksu/TS-82-913-90022.pdf?dl=0")})),m(n,!1),function(){var e,t,o,a,n,r="periodicCaptureDlg",i=r+"_periodIcon",c=r+"_periodText",l=r+"_periodUnit",d=r+"_intervalIcon",u=r+"_intervalText",p=r+"_intervalUnit",g=r+"_close",m=r+"_startIcon",f=(xe.pcdIconH-xe.pcdTextH)/2,h=(xe.pcdIconH-xe.pcdUnitH)/2;s("uiArea",r),a=xe.pcdIconW+xe.pcdTextW+xe.pcdUnitW+xe.pcdExtraW,n=4*xe.pcdIconH-3*xe.pcdIconOverlayY,e="#"+r,$(e).css("position","absolute"),$(e).css("background",xe.pcdBkg),$(e).css("opacity",xe.pcdOpacity),$(e).css("left","calc(50% - "+a/2+"px)"),$(e).css("top","calc(50% - "+(n-xe.titleIconH)/2+"px)"),$(e).css("width",a+"px"),$(e).css("height",n+"px"),Ht(r,g,"close.png",t=a-xe.pcdIconW,o=0),$("#"+g).on("click",ja),Ht(r,i,"timesave_time.png",t=0,o+=xe.pcdIconH-xe.pcdIconOverlayY),zt(r,c,t+=xe.pcdIconW,o+f,Bn.capturePeriodSec),Mt(r,l,t+=xe.pcdTextW,o+h,""),Ht(r,d,"timesave_keep.png",t=0,o+=xe.pcdIconH-xe.pcdIconOverlayY),zt(r,u,t+=xe.pcdIconW,o+f,Bn.captureIntervalHour),Mt(r,p,t+=xe.pcdTextW,o+h,""),o+=xe.pcdIconH-xe.pcdIconOverlayY,Ht(r,m,"timesave_star.png",t=(a-xe.pcdIconW)/2,o),$("#"+m).on("click",Ja),Pt(!1)}(),function(){var e,t="periodicCaptureInfoBar",o=t+"_text",a=t+"_icon";l("uiArea",t),Ft(),g(t,o),e="#"+o,$(e).css("position","absolute"),$(e).css("left",0),$(e).css("top",(xe.pcibIconH-xe.pcibTextH)/2+"px"),$(e).css("width",xe.pcibTextW+"px"),$(e).css("height",xe.pcibTextH+"px"),$(e).css("text-align","center"),$(e).css("line-height",xe.pcibTextH+"px"),$(e).css("font-size",xe.pcibTextFontSize),$(e).css("color",xe.pcibTextColor),l(t,a),e="#"+a,$(e).css("position","absolute"),$(e).css("left",xe.pcibTextW+"px"),$(e).css("top",0),$(e).css("width",xe.pcibIconW+"px"),$(e).css("height",xe.pcibIconH+"px"),$(e).css("background",xr("timesave_star.png")),$(e).on("click",Rt),At(!1)}(),Et(),u={position:"absolute",background:xe.mouseColorLeave,padding:"0 0 0 0px",top:"0px",height:xe.titleIconH+"px",opacity:xe.mouseOpacityLeave},c=xe.modeIconW*Te.length,d=xe.toolBarIconW*De.length,u.left=c+"px",u.width="calc(100% - "+(c+d)+"px)",$("#appTitle").css(u),$("#appTitle").css("-webkit-app-region","drag"),Dn(),$a.init(),on.init(),yn.init(),qt(),Wn($a);try{await go()}catch(e){}yo(),no=new Date,setInterval((function(){var e=new Date-no;(void 0===window.stream||e>1e3&&0==window.stream.active&&"minimized"==chrome.WindowState)&&wo()}),3e3),Ar()},document.body.addEventListener("keydown",(function(e){fr(e)})),document.body.addEventListener("keyup",(function(e){!function(e){"Control"!=e.key||(Bn.ctrlPress=!1)}(e)})),document.body.addEventListener("wheel",(function(e){hr(e)})),document.oncontextmenu=function(){return!1};